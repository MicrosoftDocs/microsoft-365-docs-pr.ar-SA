---
title: استرداد SharePoint Server 2013 بعد الكوارث في Microsoft Azure
ms.author: bcarter
author: brendacarter
manager: laurawi
ms.date: 04/17/2018
audience: ITPro
ms.topic: article
ms.service: o365-solutions
ms.localizationpriority: medium
search.appverid:
- MET150
ms.collection: Ent_O365
f1.keywords:
- CSH
ms.custom:
- Ent_Deployment
- seo-marvel-apr2020
ms.assetid: e9d14cb2-ff28-4a18-a444-cebf891880ea
description: تصف هذه المقالة كيفية استخدام Azure لإنشاء بيئة استرداد لكارثة لمزرعتك SharePoint المحلية.
ms.openlocfilehash: 873d0c9ccfdc8c6a978b89416a7492a2141c825d
ms.sourcegitcommit: a4729532278de62f80f2160825d446f6ecd36995
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 03/31/2022
ms.locfileid: "64569125"
---
# <a name="sharepoint-server-2013-disaster-recovery-in-microsoft-azure"></a>استرداد SharePoint Server 2013 بعد الكوارث في Microsoft Azure

 باستخدام Azure، يمكنك إنشاء بيئة استرداد لكارثة لمزرعتك SharePoint المحلية. تصف هذه المقالة كيفية تصميم هذا الحل وتطبيقه.

 **شاهد الفيديو SharePoint نظرة عامة حول استرداد البيانات في حالات الكوارث في Server 2013**
> [!VIDEO https://www.microsoft.com/videoplayer/embed/1b73ec8f-29bd-44eb-aa3a-f7932784bfd9?autoplay=false]

 عندما تدهمك SharePoint بيئة العمل المحلية، فإن أولويتك القصوى هي تشغيل النظام مرة أخرى بسرعة. يكون استرداد البيانات SharePoint أسرع وأسهل عندما يكون لديك بيئة احتياطية قيد التشغيل بالفعل في Microsoft Azure. يشرح هذا الفيديو المفاهيم الأساسية SharePoint بيئة الفشل الدافئة ويكمل التفاصيل الكاملة المتوفرة في هذه المقالة.

استخدم هذه المقالة مع نموذج الحل التالي: SharePoint **في Microsoft Azure**.

[![SharePoint عملية استرداد الكوارث إلى Azure.](../media/SP-DR-Azure.png)](https://go.microsoft.com/fwlink/p/?LinkId=392555)

 [PDF](https://go.microsoft.com/fwlink/p/?LinkId=392555) |  [Visio](https://go.microsoft.com/fwlink/p/?LinkId=392554)

## <a name="use-azure-infrastructure-services-for-disaster-recovery"></a>استخدام خدمات البنية الأساسية ل Azure لاسترداد حالات الطوارئ

لا تملك العديد من المؤسسات بيئة استرداد لكارثات SharePoint، والتي قد تكون مكلفة للبناء والمحافظة عليها في الموقع. توفر Azure Infrastructure Services خيارات جذابة لبيئات استرداد حالات الطوارئ الأكثر مرونة وأقل تكلفة من البدائل المحلية.

تتضمن فوائد استخدام خدمات البنية الأساسية ل Azure ما يلي:

- **موارد أقل تكلفة** الحفاظ على موارد أقل من بيئات استرداد الكوارث المحلية والدفع مقابلها. يعتمد عدد الموارد على بيئة استرداد الكوارث التي تختارها: الاستعداد الباردة أو الاستعداد الدافئ أو الاستعداد السريع.

- **مرونة أفضل للموارد** في حالة حدوث كارثة، يمكنك بسهولة تغيير حجم مزرعة SharePoint لتلبية متطلبات التحميل. يمكنك المقياس عندما لا تحتاج إلى الموارد.

- **التزام أقل في مركز البيانات** استخدم Azure Infrastructure Services بدلا من الاستثمار في مركز بيانات ثانوي في منطقة مختلفة.

هناك خيارات أقل تعقيدا بالنسبة إلى المؤسسات التي بدأت للتو في استرداد حالات الكوارث والخيارات المتقدمة ل المؤسسات ذات المتطلبات عالية المرونة. تختلف تعريفات بيئات الاستعداد الباردة والدفء والسخونة بعض الشيء عند استضافة البيئة على نظام أساسي على السحابة. يصف الجدول التالي هذه البيئات لبناء مزرعة استرداد SharePoint في Azure.

**الجدول: بيئات الاسترداد**

|نوع بيئة الاسترداد|الوصف|
|---|---|
|Hot|يتم توفير مزرعة بحجم كامل وتحديثها وتشغيلها في وضع الاستعداد.|
|دافئ|تم بناء المزرعة وتشغيل الأجهزة الظاهرية وتحديثها. <br/> يتضمن الاسترداد إرفاق قواعد بيانات المحتوى وتوفير تطبيقات الخدمة ومحتوى تتبع الارتباطات. <br/> يمكن أن تكون المزرعة إصدارا أصغر من مزرعة الإنتاج، ثم يتم تصغير حجمها لخدمة قاعدة المستخدمين الكاملة.|
|البرد|تم بناء المزرعة بالكامل، ولكن يتم إيقاف الأجهزة الظاهرية. <br/> تتضمن المحافظة على البيئة بدء تشغيل الأجهزة الظاهرية من وقت لآخر وتصحيح البيئة وتحديثها والتحقق منها. <br/> ابدأ البيئة الكاملة في حالة حدوث كارثة.|

من المهم تقييم أهداف وقت الاسترداد (RTOs) وأهداف نقاط الاسترداد (RPOs) الخاصة مؤسستك. تحدد هذه المتطلبات البيئة الأكثر ملاءمة لمنظمتك.

توضح الإرشادات في هذه المقالة كيفية تنفيذ بيئة الاستعداد الدافئة. يمكنك أيضا تكييفه مع بيئة الاستعداد الباردة، على الرغم من أنك تحتاج إلى اتباع إجراءات إضافية لدعم هذا النوع من البيئة. لا تصف هذه المقالة كيفية تنفيذ بيئة الاستعداد بشكل جيد.

لمزيد من المعلومات حول حلول استرداد الكوارث، راجع مفاهيم التوفر العالي واسترداد الكوارث في [SharePoint 2013](/SharePoint/administration/high-availability-and-disaster-recovery-concepts) واختيار استراتيجية استرداد لكارثة SharePoint [2013](/SharePoint/administration/plan-for-disaster-recovery).

## <a name="solution-description"></a>وصف الحل

يتطلب حل الاستعداد السريع للاستعادة من الكوارث البيئة التالية:

- مزرعة إنتاج SharePoint المحلي

- مزرعة استرداد SharePoint Azure

- اتصال VPN من موقع إلى موقع بين البيئات

يوضح الشكل التالي هذه العناصر الثلاثة.

**الشكل: عناصر حل الاستعداد الدافئ في Azure**

![عناصر عنصر SharePoint الاستعداد الدافئ في Azure.](../media/AZarch-AZWarmStndby.png)

SQL Server شحن السجلات باستخدام النسخ المتماثل لنظام الملفات الموزع (DFSR) لنسخ النسخ الاحتياطية لقاعدة البيانات وسجلات المعاملات إلى مزرعة الاسترداد في Azure:

- تنقل DFSR السجلات من بيئة الإنتاج إلى بيئة الاسترداد. في سيناريو WAN، يكون DFSR أكثر فعالية من شحن السجلات مباشرة إلى الخادم الثانوي في Azure.

- يتم إعادة تشغيل السجلات على SQL Server في بيئة الاسترداد في Azure.

- لا تقوم بإرفاق قواعد بيانات المحتوى SharePoint التي تم شحنها في بيئة الاسترداد حتى يتم تنفيذ عملية استرداد.

تنفيذ الخطوات التالية لاسترداد المزرعة:

1. إيقاف شحن السجل.

2. إيقاف قبول حركة المرور إلى المزرعة الأساسية.

3. إعادة عرض سجلات المعاملات النهائية.

4. أرفق قواعد بيانات المحتوى إلى المزرعة.

5. استعادة تطبيقات الخدمة من قواعد بيانات الخدمات المتماثلة.

6. تحديث سجلات نظام أسماء المجالات (DNS) لتشير إلى مزرعة الاسترداد.

7. ابدأ عملية تتبع ارتباطات كاملة.

نوصيك بالتمرين على هذه الخطوات بشكل منتظم وتوثيقها للمساعدة في ضمان تشغيل الاسترداد المباشر بسلاسة. قد يستغرق إرفاق قواعد بيانات المحتوى واستعادة تطبيقات الخدمة بعض الوقت ويتضمن عادة بعض التكوين اليدوي.

بعد إجراء عملية استرداد، يوفر هذا الحل العناصر المدرجة في الجدول التالي.

**جدول: أهداف استرداد الحلول**

|عنصر|الوصف|
|---|---|
|المواقع والمحتوى|تتوفر المواقع والمحتوى في بيئة الاسترداد.|
|مثيل جديد للبحث|في حل الاستعداد الدافئ هذا، لا يتم استعادة البحث من قواعد بيانات البحث. يتم تكوين مكونات البحث في مزرعة الاسترداد بطريقة مماثلة قدر الإمكان لمزرعة الإنتاج. بعد استعادة المواقع والمحتوى، يتم بدء عملية تتبع ارتباطات كاملة لإعادة إنشاء فهرس البحث. لست بحاجة إلى انتظار اكتمال تتبع الارتباطات لجعل المواقع والمحتوى متوفرا.|
|الخدمات|يتم استعادة الخدمات التي تخزن البيانات في قواعد البيانات من قواعد البيانات التي تم شحنها بواسطة السجل. يتم ببساطة بدء استخدام الخدمات التي لا تخزن البيانات في قواعد البيانات. <br/> لا يلزم استعادة كل الخدمات التي بها قواعد بيانات. لا تحتاج الخدمات التالية إلى استعادتها من قواعد البيانات ويمكن أن تبدأ ببساطة بعد الفشل: <br/> تجميع بيانات الاستخدام والصحة <br/> خدمة الولاية <br/> التنفيذ التلقائي ل Word <br/> أي خدمة أخرى لا تستخدم قاعدة بيانات|

يمكنك العمل مع Microsoft Consulting Services (MCS) أو أحد الشركاء لمعالجة أهداف الاسترداد الأكثر تعقيدا. يتم تلخيصها في الجدول التالي.

**جدول: العناصر الأخرى التي يمكن معالجتها بواسطة MCS أو شريك**

|عنصر|الوصف|
|---|---|
|مزامنة حلول المزرعة المخصصة|وبشكل مثالي، يكون تكوين مزرعة الاسترداد مماثلا لمزرعة الإنتاج. يمكنك العمل مع مستشار أو شريك لتقييم ما إذا كانت حلول المزرعة المخصصة متماثلة وما إذا كانت العملية في مكانها الصحيح لإبقاء البيئات متزامنة.|
|الاتصالات إلى مصادر البيانات في الموقع|قد لا يكون من العملي إجراء نسخ متماثل للاتصالات بأنظمت البيانات الموجودة على الجهاز الخلفي، مثل اتصالات وحدة تحكم المجال الاحتياطية (BDC) ومصادر محتوى البحث.|
|سيناريوهات استعادة البحث|ونظرا لأن عمليات نشر البحث في المؤسسات تميل إلى أن تكون فريدة ومعقدة إلى حد ما، فإن استعادة البحث من قواعد البيانات تتطلب استثمارا أكبر. يمكنك العمل مع مستشار أو شريك لتحديد سيناريوهات استعادة البحث التي قد تتطلبها مؤسستك وتطبيقها.|

تفترض الإرشادات المتوفرة في هذه المقالة أن المزرعة في الموقع تم تصميمها ونشرها بالفعل.

## <a name="detailed-architecture"></a>هندسة تفصيلية

وبشكل مثالي، يكون تكوين مزرعة الاسترداد في Azure مماثلا لمزرعة الإنتاج المحلي، بما في ذلك ما يلي:

- التمثيل نفسه لأدوار الخادم

- التكوين نفسه للتخصيصات

- التكوين نفسه لمكونات البحث

يمكن أن تكون البيئة في Azure إصدارا أصغر من مزرعة الإنتاج. إذا كنت تخطط مقياس مزرعة الاسترداد بعد الفشل، فمن المهم أن يتم تمثيل كل نوع من دور الخادم في البداية.

قد لا تكون بعض التكوينات عملية للتكرار في بيئة الفشل. تأكد من اختبار إجراءات وبيئة الفشل للمساعدة على ضمان أن مزرعة الفشل توفر مستوى الخدمة المتوقع.

لا يفرض هذا الحل طبولوجيا معينة لمزرعة SharePoint أخرى. يركز هذا الحل على استخدام Azure لمزرعة الفشل وتطبيق شحن السجلات وDFSR بين البيئات.

### <a name="warm-standby-environments"></a>بيئات الاستعداد الدافئة

في بيئة الاستعداد الدافئة، يتم تشغيل جميع الأجهزة الظاهرية في بيئة Azure. البيئة جاهزة لحدث أو تمرين للفشل.

يوضح الشكل التالي حلا لاسترداد حالات الكوارث من مزرعة SharePoint إلى مزرعة SharePoint مستندة إلى Azure تم تكوينها كبيئة الاستعداد الدافئة.

**الشكل: طبولوجيا وعناصر أساسية لمزرعة إنتاج ومزرعة استرداد الاستعداد الدافئة**

![طبولوجيا مزرعة SharePoint ومزرعة استرداد الاستعداد الدافئة.](../media/AZarch-AZWarmStndby.png)

في هذا الرسم التخطيطي:

- يتم توضيح بيئات جنبا إلى جنب: المزرعة SharePoint والمزرعة الاستعداد الدافئة في Azure.

- تتضمن كل بيئة مشاركة ملف.

- تتضمن كل مزرعة أربعة مستويات. لتحقيق توفر عال، تتضمن كل طبقة خادمين أو جهازين ظاهريين تم تكوينهما بشكل متطابق لدور معين، مثل الخدمات الأمامية وذاكرة التخزين المؤقت الموزعة والخدمات الموجودة على الخادم وقواعد البيانات. ليس من المهم في هذا الرسم التوضيحي توضيح مكونات معينة. يتم تكوين المزرعتين بشكل متطابق.

- المستوى الرابع هو مستوى قاعدة البيانات. يتم استخدام شحن السجلات لنسخ السجلات من خادم قاعدة البيانات الثانوي في البيئة المحلية إلى مشاركة الملف في نفس البيئة.

- DFSR ينسخ الملفات من مشاركة الملف في البيئة المحلية إلى مشاركة الملف في بيئة Azure.

- إعادة شحن السجلات من مشاركة الملف في بيئة Azure إلى النسخة المتماثلة الأساسية في SQL Server توفر AlwaysOn في بيئة الاسترداد.

### <a name="cold-standby-environments"></a>بيئات الاستعداد الباردة

في بيئة الاستعداد الباردة، يمكن إيقاف تشغيل معظم SharePoint الظاهرية للمزرعة. (نوصي أحيانا ببدء تشغيل الأجهزة الظاهرية، مثل كل أسبوعين أو مرة واحدة في الشهر، بحيث يمكن مزامنة كل جهاز ظاهري مع المجال.) يجب أن تظل الأجهزة الظاهرية التالية في بيئة استرداد Azure قيد التشغيل للمساعدة في ضمان استمرار عمليات شحن السجلات وDFSR:

- مشاركة الملف

- خادم قاعدة البيانات الأساسي

- جهاز ظاهري واحد على الأقل يعمل Windows Server Active Directory 域服务 و DNS

يعرض الرسم البياني التالي بيئة فشل Azure حيث يشارك الملف الجهاز الظاهري والآلة SharePoint قاعدة البيانات الأساسية قيد التشغيل. يتم إيقاف SharePoint الظاهرية الأخرى. لا يظهر الجهاز الظاهري الذي Windows Server Active Directory و DNS.

**الشكل: مزرعة استرداد الاستعداد الباردة مع أجهزة ظاهرية قيد التشغيل**

![عناصر حل الاستعداد SharePoint في Azure.](../media/AZarch-AZColdStndby.png)

بعد الفشل في الوصول إلى بيئة الاستعداد الباردة، يتم بدء تشغيل كل الأجهزة الظاهرية، ويجب تكوين الأسلوب لتحقيق توفر عال من خوادم قاعدة البيانات، مثل SQL Server مجموعات التوفر AlwaysOn.

إذا تم تنفيذ مجموعات تخزين متعددة (تنتشر قواعد البيانات عبر أكثر من مجموعة توفر SQL Server)، فيجب تشغيل قاعدة البيانات الأساسية لكل مجموعة تخزين لقبول السجلات المقترنة بمجموعتها التخزينية.

### <a name="skills-and-experience"></a>المهارات والخبرات

يتم استخدام تقنيات متعددة في حل استرداد حالات الكوارث هذا. للمساعدة على ضمان تفاعل هذه التقنيات كما هو متوقع، يجب تثبيت كل مكون في بيئة Azure المحلية وتكوينه بشكل صحيح. نوصي بأن يكون لدى الشخص أو الفريق الذي قام بتعيين هذا الحل معرفة عمل قوية ومهارات عملية باستخدام التقنيات الموضحة في المقالات التالية:

- [خدمات النسخ المتماثل لنظام الملفات الموزع (DFS)](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj127250(v=ws.11))

- [Windows Server Failover Clustering (WSFC) مع SQL Server](/sql/sql-server/failover-clusters/windows/windows-server-failover-clustering-wsfc-with-sql-server)

- [مجموعات توفر AlwaysOn (SQL Server)](/sql/database-engine/availability-groups/windows/always-on-availability-groups-sql-server)

- [الرجوع إلى قواعد بيانات SQL Server واستعادتها](/sql/relational-databases/backup-restore/back-up-and-restore-of-sql-server-databases)

- [SharePoint تثبيت الخادم 2013 ونشر المزرعة](/SharePoint/install/installation-and-configuration-overview)

- [Microsoft Azure](/azure/)

وأخيرا، نوصي بمهارات البرمجة النصية التي يمكنك استخدامها لأتمتة المهام المقترنة بهذه التقنيات. من الممكن استخدام واجهات المستخدم المتوفرة لإكمال كل المهام الموضحة في هذا الحل. ومع ذلك، يمكن أن تستغرق الطريقة اليدوية وقتا طويلا وعرضة للأخطاء، كما أنها توفر نتائج غير متناسقة.

بالإضافة إلى Windows PowerShell، هناك أيضا Windows PowerShell مكتبات SQL Server وخادم SharePoint و Azure. لا تنس T-SQL، التي يمكن أن تساعد أيضا على تقليل الوقت لتكوين بيئة الاسترداد في حالات الكوارث والمحافظة عليها.

## <a name="disaster-recovery-roadmap"></a>خارطة طريق استرداد الكوارث

![تمثيل مرئي SharePoint لكارثتك.](../media/Azure-DRroadmap.png)

يفترض هذا المخطط أن لديك بالفعل مزرعة SharePoint Server 2013 تم نشرها في الإنتاج.

**جدول: خارطة طريق لاسترداد حالات الكوارث**

|المرحلة|الوصف|
|---|---|
|المرحلة 1|صمم بيئة الاسترداد في حالات الكوارث.|
|المرحلة 2|إنشاء شبكة Azure الظاهرية واتصال VPN.|
|المرحلة 3|نشر Windows Active Directory وخدمات اسم المجال إلى شبكة Azure الظاهرية.|
|المرحلة 4|نشر مزرعة SharePoint في Azure.|
|المرحلة 5|قم بإعداد DFSR بين المزرعتين.|
|المرحلة 6|إعداد شحن السجل إلى مزرعة الاسترداد.|
|المرحلة 7|التحقق من صحة حلول الفشل واستردادها. يشمل ذلك الإجراءات والتقنيات التالية: <br/> إيقاف شحن السجل. <br/> استعادة النسخ الاحتياطية. <br/> تتبع ارتباطات المحتوى. <br/> استرداد الخدمات. <br/> إدارة سجلات DNS.|

## <a name="phase-1-design-the-disaster-recovery-environment"></a>المرحلة 1: تصميم بيئة استرداد البيانات في حالات الكوارث

استخدم الإرشادات في [Microsoft Azure Architectures SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) لتصميم بيئة الاسترداد بعد الكوارث، بما في ذلك SharePoint الاسترداد. يمكنك استخدام الرسومات في SharePoint حل استرداد البيانات بعد الكوارث في [ملف azure](https://go.microsoft.com/fwlink/p/?LinkId=392554) Visio لبدء عملية التصميم. نوصي بتصميم البيئة بأكملها قبل بدء أي عمل في بيئة Azure.

بالإضافة إلى الإرشادات المتوفرة في [Microsoft Azure Architectures ل SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) لتصميم الشبكة الظاهرية واتصال VPN و Active Directory ومزرعة SharePoint، تأكد من إضافة دور مشاركة ملف إلى بيئة Azure.

لدعم شحن السجلات في حل استرداد حالات الكوارث، يضاف جهاز ظاهري لمشاركة ملف إلى الشبكة الفرعية حيث تتواجد أدوار قاعدة البيانات. تعمل مشاركة الملف أيضا كالعقدة الثالثة ل "غالبية العقدة" SQL Server توفر AlwaysOn. هذا هو التكوين المستحسن لمزرعة SharePoint تستخدم مجموعات التوفر SQL Server AlwaysOn.

> [!NOTE]
> من المهم مراجعة المتطلبات الأساسية لقاعدة بيانات للمشاركة في مجموعة توفر SQL Server AlwaysOn. لمزيد من المعلومات، راجع المتطلبات الأساسية والقيود [التوصيات مجموعات التوفر دائما](/sql/database-engine/availability-groups/windows/prereqs-restrictions-recommendations-always-on-availability).

**الشكل: تعيين موضع خادم الملفات المستخدم لحل استرداد البيانات في حالات الكوارث**

![إظهار ملف مشاركة VM مضافة إلى الخدمة السحابية نفسها التي تحتوي على SharePoint خادم قاعدة البيانات.](../media/AZenv-FSforDFSRandWSFC.png)

في هذا الرسم التخطيطي، يضاف جهاز ظاهري لمشاركة ملف إلى الشبكة الفرعية نفسها في Azure التي تحتوي على أدوار خادم قاعدة البيانات. لا تضيف الملف مشاركة الجهاز الظاهري إلى مجموعة توفر مع أدوار خوادم أخرى، مثل أدوار SQL Server الأخرى.

إذا كنت قلقا بشأن التوفر العالي للسجلات، فنظر في اتباع نهج مختلف باستخدام SQL Server النسخ الاحتياطي والاستعادة مع Azure Blob Storage [الخدمة](/sql/relational-databases/backup-restore/sql-server-backup-and-restore-with-microsoft-azure-blob-storage-service). هذه ميزة جديدة في Azure تقوم بحفظ السجلات مباشرة إلى عنوان URL لتخزين البيانات. لا يتضمن هذا الحل إرشادات حول استخدام هذه الميزة.

عند تصميم مزرعة الاسترداد، تذكر أن بيئة استرداد الكوارث الناجحة تعكس بدقة مزرعة الإنتاج التي تريد استردادها. لا يكون حجم مزرعة الاسترداد هو الشيء الأكثر أهمية في تصميم مزرعة الاسترداد ونشرها واختبارها. يختلف مقياس المزرعة من مؤسسة إلى أخرى استنادا إلى متطلبات العمل. قد يكون من الممكن استخدام مزرعة صغيرة الحجم لفترة انقطاع قصيرة أو حتى تتطلب متطلبات الأداء والقدرة مقياس المزرعة.

قم بتكوين مزرعة الاسترداد بقدر الإمكان لمزرعة الإنتاج بحيث تلبي متطلبات اتفاقية مستوى الخدمة (SLA) وتوفر الوظائف التي تحتاج إليها لدعم أعمالك. عند تصميم بيئة الاسترداد بعد الكوارث، انظر أيضا إلى عملية إدارة التغيير لبيئة الإنتاج. نوصي بتوسيع عملية إدارة التغيير إلى بيئة الاسترداد عن طريق تحديث بيئة الاسترداد في الفاصل الزمني نفسه كبيئة الإنتاج. كجزء من عملية إدارة التغيير، نوصي بالاحتفاظ بمخزون تفصيلي لتكوين المزرعة والتطبيقات والمستخدمين.

## <a name="phase-2-create-the-azure-virtual-network-and-vpn-connection"></a>المرحلة الثانية: إنشاء شبكة Azure الظاهرية واتصال VPN

[الاتصال شبكة موقعة على شبكة Microsoft Azure](connect-an-on-premises-network-to-a-microsoft-azure-virtual-network.md) الظاهرية إلى كيفية تخطيط الشبكة الظاهرية ونشرها في Azure وكيفية إنشاء اتصال VPN. اتبع الإرشادات في الموضوع لإكمال الإجراءات التالية:

- تخطيط مساحة عنوان IP الخاصة Virtual Network.

- تخطيط تغييرات البنية الأساسية التوجيه Virtual Network.

- تخطيط قواعد جدار الحماية لحركة المرور من جهاز VPN الداخلي وإلحامه.

- إنشاء الشبكة الظاهرية المحلية في Azure.

- تكوين التوجيه بين الشبكة المحلية Virtual Network.

## <a name="phase-3-deploy-active-directory-and-domain-name-services-to-the-azure-virtual-network"></a>المرحلة 3: نشر خدمات اسم المجال و Active Directory إلى شبكة Azure الظاهرية

تتضمن هذه المرحلة نشر كل من Windows Server Active Directory و DNS إلى Virtual Network في سيناريو مختلط كما هو موضح في [هندسة Microsoft Azure ل SharePoint 2013](microsoft-azure-architectures-for-sharepoint-2013.md) وكما هو موضح في الشكل التالي.

**الشكل: تكوين مجال Active Directory المختلط**

![جهازان ظاهريان تم نشرهم إلى شبكة Azure الظاهرية وشبكة المزرعة الفرعية SharePoint هي وحدات تحكم المجال المتماثلة وخادمات DNS.](../media/AZarch-HyADdomainConfig.png)

في الرسم التوضيحي، يتم نشر جهازين ظاهريين على الشبكة الفرعية نفسها. كل جهاز من هذه الأجهزة الظاهرية يستضيف دورين: Active Directory و DNS.

قبل نشر Active Directory في Azure، اقرأ إرشادات نشر Windows [Server Active Directory على Azure 虛擬機器](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100). تساعدك هذه الإرشادات على تحديد ما إذا كنت بحاجة إلى تصميم مختلف أو إعدادات تكوين مختلفة لحلك.

للحصول على إرشادات مفصلة حول إعداد وحدة تحكم المجال في Azure، راجع تثبيت وحدة تحكم نسخة متماثلة Active Directory ドメイン في [Azure Virtual Networks](/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100).

قبل هذه المرحلة، لم تنشر الأجهزة الظاهرية في Virtual Network. من المرجح ألا تكون الأجهزة الظاهرية لاستضافة Active Directory و DNS هي أكبر الأجهزة الظاهرية التي تحتاج إليها للحل. قبل نشر هذه الأجهزة الظاهرية، قم أولا بإنشاء أكبر جهاز ظاهري تخطط لاستخدامه في Virtual Network. يساعد ذلك على ضمان وصول الحل إلى علامة في Azure تسمح بالحجم الأكبر الذي تحتاجه. لست بحاجة إلى تكوين هذا الجهاز الظاهري في الوقت نفسه. ما عليك سوى إنشائها، وتركها جانبا. إذا لم تفعل ذلك، فقد تجد قيودا عند محاولة إنشاء أجهزة ظاهرية أكبر في وقت لاحق، مما كان مشكلة في وقت كتابة هذه المقالة.

## <a name="phase-4-deploy-the-sharepoint-recovery-farm-in-azure"></a>المرحلة 4: نشر مزرعة SharePoint في Azure

انتشر SharePoint في Virtual Network وفقا لخطط التصميم. قد يكون من المفيد مراجعة التخطيط SharePoint [2013 على Azure Infrastructure Services](/previous-versions/azure/dn275958(v=azure.100)) قبل نشر SharePoint في Azure.

فكر في الممارسات التالية التي تعلمناها من خلال بناء بيئة إثبات المبدأ لدينا:

- يمكنك إنشاء أجهزة ظاهرية باستخدام Azure-Portal PowerShell.

- لا يدعم Hyper-V Azure والذاكرة الديناميكية. تأكد من وضع هذا في الاعتبار في خطط السعة والأداء.

- قم بإعادة تشغيل الأجهزة الظاهرية من خلال واجهة Azure، وليس من تسجيل الماكينة الظاهرية نفسه. يعمل استخدام واجهة Azure بشكل أفضل ويمكن توقعه بشكل أكبر.

- إذا كنت تريد إيقاف تشغيل جهاز ظاهري لتوفير التكاليف، فاستخدم واجهة Azure. إذا قمت بإيقاف تشغيل تسجيل الوصول من الجهاز الظاهري، تستمر الرسوم في التراكم.

- استخدم اصطلاح تسمية الأجهزة الظاهرية.

- انتبه إلى موقع مركز البيانات الذي يتم نشر الأجهزة الظاهرية فيه.

- ميزة التحجيم التلقائية في Azure غير معتمدة SharePoint الأدوار.

- لا تقوم بتكوين العناصر في المزرعة التي سيتم استعادتها، مثل مجموعات المواقع.

## <a name="phase-5-set-up-dfsr-between-the-farms"></a>المرحلة 5: إعداد DFSR بين مزارع

لإعداد النسخ المتماثل للملفات باستخدام DFSR، استخدم الأداة الإضافية إدارة DNS. ومع ذلك، قبل إعداد DFSR، سجل دخولك إلى خادم الملفات في الموقع وخادم ملف Azure وتمكين الخدمة في Windows.

من لوحة 伺服器管理員، أكمل الخطوات التالية:

- تكوين الخادم المحلي.

- ابدأ تشغيل **معالج إضافة أدوار وميزات**.

- افتح **عقدة خدمات التخزين والملفات** .

- حدد **مساحات اسم DFS** **ونسخ DFS المتماثل**.

- انقر **فوق التالي** لإنهاء خطوات المعالج.

يوفر الجدول التالي ارتباطات إلى مقالات مراجع DFSR ومن المنشورات على المدونة.

**جدول: مقالات مرجعية ل DFSR**

|العنوان|الوصف|
|---|---|
|[النسخ المتماثل](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc770278(v=ws.11))|موضوع TechNet لإدارة DFS مع ارتباطات للتكرار|
|[النسخ المتماثل ل DFS: دليل البقاء على قيد الحياة](https://go.microsoft.com/fwlink/p/?LinkId=392737)|Wiki مع ارتباطات إلى معلومات DFS|
|[النسخ المتماثل ل DFS: الأسئلة التي يتم طرحها بشكل متكرر](/previous-versions/windows/it-pro/windows-server-2003/cc773238(v=ws.10))|موضوع DFS Replication TechNet|
|[مدونة جوزيه باريتو](/archive/blogs/josebda/)|مدونة مكتوبة بواسطة مدير برنامج رئيسي في فريق File Server في Microsoft|
|[فريق التخزين في Microsoft - مدونة خزانة الملفات](https://go.microsoft.com/fwlink/p/?LinkId=392740)|مدونة حول خدمات الملفات وميزات التخزين في Windows Server|

## <a name="phase-6-set-up-log-shipping-to-the-recovery-farm"></a>المرحلة 6: إعداد شحن السجل إلى مزرعة الاسترداد

شحن السجلات هو المكون المهم لإعداد استرداد حالات الكوارث في هذه البيئة. يمكنك استخدام شحن السجلات لإرسال ملفات سجلات المعاملات لقواعد البيانات تلقائيا من مثيل خادم قاعدة بيانات أساسي إلى مثيل خادم قاعدة بيانات ثانوي. لإعداد شحن السجل، راجع تكوين شحن السجل [في SharePoint 2013](/sharepoint/administration/configure-log-shipping).

> [!IMPORTANT]
> يقتصر دعم تسجيل الشحن في SharePoint Server على قواعد بيانات معينة. لمزيد من المعلومات، راجع خيارات التوفر العالي المعتمدة واسترداد SharePoint [البيانات (SharePoint 2013)](/SharePoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas).

## <a name="phase-7-validate-failover-and-recovery"></a>المرحلة 7: التحقق من صحة الفشل والاستعادة

الهدف من هذه المرحلة النهائية هو التحقق من أن حل استرداد الكوارث يعمل كما هو مخطط له. ولفعل ذلك، أنشئ حدثا فوق الفشل يغلق مزرعة الإنتاج ويبدأ العمل في مزرعة الاسترداد كبديل. يمكنك بدء سيناريو الفشل يدويا أو باستخدام البرامج النصية.

الخطوة الأولى هي إيقاف طلبات المستخدمين الواردة للحصول على خدمات المزرعة أو المحتوى. يمكنك القيام بذلك من خلال تعطيل إدخالات DNS أو عن طريق إيقاف تشغيل خوادم الويب الأمامية. بعد أن تكون المزرعة "أسفل"، يمكنك الفشل في الوصول إلى مزرعة الاسترداد.

### <a name="stop-log-shipping"></a>إيقاف شحن السجل

يجب إيقاف شحن السجلات قبل استرداد المزرعة. يمكنك إيقاف شحن السجل على الخادم الثانوي في Azure أولا، ثم إيقافه على الخادم الأساسي في الموقع. استخدم البرنامج النصي التالي لإيقاف شحن السجل على الخادم الثانوي أولا ثم على الخادم الأساسي. قد تختلف أسماء قواعد البيانات في البرنامج النصي، استنادا إلى بيئتك.

```
-- This script removes log shipping from the server.
-- Commands must be executed on the secondary server first and then on the primary server.

SET NOCOUNT ON
DECLARE  @PriDB nvarchar(max)
,@SecDB nvarchar(250)
,@PriSrv nvarchar(250)
,@SecSrv nvarchar(250)

Set @PriDB= ''
SET @PriDB = UPPER(@PriDB)
SET @PriDB = REPLACE(@PriDB, ' ', '')
SET @PriDB = '''' + REPLACE(@PriDB, ',', ''', ''') + ''''

Set @SecDB = @PriDB

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_database '' + '''''''' + prm.primary_database +  ''''''''
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_secondary '' + '''''''' + prm.Primary_Database + '''''', '''''' + sec.Secondary_Server + '''''', '''''' + sec.Secondary_database + ''''''''
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_primary_database '' + '''''''' + prm.primary_database +  ''''''''
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')

Exec ( 'Select  ''exec master..sp_delete_log_shipping_secondary_primary '' + '''''''' + prm.primary_server + '''''', '''''' + prm.primary_database +  ''''''''
from msdb.dbo.log_shipping_monitor_primary prm INNER JOIN msdb.dbo.log_shipping_primary_secondaries sec  ON  prm.primary_database=sec.secondary_database
where prm.primary_database in ( ' + @PriDB + ' )')
```

### <a name="restore-the-backups"></a>استعادة النسخ الاحتياطية

يجب استعادة النسخ الاحتياطية بالترتيب الذي تم إنشاؤها به. قبل أن تتمكن من استعادة نسخة احتياطية معينة من سجل المعاملات، يجب أولا استعادة النسخ الاحتياطية السابقة التالية دون إعادة المعاملات غير الم التزام بها (أي باستخدام):`WITH NORECOVERY`

- النسخة الاحتياطية الكاملة لقاعدة البيانات والتكامل التفاضلي الأخير - يمكنك استعادة هذه النسخ الاحتياطية، إن وجدت، التي تم أخذها قبل النسخة الاحتياطية الخاصة بسجل العمليات. قبل إنشاء النسخة الاحتياطية الكاملة أو التفاضلية لقاعدة البيانات الأخيرة، كانت قاعدة البيانات تستخدم نموذج الاسترداد الكامل أو نموذج الاسترداد المجمع.

- كل النسخ الاحتياطية لسجل المعاملات - يمكنك استعادة أي نسخ احتياطية لسجل المعاملات تم أخذها بعد النسخة الاحتياطية الكاملة لقاعدة البيانات أو النسخة الاحتياطية التفاضلية (إذا قمت باستعادة واحدة) وقبل النسخة الاحتياطية الخاصة بسجل العمليات. يجب تطبيق النسخ الاحتياطية للسجل بالتسلسل الذي تم إنشاؤها به، دون أي فجوات في سلسلة السجلات.

لاسترداد قاعدة بيانات المحتوى على الخادم الثانوي بحيث يتم عرض المواقع، قم بإزالة كل اتصالات قاعدة البيانات قبل الاسترداد. لاستعادة قاعدة البيانات، تشغيل العبارة SQL التالية.

```SQL
restore database WSS_Content with recovery
```

> [!IMPORTANT]
> عند استخدام T-SQL بشكل صريح، حدد **إما WITH NORECOVERY** أو **WITH RECOVERY** في كل بيان RESTORE لإزالة الالتباس— هذا أمر مهم جدا عند كتابة البرامج النصية. بعد استعادة النسخ الاحتياطية الكاملة والتفاضلية، يمكن استعادة سجلات المعاملات في SQL Server Management Studio. ونظرا لأن عملية شحن السجلات متوقفة بالفعل، فإن قاعدة بيانات المحتوى في حالة الاستعداد، لذلك يجب تغيير الحالة إلى الوصول الكامل.

في SQL Server Management Studio، انقر بيمين فوق قاعدة بيانات **WSS_Content**، وأشير إلى **TasksRestore** > ، ثم انقر فوق سجل **المعاملات (إذا** لم تستعيد النسخة الاحتياطية الكاملة، فهذا غير متوفر). لمزيد من المعلومات، راجع [راجع إنشاء نسخة احتياطية لسجل المعاملات (SQL Server)](/sql/relational-databases/backup-restore/restore-a-transaction-log-backup-sql-server).

### <a name="crawl-the-content-source"></a>تتبع ارتباطات مصدر المحتوى

يجب بدء تتبع ارتباطات كامل لكل مصدر محتوى لاستعادة خدمة البحث. تجدر الإشارة إلى أنك ستفقد بعض المعلومات التحليلية من المزرعة الداخلية، مثل توصيات البحث. قبل بدء عمليات تتبع الارتباطات الكاملة، استخدم Windows PowerShell cmdlet **Restore-SPEnterpriseSearchServiceApplication** وحدد قاعدة بيانات إدارة البحث التي تم شحنها مسبقا ونسخها **Search_Service__DB_\<GUID\>**. يوفر الأمر cmdlet هذا تكوين البحث وم مخططه وخصائصه المدارة وقواعده ومصادره وينشئ مجموعة افتراضية من المكونات الأخرى.

لبدء تتبع ارتباطات كامل، أكمل الخطوات التالية:

1. في SharePoint 2013 المركزية، انتقل إلى **Application ManagementService** >  **ApplicationsManage تطبيقات** >  الخدمة، ثم انقر فوق تطبيق خدمة البحث الذي تريد تتبع ارتباطاته.

2. في صفحة **إدارة البحث** ، انقر فوق **مصادر** المحتوى، وأشير إلى مصدر المحتوى الذي تريده، وانقر فوق السهم، ثم انقر فوق **بدء تتبع ارتباطات كامل**.

### <a name="recover-farm-services"></a>استرداد خدمات المزرعة

يوضح الجدول التالي كيفية استرداد الخدمات التي لديها قواعد بيانات تم شحنها بواسطة السجل، والخدمات التي لديها قواعد بيانات ولكن من غير المستحسن استعادتها باستخدام شحن السجلات، والخدمات التي لا تملك قواعد بيانات.

> [!IMPORTANT]
> لن تقوم استعادة قاعدة بيانات SharePoint في بيئة Azure باسترداد أي SharePoint لم تكن قد قمت بتثبيتها مسبقا في Azure يدويا.

**جدول: مرجع قاعدة بيانات تطبيق الخدمة**

|استعادة هذه الخدمات من قواعد البيانات التي تم شحنها بواسطة السجل|هذه الخدمات لديها قواعد بيانات، ولكننا ننصحك ببدء تشغيل هذه الخدمات دون استعادة قواعد البيانات الخاصة بها|لا تخزن هذه الخدمات البيانات في قواعد البيانات؛ بدء هذه الخدمات بعد الفشل|
|---|---|---|
|خدمة الترجمة الآلية <br/> خدمة بيانات التعريف المدارة <br/> خدمة التخزين الآمن <br/> ملف تعريف المستخدم. (يتم دعم قواعد بيانات ملف التعريف والعلامات الاجتماعية فقط. قاعدة بيانات المزامنة غير معتمدة.) <br/> خدمة الاشتراك SharePoint Microsoft Foundation الإعدادات Microsoft|تجميع بيانات الاستخدام والصحة <br/> خدمة الولاية <br/> التنفيذ التلقائي ل Word|Excel Services <br/> PerformancePoint Services <br/> PowerPoint التحويل <br/> Visio Graphics Service <br/> إدارة العمل|

يوضح المثال التالي كيفية استعادة خدمة بيانات التعريف المدارة من قاعدة بيانات.

يستخدم هذا Managed_Metadata_DB البيانات الموجودة. يتم شحن قاعدة البيانات هذه، ولكن لا يوجد تطبيق خدمة نشط في المزرعة الثانوية، لذا يجب توصيلها بعد تطبيق الخدمة في مكانه.

أولا، استخدم  `New-SPMetadataServiceApplication`، وحدد  `DatabaseName` التبديل مع اسم قاعدة البيانات التي تم استعادتها.

بعد ذلك، قم بتكوين تطبيق خدمة بيانات التعريف المدارة الجديد على الخادم الثانوي، كما يلي:

- الاسم: خدمة بيانات التعريف المدارة

- خادم قاعدة البيانات: اسم قاعدة البيانات من سجل المعاملات التي تم شحنها

- اسم قاعدة البيانات: Managed_Metadata_DB

- تجمع التطبيقات: SharePoint تطبيقات الخدمة

### <a name="manage-dns-records"></a>إدارة سجلات DNS

يجب إنشاء سجلات DNS يدويا لتشير إلى SharePoint الخاصة بك.

في معظم الحالات التي يكون لديك فيها عدة خوادم ويب أمامية، من المنطقي الاستفادة من ميزة "موازنة تحميل الشبكة" في Windows Server 2012 أو موازن تحميل الأجهزة لتوزيع الطلبات بين الخوادم الأمامية على الويب في المزرعة. يمكن أن تساعد موازنة تحميل الشبكة أيضا على تقليل المخاطر عن طريق توزيع الطلبات على الخوادم الأخرى إذا فشل أحد خوادم الويب.

عادة، عند إعداد موازنة تحميل الشبكة، يتم تعيين عنوان IP واحد إلى نظام المجموعة. بعد ذلك، يمكنك إنشاء سجل مضيف DNS في موفر DNS للشبكة يشير إلى نظام المجموعة. (بالنسبة لهذا المشروع، نضع خادم DNS في Azure لمرونته في حالة فشل مركز البيانات المحلي.) على سبيل المثال، يمكنك إنشاء سجل DNS، في DNS Manager في Active Directory  `https://sharepoint.contoso.com`، على سبيل المثال، يسمى ، يشير إلى عنوان IP لتكتل التحميل المتوازن.

للوصول الخارجي إلى مزرعة SharePoint، يمكنك إنشاء سجل مضيف على خادم DNS خارجي باستخدام عنوان URL نفسه الذي يستخدمه العملاء على إنترانت (`https://sharepoint.contoso.com`على سبيل المثال)، يشير إلى عنوان IP خارجي في جدار الحماية. (من أفضل الممارسات، باستخدام هذا المثال، إعداد DNS المنقسم بحيث يكون خادم DNS الداخلي موثوقا به ويقود الطلبات مباشرة إلى مجموعة مزرعة SharePoint، بدلا من توجيه طلبات DNS إلى خادم DNS `contoso.com` الخارجي.) يمكنك بعد ذلك تعيين عنوان IP الخارجي إلى عنوان IP الداخلي في المجموعة المحلية بحيث يعثر العملاء على الموارد التي يبحثون عنها.

من هنا، قد تواجة سيناريوهين مختلفين للاستعادة من الكوارث:

 **سيناريو المثال: لا تتوفر المزرعة SharePoint بسبب فشل الأجهزة في المزرعة SharePoint المزرعة.** في هذه الحالة، بعد إكمال خطوات الفشل إلى مزرعة Azure SharePoint، يمكنك تكوين موازنة تحميل الشبكة على خوادم الاسترداد الأمامية لمزرعة SharePoint على الويب، تماما كما فعلت مع المزرعة المحلية. يمكنك بعد ذلك إعادة توجيه سجل المضيف في موفر DNS الداخلي الخاص بك لتشير إلى عنوان IP المتجمع لمزرعة الاسترداد. تجدر الإشارة إلى أن تحديث سجلات DNS المخزنة مؤقتا على العملاء قد يستغرق بعض الوقت وأن تشير إلى مزرعة الاسترداد.

 **سيناريو المثال: يتم فقدان مركز البيانات في الموقع بشكل كامل.** قد يحدث هذا السيناريو بسبب كارثة طبيعية، مثل إطفاء حرائق أو فيض. في هذه الحالة، بالنسبة إلى مؤسسة، من المرجح أن يكون لديك مركز بيانات ثانوي مستضاف في منطقة أخرى بالإضافة إلى شبكة Azure الفرعية التي لديها خدمات الدليل الخاصة بها و DNS. كما هو الحال في سيناريو الكوارث السابق، يمكنك إعادة توجيه سجلات DNS الداخلية والخارجية لتشير إلى مزرعة azure SharePoint. مرة أخرى، لاحظ أن نشر سجل DNS قد يستغرق بعض الوقت.

إذا كنت تستخدم مجموعات مواقع ويب مسماة بالمضيف، كما هو مستحسن في بنية مجموعة المواقع الموقعة المسماة بالمضيف [ونشرها (SharePoint 2013)،](/SharePoint/administration/host-named-site-collection-architecture-and-deployment) فقد يكون لديك عدة مجموعات مواقع ويب مستضافة بواسطة تطبيق الويب نفسه في مزرعة SharePoint، مع أسماء DNS فريدة ( `https://sales.contoso.com` على سبيل المثال، و`https://marketing.contoso.com`). في هذه الحالة، يمكنك إنشاء سجلات DNS لكل مجموعة مواقع ويب تشير إلى عنوان IP الخاص بك. بعد وصول طلب إلى SharePoint على الويب، فإنها تعالج توجيه كل طلب إلى مجموعة المواقع المناسبة.

## <a name="microsoft-proof-of-concept-environment"></a>بيئة إثبات المبدأ من Microsoft

لقد صممنا بيئة إثبات المبدأ لهذا الحل واختبرناها. كان هدف التصميم لبيئة الاختبار لدينا نشر مزرعة SharePoint التي قد نعثر عليها في بيئة العملاء واستردادها. لقد قمنا بعدة افتراضات، ولكننا علمنا أن المزرعة تحتاج إلى توفير كل الوظائف الجديدة دون أي تخصيصات. تم تصميم طبولوجيا للتوفر العالي باستخدام إرشادات أفضل الممارسات من الحقل ومجموعة المنتجات.

يصف الجدول التالي Hyper-V الظاهرية التي أنشأناها وتكوينها لبيئة الاختبار المحلية.

**جدول: الأجهزة الظاهرية للاختبارات**

|اسم الخادم|الدور|التكوين|
|---|---|---|
|DC1|وحدة تحكم المجال مع Active Directory.|معالجان <br/> من 512 MB إلى 4 غيغابايت من ذاكرة الوصول العشوائي <br/> قرص ثابت 1 × 127 غيغابايت|
|RRAS|تم تكوين الخادم باستخدام دور خدمة التوجيه والوصول البعيد (RRAS).|معالجان <br/> ذاكرة الوصول العشوائي من 2 إلى 8 غيغابايت <br/> قرص ثابت 1 × 127 غيغابايت|
|FS1|خادم الملفات الذي يحتوي على أسهم للنسخ الاحتياطية ونقطة نهاية ل DFSR.|أربعة معالجات <br/> ذاكرة الوصول العشوائي من 2 إلى 12 غيغابايت <br/> قرص ثابت 1 × 127 غيغابايت <br/> 1 × 1 تيلاع القرص الثابت (SAN) <br/> قرص ثابت 1 × 750 غيغابايت|
|SP-WFE1، SP-WFE2|خوادم الويب الأمامية.|أربعة معالجات <br/> 16 غيغابايت من ذاكرة الوصول العشوائي|
|SP-APP1، SP-APP2، SP-APP3|خوادم التطبيقات.|أربعة معالجات <br/> ذاكرة الوصول العشوائي من 2 إلى 16 غيغابايت|
|SP-SQL-HA1، SP-SQL-HA2|خوادم قواعد البيانات، التي تم تكوينها SQL Server 2012 AlwaysOn التوفر لتوفير توفر عال. يستخدم هذا التكوين SP-SQL-HA1 و SP-SQL-HA2 كالنسخ المتماثلة الأساسية والثانوية.|أربعة معالجات <br/> ذاكرة الوصول العشوائي من 2 إلى 16 غيغابايت|

يصف الجدول التالي تكوينات محرك الأقراص Hyper-V الظاهرية التي أنشأناها وتكوينها للخوادم الأمامية على الويب والتطبيقات لبيئة الاختبار المحلية.

**جدول: متطلبات محرك أقراص الأجهزة الظاهرية للخوادم الأمامية على الويب والتطبيق للاختبارات المحلية**

|حرف محرك الأقراص|الحجم|اسم الدليل|المسار|
|---|---|---|---|
|C|80|محرك أقراص النظام|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\|
|E|80|محرك أقراص السجل (40 غيغابايت)|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\ MSSQL10_50.MSSQLSERVERMSSQLDATA\\\\|
|F|80|الصفحة (36 غيغابايت)|\<DriveLetter\>:\\Program Files Microsoft SQL Server\\\\ MSSQLDATA\\|

يصف الجدول التالي تكوينات محرك الأقراص Hyper-V الظاهرية التي تم إنشاؤها وتكوينها لتستخدم كخادمات قواعد بيانات في الموقع. في صفحة **数据库引擎 تكوين** البيانات، يمكنك الوصول إلى علامة التبويب **"دليل البيانات**" لتعيين الإعدادات المعروضة في الجدول التالي وتأكيدها.

**جدول: متطلبات محرك أقراص جهاز ظاهرية لخادم قاعدة البيانات للاختبارات المحلية**

|حرف محرك الأقراص|الحجم|اسم الدليل|المسار|
|---|---|---|---|
|C|80|دليل جذر البيانات|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\|
|E|500|دليل قاعدة بيانات المستخدم|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\ MSSQL10_50.MSSQLSERVERMSSQLDATA\\\\|
|F|500|دليل سجل قاعدة بيانات المستخدم|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\ MSSQL10_50.MSSQLSERVERMSSQLDATA\\\\|
|G|500|دليل Temp DB|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\ MSSQL10_50.MSSQLSERVERMSSQLDATA\\\\|
|H|500|دليل سجل Temp DB|\<DriveLetter\>:\\Program Files\\ Microsoft SQL Server\\ MSSQL10_50.MSSQLSERVERMSSQLDATA\\\\|

### <a name="setting-up-the-test-environment"></a>إعداد بيئة الاختبار

أثناء مراحل النشر المختلفة، يعمل فريق الاختبار عادة على البنية المحلية أولا ثم على بيئة Azure المقابلة. يعكس ذلك حالات العالم الحقيقي العامة التي يتم فيها تشغيل مزارع الإنتاج المحلية بالفعل. والأهم من ذلك هو أنك يجب أن تعرف حمل العمل الحالي للإنتاج، والقدرة الإنتاجية، والأداء النموذجي. بالإضافة إلى إنشاء نموذج استرداد لكارثة يمكن أن يلبي متطلبات الأعمال، يجب عليك حجم خوادم مزرعة الاسترداد لتقديم الحد الأدنى من مستوى الخدمة. في بيئة الاستعداد الباردة أو الدافئة، تكون مزرعة الاسترداد عادة أصغر من مزرعة الإنتاج. بعد أن تكون مزرعة الاسترداد مستقرة وفي مرحلة الإنتاج، يمكن توسيع المزرعة والخروج منها لتلبية متطلبات حمل العمل.

لقد قمنا بنشر بيئتنا الاختبارية في المراحل الثلاث التالية:

- إعداد البنية الأساسية المختلطة

- توفير الخوادم

- نشر مزارع SharePoint

#### <a name="set-up-the-hybrid-infrastructure"></a>إعداد البنية الأساسية المختلطة

وقد تم في هذه المرحلة إعداد بيئة مجال للمزرعة المحلية ومزرعة الاسترداد في Azure. بالإضافة إلى المهام العادية المقترنة بتكوين Active Directory، نفذ فريق الاختبار حل توجيه واتصال VPN بين البيئات.

#### <a name="provision-the-servers"></a>توفير الخوادم

بالإضافة إلى خوادم المزرعة، كان من الضروري توفير خوادم لتحكم المجال وتكوين خادم لمعالجة RRAS بالإضافة إلى VPN من موقع إلى موقع. تم توفير خادمي ملفات لخدمة DFSR، وتم توفير العديد من أجهزة الكمبيوتر العميلة للمختبرين.

#### <a name="deploy-the-sharepoint-farms"></a>نشر مزارع SharePoint

تم SharePoint مزارع جديدة على مرحلتين لتبسيط استقرار البيئة وإصلاحها، إذا لزم الأمر. خلال المرحلة الأولى، تم نشر كل مزرعة على الحد الأدنى لعدد الخوادم لكل مستوى من مستويات طبولوجيا لدعم الوظائف المطلوبة.

لقد أنشأنا خوادم قواعد البيانات SQL Server قبل إنشاء SharePoint 2013. نظرا لأنه كان نشرا جديدا، قمنا بإنشاء مجموعات التوفر قبل نشر SharePoint. لقد أنشأنا ثلاث مجموعات استنادا إلى إرشادات أفضل الممارسات في MCS.

> [!NOTE]
> إنشاء قواعد بيانات العنصر النائب بحيث يمكنك إنشاء مجموعات التوفر قبل SharePoint التثبيت. لمزيد من المعلومات، [راجع تكوين SQL Server 2012 AlwaysOn مجموعات التوفر SharePoint 2013](/SharePoint/administration/configure-an-alwayson-availability-group)

أنشأنا المزرعة وانضممنا إلى خوادم إضافية بالترتيب التالي:

- توفير SP-SQL-HA1 و SP-SQL-HA2.

- تكوين AlwaysOn وإنشاء مجموعات التوفر الثلاثة للمزرعة.

- توفير SP-APP1 لاستضافة الإدارة المركزية.

- توفير SP-WFE1 و SP-WFE2 لاستضافة ذاكرة التخزين المؤقت الموزعة.

استخدمنا  _المعلمة skipRegisterAsDistributedCachehost_ عند **psconfig.exeسطر الأوامر** . لمزيد من المعلومات، راجع تخطيط الموجزات وخدمة ذاكرة التخزين المؤقت الموزعة [في SharePoint Server 2013](/sharepoint/administration/plan-for-feeds-and-the-distributed-cache-service).

كررنا الخطوات التالية في بيئة الاسترداد:

- توفير AZ-SQL-HA1 و AZ-SQL-HA2.

- تكوين AlwaysOn وإنشاء مجموعات التوفر الثلاثة للمزرعة.

- توفير AZ-APP1 لاستضافة الإدارة المركزية.

- توفير AZ-WFE1 و AZ-WFE2 لاستضافة ذاكرة التخزين المؤقت الموزعة.

بعد تكوين ذاكرة التخزين المؤقت الموزعة وإضافه مستخدمي الاختبار واختبار المحتوى، بدأنا المرحلة الثانية من النشر. تطلب ذلك توسيع المستويات وتكوين خوادم المزرعة لدعم طبولوجيا التوفر العالي الموضحة في بنية المزرعة.

يصف الجدول التالي الأجهزة الظاهرية، و الشبكات الفرعية، و مجموعات التوفر التي قمنا بإعدادها لمزرعة الاسترداد.

**جدول: البنية الأساسية لمزرعة الاسترداد**

|اسم الخادم|الدور|التكوين|الشبكة الفرعية|مجموعة التوفر|
|---|---|---|---|---|
|spDRAD|وحدة تحكم المجال مع Active Directory|معالجان <br/> من 512 MB إلى 4 غيغابايت من ذاكرة الوصول العشوائي <br/> قرص ثابت 1 × 127 غيغابايت|sp-ADservers||
|AZ-SP-FS|خادم الملفات الذي يحتوي على أسهم للنسخ الاحتياطية ونقطة نهاية ل DFSR|تكوين A5: <br/> معالجان <br/> 14 غيغابايت من ذاكرة الوصول العشوائي <br/> قرص ثابت 1 × 127 غيغابايت <br/> قرص ثابت 1 × 135 غيغابايت <br/> قرص ثابت 1 × 127 غيغابايت <br/> قرص ثابت 1 × 150 غيغابايت|sp-databaseservers|DATA_SET|
|AZ-WFE1، AZ -WFE2|خوادم ويب الأمامية|تكوين A5: <br/> معالجان <br/> 14 غيغابايت من ذاكرة الوصول العشوائي <br/> قرص ثابت 1 × 127 غيغابايت|sp-webservers|WFE_SET|
|AZ -APP1، AZ-APP2، AZ-APP3|خوادم التطبيقات|تكوين A5: <br/> معالجان <br/> 14 غيغابايت من ذاكرة الوصول العشوائي <br/> قرص ثابت 1 × 127 غيغابايت|sp-applicationservers|APP_SET|
|AZ -SQL-HA1، AZ -SQL-HA2|خوادم قواعد البيانات والتكرارات المتماثلة الأساسية والثانوية لمجموعات التوفر AlwaysOn|تكوين A5: <br/> معالجان <br/> 14 غيغابايت من ذاكرة الوصول العشوائي|sp-databaseservers|DATA_SET|

### <a name="operations"></a>العمليات

بعد أن عمل فريق الاختبار على تثبيت بيئات المزرعة وإكمال الاختبارات الوظيفية، بدأ مهام العمليات التالية المطلوبة لتكوين بيئة الاسترداد المحلية:

- تكوين النسخ الاحتياطية الكاملة والتفاضلية.

- تكوين DFSR على خوادم الملفات التي تنقل سجلات المعاملات بين البيئة المحلية وبيئة Azure.

- تكوين شحن السجل على خادم قاعدة البيانات الأساسي.

- قم بتثبيت شحن السجل والتحقق من صحته وإصلاحه، كما تقتضي الحاجة. وقد تضمن ذلك تحديد أي سلوك قد يسبب مشاكل، مثل زمن نقل الشبكة، وتوثيقه، مما قد يؤدي إلى فشل عملية شحن السجلات أو مزامنة ملفات DFSR.

### <a name="databases"></a>قواعد البيانات

لقد كانت اختبارات الفشل التي نتبعها متبعة في قواعد البيانات التالية:

- WSS_Content

- ManagedMetadata

- ملف تعريف DB

- مزامنة DB

- Social DB

- مركز نوع المحتوى (قاعدة بيانات خاصة بمحور تخصيص نوع المحتوى Syndication)

## <a name="troubleshooting-tips"></a>تلميحات استكشاف الأخطاء وإصلاحها

يشرح القسم المشاكل التي واجهناها أثناء اختبارنا وحلولها.

### <a name="using-the-term-store-management-tool-caused-the-error-the-managed-metadata-store-or-connection-is-currently-not-available"></a>تسبب استخدام أداة إدارة مخزن المصطلحات في حدوث الخطأ، "مخزن بيانات التعريف المدارة أو الاتصال غير متوفر حاليا"."

تأكد من أن حساب تجمع التطبيقات المستخدم بواسطة تطبيق الويب لديه إذن الوصول للقراءة إلى مخزن المصطلحات.

### <a name="custom-term-sets-are-not-available-in-the-site-collection"></a>مجموعات المصطلحات المخصصة غير متوفرة في مجموعة المواقع

تحقق من اقتران تطبيق خدمة مفقود بين مجموعة مواقع المحتوى الخاصة بك و مركز نوع المحتوى. بالإضافة إلى ذلك، ضمن الشاشة بيانات التعريف المدارة **- \<site collection name\>** خصائص الاتصال، تأكد من تمكين هذا الخيار: تطبيق الخدمة هذا هو موقع التخزين الافتراضي **مجموعات مصطلحات خاصة بالأعمدة.**

### <a name="the-get-adforest-windows-powershell-command-generates-the-error-the-term-get-adforest-is-not-recognized-as-the-name-of-a-cmdlet-function-script-file-or-operable-program"></a>ينشئ Get-ADForest Windows PowerShell الخطأ، "لا يتم التعرف على المصطلح 'Get-ADForest' على أنه اسم أمر cmdlet أو الدالة أو ملف البرنامج النصي أو برنامج يمكن تشغيله."

عند إعداد ملفات تعريف المستخدمين، تحتاج إلى اسم غابة Active Directory. في معالج إضافة أدوار وميزات، تأكد من تمكين الوحدة النمطية ل Active Directory ل Windows PowerShell (ضمن المقطع أدوات إدارة الخادم البعيد>أدوات إدارة الدور **>AD DS وأدوات AD LDS**). بالإضافة إلى ذلك، يمكنك تشغيل الأوامر التالية قبل استخدام **Get-ADForest** للمساعدة في ضمان تحميل تبعيات البرامج.

```powershell
Import-Module ServerManager
Import-Module ActiveDirectory
```

### <a name="availability-group-creation-fails-at-starting-the-alwayson_health-xevent-session-on-server-name"></a>فشل إنشاء مجموعة التوفر في بدء جلسة عمل "AlwaysOn_health" XEvent على "\<server name\>"

تأكد من وجود عقدتين من مجموعة الفشل في الحالة "لأعلى" وليس "متوقف مؤقتا" أو "متوقف".

### <a name="sql-server-log-shipping-job-fails-with-access-denied-error-trying-to-connect-to-the-file-share"></a>SQL Server فشل مهمة شحن السجل عند رفض الوصول إلى الخطأ أثناء محاولة الاتصال بمشاركة الملف

تأكد من أن SQL Server Agent قيد التشغيل ضمن بيانات اعتماد الشبكة، بدلا من بيانات الاعتماد الافتراضية.

### <a name="sql-server-log-shipping-job-indicates-success-but-no-files-are-copied"></a>SQL Server مهمة شحن سجل الدخول إلى النجاح، ولكن لا يتم نسخ أي ملفات

يحدث هذا لأن تفضيل النسخة الاحتياطية الافتراضي لمجموعة التوفر هو **Prefer Secondary**. تأكد من تشغيل مهمة شحن السجل من الخادم الثانوي لمجموعة التوفر بدلا من المهمة الأساسية؛ وإلا، ستفشل المهمة بصمت.

### <a name="managed-metadata-service-or-other-sharepoint-service-fails-to-start-automatically-after-installation"></a>فشل تشغيل خدمة بيانات التعريف المدارة (أو SharePoint أخرى) تلقائيا بعد التثبيت

قد تستغرق الخدمات عدة دقائق للبدء، استنادا إلى أداء الخادم وتحميله SharePoint الحالي. انقر **يدويا فوق بدء** الخدمة ووفر الوقت الكافي لبدء التشغيل أثناء تحديث شاشة الخدمات على الخادم أحيانا لمراقبة الحالة الخاصة بها. في حالة توقف الخدمة، قم SharePoint التسجيل التشخيصي، ثم حاول بدء الخدمة مرة أخرى، ثم تحقق من وجود أخطاء في السجل. لمزيد من المعلومات، راجع [تكوين التسجيل التشخيصي في SharePoint 2013](/sharepoint/administration/configure-diagnostic-logging)

### <a name="after-changing-dns-to-the-azure-failover-environment-client-browsers-continue-to-use-the-old-ip-address-for-the-sharepoint-site"></a>بعد تغيير DNS إلى بيئة فشل Azure، تستمر مستعرضات العميل في استخدام عنوان IP القديم لموقع SharePoint

قد لا يكون تغيير DNS مرئيا لجميع العملاء على الفور. على عميل اختباري، يمكنك تنفيذ الأمر التالي من موجه أوامر مرتفع ومحاولة الوصول إلى الموقع مرة أخرى.

```DOS
Ipconfig /flushdns
```

## <a name="additional-resources"></a>موارد إضافية

[خيارات التوفر واسترداد الكوارث المعتمدة لقواعد SharePoint البيانات](/sharepoint/administration/supported-high-availability-and-disaster-recovery-options-for-sharepoint-databas)

[تكوين SQL Server 2012 AlwaysOn مجموعات التوفر SharePoint 2013](/SharePoint/administration/configure-an-alwayson-availability-group)

## <a name="see-also"></a>انظر أيضاً

[مركز الحلول والهندسة من Microsoft 365](../solutions/index.yml)
