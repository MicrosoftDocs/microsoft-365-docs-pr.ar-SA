---
title: تصدير سجلات سجل التدقيق وتكوينها وعرضها
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: how-to
ms.service: O365-seccomp
ms.localizationpriority: medium
ms.collection:
- Strat_O365_IP
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: 0d4d0f35-390b-4518-800e-0c7ec95e946c
ms.custom: seo-marvel-apr2020
description: في هذه المقالة، ستتعرف على كيفية تصدير سجلات Microsoft 365 التدقيق وتكوينها وعرضها.
ms.openlocfilehash: efb71ea0ff0b7098c3524707cff101d7ba25877f
ms.sourcegitcommit: 678e827a1c3bc9f4edfc48003f9b29f7bbf20ab5
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 12/31/2021
ms.locfileid: "63566109"
---
# <a name="export-configure-and-view-audit-log-records"></a>تصدير سجلات سجل التدقيق وتكوينها وعرضها

بعد البحث في سجل التدقيق وتنزيل نتائج البحث إلى ملف CSV، يحتوي الملف على عمود يسمى **بيانات** التدقيق، الذي يحتوي على معلومات إضافية حول كل حدث. يتم تنسيق البيانات الموجودة في هذا العمود كعائن JSON، الذي يحتوي على خصائص متعددة تم تكوينها كزوج خاصية *:قيمة* مفصولة بفاصات. يمكنك استخدام ميزة تحويل JSON في محرر Power Query في Excel لتقسيم كل خاصية في كائن JSON في عمود **بيانات** التدقيق إلى أعمدة متعددة بحيث يكون لكل خاصية عمودها الخاص. يتيح لك ذلك الفرز والتصفية على واحدة أو أكثر من هذه الخصائص، مما يساعدك على تحديد موقع بيانات التدقيق المحددة التي تبحث عنها بسرعة.

## <a name="step-1-export-audit-log-search-results"></a>الخطوة 1: تصدير نتائج البحث في سجل التدقيق

الخطوة الأولى هي البحث في سجل التدقيق ثم تصدير النتائج في ملف قيم مفصولة ب فاصلة (CSV) إلى الكمبيوتر المحلي.
  
1. قم بتشغيل [بحث في سجل التدقيق](search-the-audit-log-in-security-and-compliance.md#search-the-audit-log) وراجع معايير البحث إذا لزم الأمر حتى يتم الحصول على النتائج المطلوبة.

2. في صفحة نتائج البحث، انقر فوق **ExportDownload** >  **كافة النتائج**.

   ![انقر فوق تنزيل كل النتائج.](../media/ExportAuditSearchResults.png)

   يصدر هذا الخيار كل سجلات التدقيق من البحث في سجل التدقيق الذي قمت به في الخطوة 1، ويضيف البيانات الخام من سجل التدقيق إلى ملف CSV. يستغرق إعداد ملف التنزيل عملية بحث كبيرة بعض الوقت. ستنتج الملفات الكبيرة عند البحث عن كل الأنشطة أو استخدام نطاق تاريخ عريض.

3. بعد اكتمال عملية التصدير، يتم عرض رسالة في أعلى النافذة يطالبك بفتح ملف CSV وحفظه إلى الكمبيوتر المحلي. يمكنك أيضا الوصول إلى ملف CSV في مجلد التنزيلات.

   > [!NOTE]
   > يمكنك تنزيل 50000 إدخال كحد أقصى إلى ملف CSV من عملية بحث واحدة في سجل التدقيق. إذا تم تنزيل 50000 إدخال إلى ملف CSV، يمكنك الافتراض على الأرجح أن هناك أكثر من 50000 حدث اجتمعوا مع معايير البحث. لتصدير أكثر من هذا الحد، حاول استخدام نطاق تاريخ أضيق لتقليل عدد سجلات سجل التدقيق. قد تحتاج إلى تشغيل عمليات بحث متعددة ذات نطاقات تاريخ أصغر لتصدير أكثر من 50000 إدخال.

## <a name="step-2-format-the-exported-audit-log-using-the-power-query-editor"></a>الخطوة 2: تنسيق سجل التدقيق الذي تم تصديره باستخدام محرر Power Query

الخطوة التالية هي استخدام ميزة تحويل JSON في محرر Power Query في Excel لتقسيم كل خاصية في كائن JSON في عمود **بيانات** التدقيق إلى عمودها الخاص. ثم تقوم بتصفية الأعمدة لعرض السجلات استنادا إلى قيم خصائص معينة. يمكن أن يساعدك هذا على تحديد موقع بيانات التدقيق المحددة التي تبحث عنها بسرعة.

1. افتح مصنفا فارغا في Excel Office 365 أو Excel 2019 أو Excel 2016.

2. على علامة **التبويب بيانات** ، في مجموعة **الشريط** الحصول & البيانات، انقر فوق **من النص/CSV**.

    ![على علامة التبويب بيانات، انقر فوق من نص/CSV.](../media/JSONTransformOpenCSVFile.png)

3. افتح ملف CSV الذي قمت بتنزيلها في الخطوة 1.

4. في النافذة المعروضة، انقر فوق **تحويل البيانات**.

   ![انقر فوق تحويل البيانات.](../media/JSONOpenPowerQuery.png)

   يتم فتح ملف CSV في **محرر الاستعلام**. هناك أربعة أعمدة: **CreationDate** و **UserIds** **و Operations** و **AuditData**. العمود **AuditData** هو كائن JSON يحتوي على خصائص متعددة. الخطوة التالية هي إنشاء عمود لكل خاصية في كائن JSON.

5. انقر بضغطة زر الماوس الأيمن فوق العنوان في العمود **بيانات** التدقيق، وانقر فوق **تحويل**، ثم انقر فوق **JSON**. 

   ![انقر ب الماوس الأيمن فوق العمود بيانات التدقيق، وانقر فوق تحويل، ثم حدد JSON.](../media/JSONTransform.png)

6. في الزاوية العلوية اليسرى من عمود **بيانات** التدقيق، انقر فوق أيقونة التوسع.

   ![في العمود بيانات التدقيق، انقر فوق أيقونة التوسع.](../media/JSONTransformExpandIcon.png)

   يتم عرض قائمة جزئية بالخصائص الموجودة في كائنات JSON في **عمود بيانات** التدقيق.

7. انقر **فوق تحميل المزيد** لعرض كل الخصائص في كائنات JSON في **العمود بيانات** التدقيق.

   ![انقر فوق تحميل المزيد لعرض كل الخصائص في كائن JSON.](../media/JSONTransformLoadJSONProperties.png)

   يمكنك إلغاء تحديد خانة الاختيار بجانب أي خاصية لا تريد تضمينها. إن إزالة الأعمدة غير المفيدة في التحقيق هي طريقة جيدة لتقليل كمية البيانات المعروضة في سجل التدقيق. 

   > [!NOTE]
   > تستند خصائص JSON المعروضة في لقطة الشاشة السابقة (بعد النقر فوق تحميل **المزيد) إلى** الخصائص الموجودة في عمود **بيانات** التدقيق من أول 1000 صف في ملف CSV. إذا كانت هناك خصائص JSON مختلفة في السجلات بعد أول 1000 صف، فلن يتم تضمين هذه الخصائص (العمود المناظر) عند تقسيم عمود **بيانات** التدقيق إلى أعمدة متعددة. للمساعدة على منع حدوث ذلك، يمكنك إعادة تشغيل البحث في سجل التدقيق وتضييق معايير البحث بحيث يتم إرجاع عدد أقل من السجلات. يوجد حل بديل آخر وهو تصفية العناصر في العمود عمليات لتقليل  عدد الصفوف (قبل تنفيذ الخطوة 5 أعلاه) قبل تحويل العنصر JSON في العمود **بيانات** التدقيق.

   > [!TIP]
   > لعرض سمة داخل قائمة مثل AuditData.AffectedItems، انقر فوق الأيقونة توسيع في  الزاوية العلوية اليسرى من العمود الذي تريد سحب سمة منه، ثم حدد توسيع إلى **صف جديد**.  من هناك سيكون سجلا، كما يمكنك النقر فوق الأيقونة توسيع في الزاوية العلوية اليسرى من العمود، وعرض السمات، وتحديد الرمز الذي تريد عرضه أو استخراجه.

8. قم بوا أحد الأمور التالية لتنسيق عنوان الأعمدة التي يتم إضافتها لكل خاصية JSON محددة.

    - إلغاء تحديد خانة الاختيار استخدام اسم العمود **الأصلي** كبادرة لاستخدام اسم الخاصية JSON لأسماء الأعمدة؛ على سبيل المثال **، RecordType أو** **SourceFileName**.

    - اترك **خانة الاختيار استخدام اسم العمود الأصلي** كبادرة محددة لإضافة البادطة AuditData إلى أسماء الأعمدة؛ على سبيل المثال **، AuditData.RecordType** أو **AuditData.SourceFileName**.

9. انقر فوق **موافق**.

    يتم **تقسيم عمود بيانات** التدقيق إلى أعمدة متعددة. يتوافق كل عمود جديد مع خاصية في الكائن AuditData JSON. يحتوي كل صف في العمود على قيمة الخاصية. إذا لم تحتوي الخاصية على قيمة *، يتم عرض* القيمة null. في Excel، تكون الخلايا ذات القيم الفارغة فارغة.
  
10. على علامة **التبويب** الصفحة الرئيسية، انقر فوق **&** تحميل لإغلاق محرر Power Query وفتح ملف CSV الذي تم تحويله في Excel جديد.

## <a name="use-powershell-to-search-and-export-audit-log-records"></a>استخدام PowerShell للبحث عن سجلات سجل التدقيق وتصديرها

بدلا من استخدام أداة البحث في سجل التدقيق في مركز التوافق في Microsoft 365، يمكنك استخدام [الأمر cmdlet Search-UnifiedAuditLog](/powershell/module/exchange/search-unifiedauditlog) في Exchange Online PowerShell لتصدير نتائج عملية البحث في سجل التدقيق إلى ملف CSV. بعد ذلك، يمكنك اتباع الإجراء نفسه الموضح في الخطوة 2 لتنسيق سجل التدقيق باستخدام محرر Power Query. إحدى ميزات استخدام أمر cmdlet في PowerShell هي أنه يمكنك البحث عن أحداث من خدمة معينة باستخدام *المعلمة RecordType* . فيما يلي بعض الأمثلة حول استخدام PowerShell لتصدير سجلات التدقيق إلى ملف CSV حتى تتمكن من استخدام محرر Power Query لتحويل كائن JSON في عمود **بيانات** التدقيق كما هو موضح في الخطوة 2.

في هذا المثال، تشغيل الأوامر التالية لإرجاع كافة السجلات المرتبطة SharePoint عمليات المشاركة.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointSharingOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

يتم تصدير نتائج البحث إلى ملف CSV يسمى *PowerShellAuditlog* يحتوي على أربعة أعمدة: CreationDate و UserIds و RecordType و AuditData).

يمكنك أيضا استخدام اسم نوع السجل أو قيمة تعداده كقيمة *لمعلمة RecordType* . للحصول على قائمة بأسماء أنواع السجلات وقيم تعدادها المناظرة، راجع جدول *AuditLogRecordType* [في Office 365 API لنشاط الإدارة](/office/office-365-management-api/office-365-management-activity-api-schema#enum-auditlogrecordtype---type-edmint32).

يمكنك تضمين قيمة واحدة فقط *لمعلمة RecordType* . للبحث عن سجلات التدقيق لأنواع سجلات أخرى، يجب تشغيل الأمرين السابقين مرة أخرى لتحديد نوع سجل مختلف و إلحاق هذه النتائج إلى ملف CSV الأصلي. على سبيل المثال، يمكنك تشغيل الأمرين التاليين لإضافة أنشطة SharePoint من نطاق التاريخ نفسه إلى PowerShellAuditlog.csv الملف.

```powershell
$auditlog = Search-UnifiedAuditLog -StartDate 06/01/2019 -EndDate 06/30/2019 -RecordType SharePointFileOperation
```

```powershell
$auditlog | Select-Object -Property CreationDate,UserIds,RecordType,AuditData | Export-Csv -Append -Path c:\AuditLogs\PowerShellAuditlog.csv -NoTypeInformation
```

## <a name="tips-for-exporting-and-viewing-the-audit-log"></a>تلميحات لتصدير سجل التدقيق وعرضه

فيما يلي بعض التلميحات والأمثلة حول تصدير سجل التدقيق وعرضه قبل وبعد استخدام ميزة تحويل JSON لتقسيم عمود **بيانات** التدقيق إلى أعمدة متعددة.

- تصفية العمود **RecordType** لعرض السجلات فقط من خدمة معينة أو منطقة وظيفية معينة. على سبيل المثال، لإظهار الأحداث المتعلقة SharePoint المشاركة، يمكنك تحديد **14** (قيمة تعداد السجلات التي يتم تشغيلها بواسطة SharePoint المشاركة). للحصول على قائمة بالخدمات التي تتوافق مع قيم تعداد المعروضة في العمود **RecordType** ، راجع الخصائص المفصلة [في سجل التدقيق](detailed-properties-in-the-office-365-audit-log.md).

- تصفية العمود **عمليات** لعرض السجلات لأنشطة معينة. للحصول على قائمة لمعظم العمليات التي تتوافق مع نشاط قابل للبحث في أداة البحث في سجل التدقيق في مركز التوافق في Microsoft 365، راجع المقطع "الأنشطة التي تم تدقيقها" في البحث في [سجل التدقيق](search-the-audit-log-in-security-and-compliance.md#audited-activities).
