---
title: استخدام التدقيق المتقدم للتحقق من الحسابات الم اختراق
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
audience: Admin
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: high
ms.collection:
- M365-security-compliance
search.appverid:
- MOE150
- MET150
ms.assetid: ''
description: استخدم إجراء تدقيق علبة البريد MailItemsAccessed لإجراء عمليات التحقيق في حسابات المستخدمين التي تم اختراقها.
ms.openlocfilehash: 8bfba164bf3bfb0f4fa4bea687d0fe040cff4836
ms.sourcegitcommit: 355ab75eb7b604c6afbe9a5a1b97ef16a1dec4fc
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 02/14/2022
ms.locfileid: "63568039"
---
# <a name="use-advanced-audit-to-investigate-compromised-accounts"></a>استخدام التدقيق المتقدم للتحقق من الحسابات الم اختراق

إن حساب المستخدم الذي تم اختراقه (يسمى أيضا بالاستيلاء على *الحساب) هو* نوع من الهجمات عندما يتمكن مهاجم من الوصول إلى حساب مستخدم ويعمل كمستخدم. تتسبب هذه الأنواع من الهجمات في بعض الأحيان في حدوث أضرار أكثر مما كان يقصده المهاجم. عند التحقق من حسابات البريد الإلكتروني التي تم اختراقها، يجب أن تفترض أن عدد بيانات البريد التي تم اختراقها أكبر من العدد الذي يمكن الإشارة إليه من خلال تعقب حالة الحضور الفعلية للمهاجم. استنادا إلى نوع البيانات في رسائل البريد الإلكتروني، يجب أن تفترض أنه تم اختراق المعلومات الحساسة أو مواجهة غرامة تنظيمية ما لم تتمكن من إثبات عدم عرض المعلومات الحساسة. على سبيل المثال، تواجه المؤسسات الخاضعة للتنظيم HIPAA غرامة كبيرة إذا كان هناك دليل على أنه تم عرض معلومات حول صحة المرضى (PHI). في هذه الحالات، من غير المحتمل أن يكون المهاجمون مهتمين ب PHI، ولكن لا يزال يتعين على المؤسسات الإبلاغ عن خروقات البيانات ما لم تتمكن من إثبات عكس ذلك.

لمساعدتك في التحقق من حسابات البريد الإلكتروني التي تم اختراقها، نعمل الآن على تدقيق الوصول إلى بيانات البريد بواسطة بروتوكولات البريد والعملاء باستخدام إجراء تدقيق علبة البريد *MailItemsAccessed* . سيساعد هذا الإجراء الجديد الذي تم تدقيقه المدققين على فهم اختراقات بيانات البريد الإلكتروني بشكل أفضل، كما سيساعدك على تحديد نطاق اختراقات لعناصر بريد معينة قد يتم اختراقها. إن الهدف من استخدام إجراء التدقيق الجديد هذا هو إمكانية تأجيل التحليلات الجنائية للمساعدة على تأكيد عدم اختراق جزء معين من بيانات البريد. إذا تمكن مهاجم من الوصول إلى جزء بريد معين، Exchange Online يدقق في الحدث على الرغم من عدم وجود أي إشارة إلى أنه قد تم قراءة عنصر البريد.

## <a name="the-mailitemsaccessed-mailbox-auditing-action"></a>إجراء تدقيق علبة البريد MailItemsAccessed

الإجراء MailItemsAccessed الجديد هو جزء من وظيفة [التدقيق](advanced-audit.md) المتقدم الجديدة. إنه جزء من تدقيق علبة البريد [Exchange](/office365/securitycompliance/enable-mailbox-auditing#mailbox-auditing-actions) ويمكن تمكينه بشكل افتراضي للمستخدمين الذين تم تعيين ترخيص Office 365 أو Microsoft 365 E5 له أو المؤسسات التي التوافق في Microsoft 365 E5 اشتراك في الوظائف الإضافية.

يتناول إجراء تدقيق علبة البريد MailItemsAccessed كل بروتوكولات البريد: POP و IMAP و MAPI و EWS Exchange ActiveSync و REST. كما يتناول كلا النوعين من الوصول إلى البريد: *المزامنة* *والربط*.

### <a name="auditing-sync-access"></a>تدقيق الوصول إلى المزامنة

يتم تسجيل عمليات المزامنة فقط عند الوصول إلى علبة بريد بواسطة إصدار سطح المكتب من Outlook ل Windows أو Mac. أثناء عملية المزامنة، يقوم هؤلاء العملاء عادة بتنزيل مجموعة كبيرة من عناصر البريد من السحابة إلى كمبيوتر محلي. إن حجم التدقيق لعمليات المزامنة كبير. لذلك، بدلا من إنشاء سجل تدقيق لكل عنصر بريد تتم مزامنته، نقوم بإنشاء حدث تدقيق لمجلد البريد الذي يحتوي على العناصر التي تم مزامنتها ونفترض أن كل عناصر البريد في  المجلد المتزامن قد تم اختراقها. يتم تسجيل نوع الوصول في الحقل OperationProperties لسجل التدقيق.

راجع الخطوة 2 في القسم [استخدام سجلات التدقيق MailItemsAccessed](#use-mailitemsaccessed-audit-records-for-forensic-investigations) لتحريات الطب الشرعي للحصول على مثال لعرض نوع الوصول إلى المزامنة في سجل تدقيق.

### <a name="auditing-bind-access"></a>الوصول إلى ربط التدقيق

عملية الربط هي وصول فردي إلى رسالة بريد إلكتروني. للوصول الملزم، سيتم تسجيل InternetMessageId للرسائل الفردية في سجل التدقيق. تجمع سجلات إجراءات التدقيق MailItemsAccessed عمليات الربط ثم يتم تجميعها في سجل تدقيق واحد. يتم تجميع كل عمليات الربط التي تحدث ضمن فاصل زمني لمدة دقيقتين في سجل تدقيق واحد في حقل المجلدات ضمن الخاصية بيانات التدقيق. يتم تعريف كل رسالة تم الوصول إليها بواسطة InternetMessageId الخاص بها. يتم عرض عدد عمليات الربط التي تم تجميعها في السجل في الحقل OperationCount في الخاصية بيانات التدقيق.

راجع الخطوة 4 في القسم [استخدام سجلات التدقيق MailItemsAccessed](#use-mailitemsaccessed-audit-records-for-forensic-investigations) لتحريات الطب الشرعي للحصول على مثال لعرض نوع الوصول الملزم في سجل تدقيق.

### <a name="throttling-of-mailitemsaccessed-audit-records"></a>تدقيق سجلات التدقيق MailItemsAccessed

إذا تم إنشاء أكثر من 1000 سجل تدقيق MailItemsAccessed في أقل من 24 ساعة، سيتوقف Exchange Online عن إنشاء سجلات التدقيق لنشاط MailItemsAccessed. عندما تكون علبة البريد محدودة، لن يتم تسجيل نشاط MailItemsAccessed لمدة 24 ساعة بعد أن يتم التحكم في علبة البريد. إذا تم التحكم في علبة البريد، فهناك احتمال أن تكون علبة البريد قد تم اختراقها خلال هذه الفترة. سيتم استئناف تسجيل نشاط MailItemsAccessed بعد فترة 24 ساعة.

فيما يلي بعض الأمور التي يجب تذكرها حول التدويل:

- أقل من 1٪ من كل علب البريد في Exchange Online يتم التحكم فيها
- عندما يتم التحكم في علبة بريد، لا يتم تدقيق سوى سجلات التدقيق لنشاط MailItemsAccessed. لا تتأثر إجراءات تدقيق علبة البريد الأخرى.
- يتم التحكم في علب البريد لعمليات الربط فقط. لا يتم قيد سجلات التدقيق لعمليات المزامنة.
- إذا تم التحكم في علبة بريد، فمن المحتمل أن تفترض أنه كان هناك نشاط MailItemsAccessed لم يتم تسجيله في سجلات التدقيق.

راجع الخطوة 1 في القسم [استخدام سجلات التدقيق MailItemsAccessed](#use-mailitemsaccessed-audit-records-for-forensic-investigations) الخاصة بالتحقيقات الجنائية للحصول على مثال لعرض الخاصية IsThrottled في سجل تدقيق.

## <a name="use-mailitemsaccessed-audit-records-for-forensic-investigations"></a>استخدام سجلات التدقيق MailItemsAccessed لتحريات الطب الشرعي

يؤدي تدقيق علبة البريد إلى إنشاء سجلات تدقيق للوصول إلى رسائل البريد الإلكتروني حتى تتمكن من الثقة في أن رسائل البريد الإلكتروني لم يتم اختراقها. لهذا السبب، في الحالات التي لم نكد فيها على يقين من الوصول إلى بعض البيانات، نفترض أنه تم ذلك من خلال تسجيل كل أنشطة الوصول إلى البريد.

يتم عادة استخدام سجلات التدقيق MailItemsAccessed لأغراض التحليلات الجنائية بعد حل انتهاك البيانات وإعراب المهاجم عن المشكلة. لبدء التحقيق، يجب تحديد مجموعة علب البريد التي تم اختراقها وتحديد الإطار الزمني عندما يكون للمهاجم حق الوصول إلى علب البريد في مؤسستك. بعد ذلك، يمكنك استخدام **الأمرين cmdlets Search-UnifiedAuditLog** أو **Search-MailboxAuditLog** [في Exchange Online PowerShell](/powershell/exchange/connect-to-exchange-online-powershell) للبحث في سجلات التدقيق التي تتوافق مع انتهاك البيانات.

يمكنك تشغيل أحد الأوامر التالية للبحث عن سجلات التدقيق MailItemsAccessed:

**سجل التدقيق الموحد**:

```powershell
Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000
```

**سجل تدقيق علبة البريد**:

```powershell
Search-MailboxAuditLog -Identity <user> -StartDate 01/06/2020 -EndDate 01/20/2020 -Operations MailItemsAccessed -ResultSize 1000 -ShowDetails
```

> [!TIP]
> اختلاف أساسي واحد بين الأمرين cmdlets في أنه يمكنك استخدام **الأمر cmdlet Search-UnifiedAuditLog** للبحث عن سجلات التدقيق للنشاط الذي يقوم به مستخدم واحد أو أكثر. وذلك لأن *UserIds* هي معلمة متعددة القيم. يبحث **الأمر cmdlet Search-MailboxAuditLog** في سجل تدقيق علبة البريد لمستخدم واحد.

فيما يلي خطوات استخدام سجلات التدقيق MailItemsAccessed للتحقق من هجوم مستخدم م اختراق. تعرض كل خطوة بناء جملة الأوامر ل **cmdlets Search-UnifiedAuditLog** أو **Search-MailboxAuditLog** .

1. تحقق مما إذا كانت علبة البريد قد تم تحديدها. إذا كان الأمر كذلك، فهذا يعني أنه لم يتم تسجيل بعض سجلات تدقيق علبة البريد. في حالة وجود "تم التحكم" في أي سجلات تدقيق هي "True"، يجب أن تفترض أنه لفترة 24 ساعة بعد ذلك تم إنشاء هذا السجل، وأن أي وصول إلى علبة البريد لم يتم تدقيقه، وأن كل بيانات البريد قد تم اختراقها.

   للبحث عن سجلات MailItemsAccessed حيث تم التحكم في علبة البريد، يمكنك تشغيل الأمر التالي:

   **سجل التدقيق الموحد**:

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"IsThrottled","Value":"True"*'} | FL
   ```

   **سجل تدقيق علبة البريد**:

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*IsThrottled:True*"} | FL
   ```

2. تحقق من أنشطة المزامنة. إذا استخدم مهاجم عميل بريد إلكتروني لتنزيل الرسائل في علبة بريد، يمكنه قطع اتصال الكمبيوتر بالإنترنت والوصول إلى الرسائل محليا دون التفاعل مع الخادم. في هذه الحالة، لن يتمكن تدقيق علبة البريد من تدقيق هذه الأنشطة.

   للبحث عن سجلات MailItemsAccessed حيث تم الوصول إلى عناصر البريد بواسطة عملية مزامنة، قم بتشغيل الأمر التالي:

   **سجل التدقيق الموحد**:

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 02/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Sync"*'} | FL
   ```

   **سجل تدقيق علبة البريد**:

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Sync*"} | FL
   ```

3. تحقق من أنشطة المزامنة لتحديد وقوع أي منها في السياق نفسه الذي يستخدمه المهاجم للوصول إلى علبة البريد. يتم تعريف السياق وتمييزه بواسطة عنوان IP للكمبيوتر العميل المستخدم للوصول إلى علبة البريد وبروتوكول البريد. لمزيد من المعلومات، راجع [القسم تحديد سياقات الوصول لسجلات التدقيق](#identifying-the-access-contexts-of-different-audit-records) المختلفة.

   استخدم الخصائص المذكورة أدناه للتحقق. تقع هذه الخصائص في الخاصية AuditData أو OperationProperties. إذا كانت أي من المزامنة تحدث في السياق نفسه لنشاط المهاجم، فافترض أن المهاجم قام بمزامنة كل عناصر البريد مع العميل، مما يعني أنه تم اختراق علبة البريد بأكملها على الأرجح.

   <br>

   ****

   |الخاصية|الوصف|
   |---|---|
   |ClientInfoString|يصف البروتوكول، العميل (بما في ذلك الإصدار)|
   |ClientIPAddress|عنوان IP للجهاز العميل.|
   |SessionId|يساعد "معرِّف جلسة العمل" على التمييز بين إجراءات المهاجمين وأنشطة المستخدمين اليومية على الحساب نفسه (مفيد للحسابات التي تم اختراقها)|
   |UserId|UPN للمستخدم الذي يقرأ الرسالة.|
   |

4. تحقق من أنشطة الربط. بعد تنفيذ الخطوات 2 والخطوة 3، يمكنك أن تكون واثقا من أنه سيتم التقاط كل الوصول الآخر إلى رسائل البريد الإلكتروني من قبل المهاجم في سجلات التدقيق MailItemsAccessed التي لديها خاصية MailAccessType بقيمة "ربط".

   للبحث عن سجلات MailItemsAccessed حيث تم الوصول إلى عناصر البريد بواسطة عملية ربط، يمكنك تشغيل الأمر التالي.

   **سجل التدقيق الموحد**:

   ```powershell
   Search-UnifiedAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -UserIds <user1,user2> -Operations MailItemsAccessed -ResultSize 1000 | Where {$_.AuditData -like '*"MailAccessType","Value":"Bind"*'} | FL
   ```

   **سجل تدقيق علبة البريد**:

   ```powershell
   Search-MailboxAuditLog -StartDate 01/06/2020 -EndDate 01/20/2020 -Identity <user> -Operations MailItemsAccessed -ResultSize 10000 -ShowDetails | Where {$_.OperationProperties -like "*MailAccessType:Bind*"} | FL
   ```

   يتم تعريف رسائل البريد الإلكتروني التي تم الوصول إليها بواسطة معرف رسالة الإنترنت الخاصة بها. يمكنك أيضا التحقق لمعرفة ما إذا كانت أي سجلات تدقيق لها نفس سياق سجلات المهاجمين الآخرين. لمزيد من المعلومات، راجع [القسم تحديد سياقات الوصول لسجلات التدقيق](#identifying-the-access-contexts-of-different-audit-records) المختلفة.

   يمكنك استخدام بيانات التدقيق لعمليات الربط باستخدام طريقتين مختلفتين:

   - يمكنك الوصول إلى كل رسائل البريد الإلكتروني التي قام المهاجم بالوصول إليها أو تجميعها باستخدام InternetMessageId للعثور عليها ثم التحقق لمعرفة ما إذا كانت أي من هذه الرسائل تحتوي على معلومات حساسة.
   - استخدم InternetMessageId للبحث في سجلات التدقيق ذات الصلة بم مجموعة من رسائل البريد الإلكتروني التي قد تكون حساسة. يكون هذا الأمر مفيدا إذا كنت قلقا بشأن بعض الرسائل فقط.

## <a name="filtering-of-duplicate-audit-records"></a>تصفية سجلات التدقيق المكررة

يتم تصفية سجلات التدقيق المكررة لعمليات الربط نفسها التي تحدث في غضون ساعة واحدة من بعضها البعض لإزالة ضوضاء التدقيق. تتم أيضا تصفية عمليات المزامنة في فواصل زمنية لمدة ساعة واحدة. يحدث الاستثناء لعملية إزالة التكرار هذه إذا كانت أي من الخصائص الموضحة في الجدول التالي مختلفة بالنسبة ل InternetMessageId نفسه. إذا كانت إحدى هذه الخصائص مختلفة في عملية مكررة، يتم إنشاء سجل تدقيق جديد. يتم وصف هذه العملية بتفاصيل أكثر في المقطع التالي.

<br>

****

|الخاصية|الوصف|
|---|---|
|ClientIPAddress|عنوان IP للكمبيوتر العميل.|
|ClientInfoString|بروتوكول العميل، العميل المستخدم للوصول إلى علبة البريد.|
|ParentFolder|مسار المجلد الكامل الخاص عنصر البريد الذي تم الوصول إليه.|
|Logon_type|نوع تسجيل تسجيل المستخدم الذي قام بتنفيذ الإجراء. أنواع تسجيلات تسجيل المشاركة (وقيمة Enum المطابقة لها) هي المالك (0) أو المسؤول (1) أو المفوض (2).|
|MailAccessType|سواء كان الوصول عملية ربط أو مزامنة.|
|MailboxUPN|UPN لعلبة البريد حيث توجد الرسالة التي يتم قراءتها.|
|User|UPN للمستخدم الذي يقرأ الرسالة.|
|SessionId|يساعد "معرِّف جلسة العمل" على التمييز بين إجراءات المهاجم وأنشطة المستخدم اليومية في علبة البريد نفسها (في حالة اختراق الحساب) للحصول على مزيد من المعلومات حول الجلسات، راجع سياق نشاط المهاجم داخل جلسات العمل [في](https://techcommunity.microsoft.com/t5/exchange-team-blog/contextualizing-attacker-activity-within-sessions-in-exchange/ba-p/608801) Exchange Online.|
|

## <a name="identifying-the-access-contexts-of-different-audit-records"></a>تحديد سياقات الوصول لسجلات التدقيق المختلفة

من الشائع أن يتمكن مهاجم من الوصول إلى علبة بريد في الوقت نفسه الذي يتمكن فيه مالك علبة البريد من الوصول إليها. للتمييز بين الوصول من قبل المهاجم ومالك علبة البريد، هناك خصائص سجل التدقيق التي تحدد سياق الوصول. كما هو موضح مسبقا، عندما تكون قيم هذه الخصائص مختلفة، حتى عندما يحدث النشاط ضمن الفاصل الزمني للتقريب، يتم إنشاء سجلات تدقيق منفصلة. في المثال التالي، هناك ثلاثة سجلات تدقيق مختلفة. يتم تمييز كل واحد من خلال خصائص "ID جلسة العمل" و"ClientIPAddress". يتم أيضا تحديد الرسائل التي تم الوصول إليها.

<br>

****

|سجل التدقيق 1|سجل التدقيق 2|سجل التدقيق 3|
|---|---|---|
|ClientIPAddress1<br/>**SessionId2**|ClientIPAddress2<br/>**SessionId2**|ClientIPAddress1<br/>**SessionId3**|
|InternetMessageIdA<br/>InternetMessageIdD<br/>InternetMessageIdE<br/>InternetMessageIdF<br/>|InternetMessageIdA<br/>InternetMessageIdC|InternetMessageIdB|
|

إذا كانت أي من الخصائص المدرجة في الجدول في المقطع السابق [](#filtering-of-duplicate-audit-records) مختلفة، يتم إنشاء سجل تدقيق منفصل لتعقب السياق الجديد. سيتم فرز الوصولات في سجلات التدقيق المنفصلة استنادا إلى السياق الذي تم فيه النشاط.

على سبيل المثال، في سجلات التدقيق الموضحة في لقطة الشاشة التالية، على الرغم من أننا نقوم بالوصول إلى البريد من EWSEditor و OWA في الوقت نفسه، يتم تنظيم نشاط الوصول في سجلات تدقيق مختلفة استنادا إلى السياق الذي تم فيه الوصول. في هذه الحالة، يتم تعريف السياق بواسطة قيم مختلفة للممتلكات ClientInfoString.

![سجلات تدقيق مختلفة استنادا إلى السياق.](../media/MailItemsAccessed4.png)

فيما يلي بناء جملة الأمر الموضح في لقطة الشاشة السابقة:

```powershell
Search-MailboxAuditLog -Identity admin -ShowDetails -Operations MailItemsAccessed -ResultSize 2000 | Select LastAccessed,Operation,AuditOperationsCountInAggregatedRecord,ClientInfoString
```
