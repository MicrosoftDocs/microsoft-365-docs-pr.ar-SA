---
title: استخدام تدقيق المشاركة في سجل التدقيق
f1.keywords:
- NOCSH
ms.author: markjjo
author: markjjo
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: medium
search.appverid:
- SPO160
- MOE150
- BCS160
- MET150
ms.collection:
- M365-security-compliance
- SPO_Content
ms.assetid: 50bbf89f-7870-4c2a-ae14-42635e0cfc01
description: يمكن للمسؤول معرفة كيفية استخدام تدقيق المشاركة في Microsoft 365 التدقيق لتحديد الموارد المشتركة مع مستخدمين من خارج المؤسسة.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: ff05b655617608332b4b838e07a6af55e8b4d010
ms.sourcegitcommit: d4b867e37bf741528ded7fb289e4f6847228d2c5
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 10/06/2021
ms.locfileid: "63566138"
---
# <a name="use-sharing-auditing-in-the-audit-log"></a>استخدام تدقيق المشاركة في سجل التدقيق

المشاركة هي نشاط رئيسي في SharePoint عبر الإنترنت OneDrive for Business، وهي مستخدمة على نطاق واسع في المؤسسات. يمكن للمسؤولين استخدام تدقيق المشاركة في سجل التدقيق لتحديد كيفية استخدام المشاركة في المؤسسة. 
  
## <a name="the-sharepoint-sharing-schema"></a>مخطط SharePoint مشاركة

تختلف أحداث المشاركة (بما في ذلك الأحداث المتعلقة ب نهج المشاركة والروابط المشاركة) عن الأحداث ذات الصلة بالملفات والمجلدات بطريقة أساسية واحدة: يقوم أحد المستخدمين بتنفيذ إجراء له تأثير على مستخدم آخر. على سبيل المثال، عندما يمنح المستخدم A المورد المستخدم ب حق الوصول إلى ملف. في هذا المثال، المستخدم A هو المستخدم  *الذي*  يعمل والمستخدم B هو  *المستخدم الهدف*. في SharePoint ملف، يؤثر إجراء المستخدم المتصرف فقط على الملف نفسه. عندما يفتح المستخدم A ملفا، تكون المعلومات الوحيدة المطلوبة في الحدث **FileAccessed** هي المستخدم الذي يعمل. لمعالجة هذا الاختلاف، يوجد مخطط منفصل، *يسمى* مخطط SharePoint مشاركة، الذي يلتقط المزيد من المعلومات حول أحداث المشاركة. يضمن ذلك أن يكون للمسؤولين إمكانية الرؤية في الأشخاص الذين شاركوا موردا والمستخدم الذي تمت مشاركة المورد معه. 
  
يوفر مخطط المشاركة حقلين إضافيين في سجل تدقيق مرتبطين بالأحداث المشاركة: 
  
- **TargetUserOrGroupType:** تحديد ما إذا كان المستخدم أو المجموعة الهدف عضوا أو ضيفا أو SharePointGroup أو مجموعة الأمان أو الشريك.

- **TargetUserOrGroupName:** يخزن UPN أو اسم المستخدم الهدف أو المجموعة التي تمت مشاركة مورد معها (المستخدم B في المثال السابق). 

يمكن أن يروي هذان الحقلان، بالإضافة إلى الخصائص الأخرى من مخطط سجل التدقيق مثل المستخدم والتشغيل والتاريخ القصة الكاملة حول المستخدم الذي شارك المورد مع  الشخص الذي قام  بمشاركته  *ومتى*. 
  
هناك خاصية مخطط أخرى مهمة لقصه المشاركة. عند تصدير نتائج البحث في سجل التدقيق، يخزن عمود **بيانات** التدقيق في ملف CSV الذي تم تصديره معلومات حول أحداث المشاركة. على سبيل المثال، عندما يشارك مستخدم موقع مع مستخدم آخر، يتم تنفيذ ذلك بإضافة المستخدم الهدف إلى مجموعة SharePoint أخرى. **يلتقط العمود بيانات** التدقيق هذه المعلومات لتوفير سياق للمسؤولين. راجع [الخطوة 2](#step-2-use-the-powerquery-editor-to-format-the-exported-audit-log) للحصول على إرشادات حول كيفية تحليل المعلومات في **العمود بيانات** التدقيق.

## <a name="sharepoint-sharing-events"></a>SharePoint أحداث المشاركة

يتم تعريف المشاركة حسب عندما يريد مستخدم (المستخدم  الذي يعمل) مشاركة مورد مع مستخدم آخر (*المستخدم الهدف*). يتم تعريف سجلات التدقيق المتعلقة بمشاركة مورد مع مستخدم خارجي (مستخدم من خارج مؤسستك وليس لديه حساب ضيف في Azure Active Directory الخاص بالم المؤسسة) من خلال الأحداث التالية، التي يتم تسجيلها في سجل التدقيق:

- **SharingInvitationCreated:** حاول مستخدم في مؤسستك مشاركة مورد (موقع على المرجح) مع مستخدم خارجي. يؤدي ذلك إلى إرسال دعوة مشاركة خارجية إلى المستخدم الهدف. لا يتم منح حق الوصول إلى المورد في هذه المرحلة.

- **SharingInvitationAccepted:** قبل المستخدم الخارجي دعوة المشاركة المرسلة من قبل المستخدم المتصرف والآن لديه حق الوصول إلى المورد.

- **AnonymousLinkCreated:** يتم إنشاء ارتباط مجهول (يسمى أيضا ارتباط "أي شخص") لمورد. نظرا لأنه يمكن إنشاء ارتباط مجهول ثم نسخه، فمن المنطقي افتراض أنه تمت مشاركة أي مستند لديه ارتباط مجهول مع مستخدم هدف.

- **AnonymousLinkUsed:** كما يشير الاسم ضمنيا، يتم تسجيل هذا الحدث عند استخدام ارتباط مجهول للوصول إلى مورد. 

- **SecureLinkCreated:** أنشأ المستخدم "ارتباط أشخاص محددين" لمشاركة مورد مع شخص معين. قد يكون هذا المستخدم الهدف شخصا من خارج مؤسستك. يتم تعريف الشخص الذي تمت مشاركة المورد معه في سجل التدقيق **لحدث AddedToSecureLink** . تكون الطوابع الزمنية لهتين الحدثين متطابقة تقريبا.

- **AddedToSecureLink:** تم إضافة مستخدم إلى ارتباط أشخاص معين. استخدم **الحقل TargetUserOrGroupName** في هذا الحدث لتحديد المستخدم الذي أضافه إلى ارتباط الأشخاص المحدد المناظر. قد يكون هذا المستخدم الهدف شخصا من خارج مؤسستك.

## <a name="sharing-auditing-work-flow"></a>مشاركة تدفق عمل التدقيق
  
عندما يريد مستخدم (المستخدم الذي يعمل) مشاركة مورد مع مستخدم آخر (المستخدم الهدف)، يتحقق SharePoint (أو OneDrive for Business) أولا من ما إذا كان عنوان البريد الإلكتروني للمستخدم الهدف مقترن بالفعل باستخدام حساب مستخدم في دليل المؤسسة. إذا كان المستخدم الهدف في الدليل (وكان لديه حساب مستخدم ضيف مقابل)، SharePoint يقوم بما يلي:
  
-  يعين على الفور أذونات المستخدم الهدف للوصول إلى المورد عن طريق إضافة المستخدم الهدف إلى مجموعة SharePoint المناسبة، ويسجل حدث **AddedToGroup**. 
    
- يرسل إعلام مشاركة إلى عنوان البريد الإلكتروني للمستخدم الهدف.
    
- تسجيل حدث **SharingSet** . يحتوي هذا الحدث على اسم صديق ل "ملف أو مجلد أو موقع مشترك" ضمن أنشطة طلب  الوصول والمشاركة في أداة انتقاء الأنشطة في أداة البحث في سجل التدقيق. راجع لقطة الشاشة في [الخطوة 1](#step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file). 
    
إذا لم يكن أحد حسابات المستخدمين للمستخدم الهدف في الدليل، SharePoint يقوم بما يلي: 
    
   - سجل أحد الأحداث التالية، استنادا إلى كيفية مشاركة المورد:
   
      - **AnonymousLinkCreated**
   
      - **SecureLinkCreated**
   
      - **AddedToSecureLink** 

      - **SharingInvitationCreated** (يتم تسجيل هذا الحدث فقط عندما يكون المورد المشترك موقع)
    
   - عندما يقبل المستخدم الهدف دعوة المشاركة المرسلة إليه (بالنقر فوق الارتباط في الدعوة)، يقوم SharePoint بتسجيل حدث **SharingInvitationAccepted** وتعيين أذونات المستخدم الهدف للوصول إلى المورد. إذا تم إرسال ارتباط مجهول إلى المستخدم الهدف، يتم تسجيل الحدث **AnonymousLinkUsed** بعد أن يستخدم المستخدم الهدف الارتباط للوصول إلى المورد. بالنسبة للارتباطات الآمنة، يتم **تسجيل حدث FileAccessed** عندما يستخدم مستخدم خارجي الارتباط للوصول إلى المورد.

يتم أيضا تسجيل معلومات إضافية حول المستخدم الهدف، مثل هوية المستخدم الذي توجه الدعوة له والمستخدم الذي يقبل الدعوة. في بعض الحالات، يمكن لهؤلاء المستخدمين (أو عناوين البريد الإلكتروني) أن يكونوا مختلفين. 

## <a name="how-to-identify-resources-shared-with-external-users"></a>كيفية تحديد الموارد المشتركة مع مستخدمين خارجيين

أحد المتطلبات الشائعة للمسؤولين هو إنشاء قائمة بكل الموارد التي تمت مشاركتها مع مستخدمين من خارج المؤسسة. باستخدام مشاركة التدقيق في Office 365، يمكن للمسؤولين إنشاء هذه القائمة. إليك كيفية ذلك.
  
### <a name="step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file"></a>الخطوة 1: البحث عن أحداث المشاركة وتصدير النتائج إلى ملف CSV

الخطوة الأولى هي البحث في سجل التدقيق عن أحداث المشاركة. لمزيد من المعلومات (بما في ذلك الأذونات المطلوبة) حول البحث في سجل التدقيق، راجع [البحث في سجل التدقيق](search-the-audit-log-in-security-and-compliance.md).
  
1. انتقل إلى <https://compliance.microsoft.com>.

2. سجل الدخول باستخدام حساب العمل أو المدرسة.

3. في الجزء الأيسر من مركز التوافق في Microsoft 365، انقر فوق **تدقيق**.

    يتم **عرض** صفحة التدقيق.

4. ضمن **الأنشطة**، انقر فوق **أنشطة طلب المشاركة والوصول** للبحث عن الأحداث ذات الصلة بالمشاركة. 

    ![ضمن الأنشطة، حدد أنشطة طلب الوصول والمشاركة.](../media/46bb25b7-1eb2-4adf-903a-cc9ab58639f9.png)
  
5. حدد تاريخا ونطاقا من الوقت للعثور على أحداث المشاركة التي وقعت خلال تلك الفترة. 

6. انقر **فوق** بحث لتشغيل البحث. 

7. عند الانتهاء من تشغيل البحث وعرض النتائج، انقر فوق **تصدير النتائج** \> **تنزيل كل النتائج**.

    بعد تحديد خيار التصدير، ستطالبك رسالة في أسفل النافذة بفتح ملف CSV أو حفظه.

8. انقر **فوق** \> **حفظ حفظ باسم** واحفظ ملف CSV في مجلد على الكمبيوتر المحلي. 

### <a name="step-2-use-the-powerquery-editor-to-format-the-exported-audit-log"></a>الخطوة 2: استخدام محرر PowerQuery لتنسيق سجل التدقيق الذي تم تصديره

تتمثل الخطوة التالية في استخدام ميزة تحويل JSON في محرر Power Query في Excel لتقسيم كل خاصية في عمود **بيانات** التدقيق (الذي يتكون من كائن JSON متعدد الممتلكات) إلى عمودها الخاص. يتيح لك ذلك تصفية الأعمدة لعرض السجلات ذات الصلة بالمشاركة

للحصول على إرشادات مفصلة خطوة بخطوة، راجع "الخطوة 2: تنسيق سجل التدقيق الذي تم تصديره باستخدام محرر Power Query" في تصدير سجلات سجل التدقيق وتكوينها [وعرضها](export-view-audit-log-records.md#step-2-format-the-exported-audit-log-using-the-power-query-editor).

### <a name="step-3-filter-the-csv-file-for-resources-shared-with-external-users"></a>الخطوة 3: تصفية ملف CSV للموارد المشتركة مع مستخدمين خارجيين

الخطوة التالية هي تصفية CSV للأحداث المختلفة ذات الصلة بالمشاركة التي تم وصفها مسبقا في SharePoint [أحداث](#sharepoint-sharing-events) المشاركة. بدلا من ذلك، يمكنك تصفية العمود **TargetUserOrGroupType** لعرض كافة السجلات حيث تكون قيمة هذه الخاصية **ضيف.** 

بعد اتباع الإرشادات الواردة في الخطوة السابقة لتحضير ملف CSV باستخدام محرر PowerQuery، قم بما يلي:
    
1. افتح Excel الملف الذي أنشأته في الخطوة 2. 

2. على علامة **التبويب الصفحة** الرئيسية **، انقر فوق & عامل** التصفية، ثم انقر فوق **تصفية**.
    
3. في القائمة **المنسدلة &** تصفية الفرز في العمود عمليات،  قم بمسح كل التحديدات، ثم حدد حدثا واحدا أو أكثر من الأحداث التالية ذات الصلة بالمشاركة، ثم انقر فوق **موافق**.
 
   - **SharingInvitationCreated**
   
   - **AnonymousLinkCreated**
   
   - **SecureLinkCreated**
   
   - **AddedToSecureLink** 
    
    Excel عرض الصفوف الخاصة بالأحداث التي حددتها.
    
4. انتقل إلى العمود المسمى **TargetUserOrGroupType** وحدده. 
    
5. في القائمة **المنسدلة &** تصفية الفرز، قم بمسح كل التحديدات، ثم حدد **TargetUserOrGroupType:Guest**، ثم انقر فوق **موافق**.
    
    يعرض Excel الآن صفوف مشاركة الأحداث AND حيث يكون المستخدم الهدف خارج مؤسستك، لأن المستخدمين الخارجيين يتم تعريفهم بواسطة القيمة **TargetUserOrGroupType:Guest**. 
  
> [!TIP]
> بالنسبة لسجلات التدقيق التي يتم عرضها، يحدد العمود **ObjectId** المورد الذي تمت مشاركته مع المستخدم الهدف؛ على سبيل المثال  `ObjectId:https:\/\/contoso-my.sharepoint.com\/personal\/sarad_contoso_com\/Documents\/Southwater Proposal.docx`.
