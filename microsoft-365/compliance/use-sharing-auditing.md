---
title: استخدام تدقيق المشاركة في سجل التدقيق
f1.keywords:
- NOCSH
ms.author: v-tophillips
author: v-tophillips
manager: laurawi
ms.date: ''
audience: Admin
ms.topic: article
ms.service: O365-seccomp
ms.localizationpriority: medium
search.appverid:
- SPO160
- MOE150
- BCS160
- MET150
ms.collection:
- M365-security-compliance
- SPO_Content
ms.assetid: 50bbf89f-7870-4c2a-ae14-42635e0cfc01
description: يمكن مسؤول معرفة كيفية استخدام تدقيق المشاركة في سجل تدقيق Microsoft 365 لتحديد الموارد المشتركة مع مستخدمين من خارج المؤسسة.
ms.custom: seo-marvel-apr2020
ms.openlocfilehash: 1eb780f79d0dc5beaab3afcc52261bf9a4ccc25b
ms.sourcegitcommit: c29fc9d7477c3985d02d7a956a9f4b311c4d9c76
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 07/06/2022
ms.locfileid: "66625952"
---
# <a name="use-sharing-auditing-in-the-audit-log"></a>استخدام تدقيق المشاركة في سجل التدقيق

تعد المشاركة نشاطا رئيسيا في SharePoint Online OneDrive for Business، وتستخدم على نطاق واسع في المؤسسات. يمكن للمسؤولين استخدام تدقيق المشاركة في سجل التدقيق لتحديد كيفية استخدام المشاركة في مؤسستهم. 
  
## <a name="the-sharepoint-sharing-schema"></a>مخطط مشاركة SharePoint

تختلف أحداث المشاركة (دون تضمين الأحداث المتعلقة بنهج المشاركة وارتباطات المشاركة) عن الأحداث المتعلقة بالملفات والمجلدات بطريقة أساسية واحدة: يقوم مستخدم واحد بتنفيذ إجراء له تأثير على مستخدم آخر. على سبيل المثال، عندما يمنح المستخدم A مورد المستخدم B حق الوصول إلى ملف. في هذا المثال، المستخدم A هو  *المستخدم بالنيابة*  والمستخدم B هو  *المستخدم الهدف*. في مخطط ملف SharePoint، يؤثر إجراء المستخدم الذي يعمل فقط على الملف نفسه. عندما يفتح المستخدم A ملفا، فإن المعلومات الوحيدة المطلوبة في الحدث **FileAccessed** هي المستخدم الذي يعمل. لمعالجة هذا الاختلاف، يوجد مخطط منفصل، يسمى  *مخطط مشاركة SharePoint*، يلتقط مزيدا من المعلومات حول مشاركة الأحداث. يضمن ذلك أن يكون لدى المسؤولين إمكانية رؤية من شارك موردا والمستخدم الذي تمت مشاركة المورد معه. 
  
يوفر مخطط المشاركة حقلين إضافيين في سجل تدقيق مرتبط بأحداث المشاركة: 
  
- **TargetUserOrGroupType:** تحديد ما إذا كان المستخدم أو المجموعة المستهدفة عضوا أو ضيفا أو SharePointGroup أو SecurityGroup أو شريكا.

- **TargetUserOrGroupName:** يخزن UPN أو اسم المستخدم أو المجموعة المستهدفة التي تمت مشاركة مورد معها (المستخدم B في المثال السابق). 

يمكن لهذين الحقلين، بالإضافة إلى الخصائص الأخرى من مخطط سجل التدقيق مثل المستخدم والعملية والتاريخ سرد القصة الكاملة حول المستخدم *الذي* شارك *المورد* مع *من ومتى**.* 
  
هناك خاصية مخطط أخرى مهمة لقصة المشاركة. عند تصدير نتائج البحث في سجل التدقيق، يخزن عمود **AuditData** في ملف CSV الذي تم تصديره معلومات حول مشاركة الأحداث. على سبيل المثال، عندما يشارك مستخدم موقعا مع مستخدم آخر، يتم تحقيق ذلك عن طريق إضافة المستخدم الهدف إلى مجموعة SharePoint. يلتقط عمود **AuditData** هذه المعلومات لتوفير سياق للمسؤولين. راجع [الخطوة 2](#step-2-use-the-powerquery-editor-to-format-the-exported-audit-log) للحصول على إرشادات حول كيفية تحليل المعلومات في عمود **AuditData** .

## <a name="sharepoint-sharing-events"></a>أحداث مشاركة SharePoint

يتم تعريف المشاركة عندما يريد المستخدم (المستخدم *الذي يعمل* ) مشاركة مورد مع مستخدم آخر (المستخدم *الهدف* ). يتم تحديد سجلات التدقيق المتعلقة بمشاركة مورد مع مستخدم خارجي (مستخدم خارج مؤسستك وليس لديه حساب ضيف في Azure Active Directory الخاص بمؤسستك) بواسطة الأحداث التالية، التي يتم تسجيلها في سجل التدقيق:

- **SharingInvitationCreated:** حاول مستخدم في مؤسستك مشاركة مورد (من المحتمل أن يكون موقعا) مع مستخدم خارجي. يؤدي ذلك إلى إرسال دعوة مشاركة خارجية إلى المستخدم الهدف. لا يتم منح حق الوصول إلى المورد في هذه المرحلة.

- **SharingInvitationAccepted:** لقد قبل المستخدم الخارجي دعوة المشاركة التي أرسلها المستخدم بالنيابة ولديه الآن حق الوصول إلى المورد.

- **إنشاء ارتباط مجهول:** يتم إنشاء ارتباط مجهول (يسمى أيضا ارتباط "أي شخص") لمورد. نظرا لأنه يمكن إنشاء ارتباط مجهول ثم نسخه، فمن المنطقي افتراض أنه تمت مشاركة أي مستند يحتوي على ارتباط مجهول مع مستخدم مستهدف.

- **AnonymousLinkUsed:** كما يوحي الاسم، يتم تسجيل هذا الحدث عند استخدام ارتباط مجهول للوصول إلى مورد. 

- **SecureLinkCreated:** قام مستخدم بإنشاء "ارتباط أشخاص محددين" لمشاركة مورد مع شخص معين. قد يكون هذا المستخدم الهدف شخصا خارجيا عن مؤسستك. يتم تعريف الشخص الذي تمت مشاركة المورد معه في سجل التدقيق لحدث **AddedToSecureLink** . الطوابع الزمنية لهذين الحدثين متطابقة تقريبا.

- **AddedToSecureLink:** تمت إضافة مستخدم إلى ارتباط أشخاص محدد. استخدم الحقل **TargetUserOrGroupName** في هذا الحدث لتعريف المستخدم الذي تمت إضافته إلى ارتباط الأشخاص المحدد المطابق. قد يكون هذا المستخدم الهدف شخصا خارجيا عن مؤسستك.

## <a name="sharing-auditing-work-flow"></a>مشاركة تدفق عمل التدقيق
  
عندما يريد مستخدم (المستخدم بالنيابة) مشاركة مورد مع مستخدم آخر (المستخدم الهدف)، يتحقق SharePoint (أو OneDrive for Business) أولا مما إذا كان عنوان البريد الإلكتروني للمستخدم الهدف مقترنا بالفعل بحساب مستخدم في دليل المؤسسة. إذا كان المستخدم الهدف موجودا في الدليل (وكان لديه حساب مستخدم ضيف مقابل)، يقوم SharePoint بالأشياء التالية:
  
-  تعيين أذونات المستخدم الهدف على الفور للوصول إلى المورد عن طريق إضافة المستخدم الهدف إلى مجموعة SharePoint المناسبة، وتسجيل حدث **AddedToGroup** . 
    
- إرسال إعلام مشاركة إلى عنوان البريد الإلكتروني للمستخدم الهدف.
    
- تسجيل حدث **SharingSet** . يحتوي هذا الحدث على اسم مألوف ل "ملف أو مجلد أو موقع مشترك" ضمن **أنشطة طلب المشاركة والوصول** في منتقي الأنشطة لأداة البحث في سجل التدقيق. راجع لقطة الشاشة في [الخطوة 1](#step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file). 
    
إذا لم يكن حساب مستخدم للمستخدم الهدف موجودا في الدليل، فسيفعل SharePoint ما يلي: 
    
   - يسجل أحد الأحداث التالية، استنادا إلى كيفية مشاركة المورد:
   
      - **إنشاء ارتباط مجهول**
   
      - **SecureLinkCreated**
   
      - **AddedToSecureLink** 

      - **SharingInvitationCreated** (يتم تسجيل هذا الحدث فقط عندما يكون المورد المشترك موقعا)
    
   - عندما يقبل المستخدم الهدف دعوة المشاركة المرسلة إليه (بالنقر فوق الارتباط في الدعوة)، يسجل SharePoint حدث **SharingInvitationAccepted** ويعين أذونات المستخدم الهدف للوصول إلى المورد. إذا تم إرسال ارتباط مجهول إلى المستخدم الهدف، يتم تسجيل الحدث **AnonymousLinkUsed** بعد أن يستخدم المستخدم الهدف الارتباط للوصول إلى المورد. للحصول على ارتباطات آمنة، يتم تسجيل حدث **FileAccessed** عندما يستخدم مستخدم خارجي الارتباط للوصول إلى المورد.

يتم أيضا تسجيل معلومات إضافية حول المستخدم الهدف، مثل هوية المستخدم الذي تتم الدعوة إليه والمستخدم الذي يقبل الدعوة. في بعض الحالات، يمكن أن يكون هؤلاء المستخدمون (أو عناوين البريد الإلكتروني) مختلفة. 

## <a name="how-to-identify-resources-shared-with-external-users"></a>كيفية تحديد الموارد المشتركة مع مستخدمين خارجيين

أحد المتطلبات الشائعة للمسؤولين هو إنشاء قائمة بكافة الموارد التي تمت مشاركتها مع مستخدمين من خارج المؤسسة. باستخدام مشاركة التدقيق في Office 365، يمكن للمسؤولين إنشاء هذه القائمة. إليك كيفية إجراء ذلك.
  
### <a name="step-1-search-for-sharing-events-and-export-the-results-to-a-csv-file"></a>الخطوة 1: البحث عن أحداث المشاركة وتصدير النتائج إلى ملف CSV

الخطوة الأولى هي البحث في سجل التدقيق لمشاركة الأحداث. لمزيد من المعلومات (بما في ذلك الأذونات المطلوبة) حول البحث في سجل التدقيق، راجع [البحث في سجل التدقيق](search-the-audit-log-in-security-and-compliance.md).
  
1. الانتقال إل <https://compliance.microsoft.com>

2. سجل الدخول باستخدام حساب العمل أو المؤسسة التعليمية.

3. في الجزء الأيمن من مدخل التوافق في Microsoft Purview، انقر فوق **"تدقيق**".

    يتم عرض صفحة **التدقيق** .

4. ضمن **"الأنشطة"**، انقر فوق **أنشطة طلب المشاركة والوصول** للبحث عن الأحداث المتعلقة بالمشاركة. 

    ![ضمن "الأنشطة"، حدد أنشطة طلب المشاركة والوصول.](../media/46bb25b7-1eb2-4adf-903a-cc9ab58639f9.png)
  
5. حدد نطاقا زمنيا وتاريخيا للعثور على أحداث المشاركة التي حدثت خلال تلك الفترة. 

6. انقر فوق **"بحث** " لتشغيل البحث. 

7. عند الانتهاء من تشغيل البحث وعرض النتائج، انقر فوق **"تصدير النتائج** \> **" لتنزيل كافة النتائج**.

    بعد تحديد خيار التصدير، تطالبك رسالة في أسفل النافذة بفتح ملف CSV أو حفظه.

8. انقر فوق **"حفظ** \> **باسم** " واحفظ ملف CSV في مجلد على الكمبيوتر المحلي. 

### <a name="step-2-use-the-powerquery-editor-to-format-the-exported-audit-log"></a>الخطوة 2: استخدام محرر PowerQuery لتنسيق سجل التدقيق الذي تم تصديره

الخطوة التالية هي استخدام ميزة تحويل JSON في محرر Power Query في Excel لتقسيم كل خاصية في عمود **AuditData** (الذي يتكون من كائن JSON متعدد الخصائص) إلى عموده الخاص. يتيح لك ذلك تصفية الأعمدة لعرض السجلات المتعلقة بالمشاركة

للحصول على إرشادات مفصلة خطوة بخطوة، راجع "الخطوة 2: تنسيق سجل التدقيق الذي تم تصديره باستخدام محرر Power Query" في [تصدير سجلات سجل التدقيق وتكوينها وعرضها](export-view-audit-log-records.md#step-2-format-the-exported-audit-log-using-the-power-query-editor).

### <a name="step-3-filter-the-csv-file-for-resources-shared-with-external-users"></a>الخطوة 3: تصفية ملف CSV للموارد المشتركة مع مستخدمين خارجيين

الخطوة التالية هي تصفية CSV للأحداث المختلفة المتعلقة بالمشاركة التي تم وصفها مسبقا في قسم [أحداث مشاركة SharePoint](#sharepoint-sharing-events) . بدلا من ذلك، يمكنك تصفية عمود **TargetUserOrGroupType** لعرض كافة السجلات حيث تكون قيمة هذه الخاصية " **ضيف**". 

بعد اتباع الإرشادات الواردة في الخطوة السابقة لإعداد ملف CSV باستخدام محرر PowerQuery، قم بما يلي:
    
1. افتح ملف Excel الذي أنشأته في الخطوة 2. 

2. على علامة التبويب **"الشريط الرئيسي** "، انقر فوق **"فرز & عامل التصفية**"، ثم انقر فوق **"تصفية**".
    
3. في القائمة المنسدلة **"فرز & تصفية** " في عمود **"العمليات** "، امسح كافة التحديدات، ثم حدد حدثا واحدا أو أكثر من الأحداث التالية المتعلقة بالمشاركة، ثم انقر فوق **"موافق**".
 
   - **SharingInvitationCreated**
   
   - **إنشاء ارتباط مجهول**
   
   - **SecureLinkCreated**
   
   - **AddedToSecureLink** 
    
    يعرض Excel صفوف الأحداث التي حددتها.
    
4. انتقل إلى العمود المسمى **TargetUserOrGroupType** وحدده. 
    
5. في القائمة المنسدلة **"فرز & تصفية** "، قم بإلغاء تحديد كافة التحديدات، ثم حدد **TargetUserOrGroupType:Guest**، وانقر فوق **"موافق**".
    
    يعرض Excel الآن صفوف مشاركة الأحداث وحيث يكون المستخدم الهدف خارج مؤسستك، لأنه يتم تعريف المستخدمين الخارجيين بالقيمة **TargetUserOrGroupType:Guest**. 
  
> [!TIP]
> بالنسبة لسجلات التدقيق التي يتم عرضها، يحدد عمود **ObjectId** المورد الذي تمت مشاركته مع المستخدم الهدف؛ على سبيل المثال  `ObjectId:https:\/\/contoso-my.sharepoint.com\/personal\/sarad_contoso_com\/Documents\/Southwater Proposal.docx`.
