---
title: كيفية عمل المصادقة المستندة إلى SMTP DNS للكيانات المسماة (DANE) لتأمين اتصالات البريد الإلكتروني
f1.keywords:
- NOCSH
ms.author: v-mathavale
author: v-mathavale
manager: dansimp
audience: ITPro
ms.topic: reference
ms.service: O365-seccomp
ms.localizationpriority: medium
search.appverid:
- MET150
ms.collection:
- M365-security-compliance
description: تعرف على كيفية عمل المصادقة المستندة إلى SMTP DNS للكيانات المسماة (DANE) لتأمين اتصالات البريد الإلكتروني بين خوادم البريد.
ms.openlocfilehash: 2af2a166ff73bbe7888ed9265ec8733105eb2007
ms.sourcegitcommit: 9ba00298cfa9ae293e4a57650965fdb3e8ffe07b
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 04/11/2022
ms.locfileid: "64759424"
---
# <a name="how-smtp-dns-based-authentication-of-named-entities-dane-works"></a>كيفية عمل المصادقة المستندة إلى SMTP DNS للكيانات المسماة (DANE)

بروتوكول SMTP هو البروتوكول الرئيسي المستخدم لنقل الرسائل بين خوادم البريد وهو، بشكل افتراضي، غير آمن. تم تقديم بروتوكول أمان طبقة النقل (TLS) منذ سنوات لدعم الإرسال المشفر للرسائل عبر SMTP. يتم استخدامه بشكل شائع في الوقت المناسب بدلا من استخدامه كمتطلب، مما يترك الكثير من حركة مرور البريد الإلكتروني في نص واضح، وعرضة لاعتراض الجهات الفاعلة الشائنة. وعلاوة على ذلك، يحدد SMTP عناوين IP للخوادم الوجهة من خلال البنية الأساسية العامة ل DNS، والتي عرضة للانتحال وهجمات Man-in-the-Middle (MITM). وقد أدى ذلك إلى إنشاء العديد من المعايير الجديدة لزيادة الأمان لإرسال البريد الإلكتروني وتلقيه، أحد هذه المعايير هو المصادقة المستندة إلى DNS للكيانات المسماة (DANE).

يستخدم DANE ل SMTP [RFC 7672](https://tools.ietf.org/html/rfc7672) وجود سجل مصادقة أمان طبقة النقل (TLSA) في سجل DNS الخاص بمجال معين للإشارة إلى مجال ودعم خادم (خوادم) البريد DANE. إذا لم يكن هناك سجل TLSA، فإن دقة DNS لتدفق البريد ستعمل كالمعتاد دون محاولة إجراء أي عمليات فحص DANE. يشير سجل TLSA بشكل آمن إلى دعم TLS وينشر نهج DANE للمجال. لذلك، يمكن إرسال خوادم البريد بنجاح مصادقة خوادم البريد المستلمة المشروعة باستخدام SMTP DANE. وهذا يجعلها مقاومة لهجمات خفض الإصدارات وMITM. لدى DANE تبعيات مباشرة على DNSSEC، والتي تعمل عن طريق توقيع السجلات رقميا للبحث في DNS باستخدام تشفير المفتاح العام. تحدث عمليات التحقق من DNSSEC على محللات DNS المتداخلة، وهي خوادم DNS التي تقوم بإنشاء استعلامات DNS للعملاء. يضمن DNSSEC عدم العبث بسجلات DNS وأن تكون أصلية.

بمجرد إرجاع سجلات الموارد المتعلقة ب MX وA/AAAA وDNSSEC لمجال إلى محلل DNS المتداخل كمصادقة DNSSEC، سيطلب خادم البريد المرسل سجل TLSA المطابق لإدخال مضيف MX أو إدخالاته. إذا كان سجل TLSA موجودا وثبتت صحته باستخدام فحص DNSSEC آخر، فسيعيد محلل DNS المتداخل سجل TLSA إلى خادم البريد المرسل.

بعد تلقي سجل TLSA الأصلي، ينشئ خادم البريد المرسل اتصال SMTP بمضيف MX المقترن بسجل TLSA الأصلي. سيحاول خادم البريد المرسل إعداد TLS ومقارنة شهادة TLS الخاصة بالخادم بالبيانات الموجودة في سجل TLSA للتحقق من أن خادم البريد الوجهة المتصل بالمرسل هو خادم البريد المتلقي الشرعي. سيتم إرسال الرسالة (باستخدام TLS) إذا نجحت المصادقة. عند فشل المصادقة أو إذا لم يكن TLS معتمدا من قبل الخادم الوجهة، Exchange Online إعادة محاولة عملية التحقق من الصحة بأكملها بدءا من استعلام DNS للمجال الوجهة نفسه مرة أخرى بعد 15 دقيقة، ثم 15 دقيقة بعد ذلك، ثم كل ساعة لمدة 24 ساعة التالية. إذا استمرت المصادقة في الفشل بعد 24 ساعة من إعادة المحاولة، ستنتهي صلاحية الرسالة وسيتم إنشاء تقرير بعدم التسليم مع تفاصيل الخطأ وإرساله إلى المرسل.

## <a name="what-are-the-components-of-dane"></a>ما هي مكونات DANE؟

### <a name="tlsa-resource-record"></a>سجل موارد TLSA

يتم استخدام سجل مصادقة TLS (TLSA) لإقران شهادة X.509 للخادم أو قيمة المفتاح العام باسم المجال الذي يحتوي على السجل. يمكن الوثوق بسجلات TLSA فقط إذا تم تمكين DNSSEC على مجالك. إذا كنت تستخدم موفر DNS لاستضافة مجالك، فقد يكون هذا إعدادا يتم تقديمه عند تكوين مجال معه. لمعرفة المزيد حول توقيع منطقة DNSSEC، تفضل بزيارة هذا الارتباط: [نظرة عامة على DNSSEC | Microsoft Docs](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj200221(v=ws.11)).

مثال سجل TLSA:

:::image type="content" source="../media/compliance-trial/example-TLSA-record.png" alt-text="مثال على سجل TLSA" lightbox="../media/compliance-trial/example-TLSA-record.png":::

هناك أربعة حقول قابلة للتكوين فريدة لنوع سجل TLSA:

**حقل استخدام الشهادة**: يحدد كيفية التحقق من شهادة خادم البريد الإلكتروني المرسل لخادم البريد الإلكتروني الوجهة.

|قيمه|اختصار|الوصف|
|---|---|---|
|01<sup></sup>|PKIX-TA|الشهادة المستخدمة هي المرجع المصدق العام لإرساء الثقة من سلسلة الثقة X.509.|
|11<sup></sup>|PKIX-EE|الشهادة المحددة هي الخادم الوجهة؛ يجب أن تتحقق فحوصات DNSSEC من صحتها.|
|2|DANE-TA|استخدم المفتاح الخاص للخادم من شجرة X.509 التي يجب التحقق من صحتها بواسطة ارتساء الثقة في سلسلة الثقة. يحدد سجل TLSA ارتساء الثقة الذي سيتم استخدامه للتحقق من صحة شهادات TLS للمجال.|
|3|DANE-EE|تتطابق فقط مع شهادة الخادم الوجهة.|

<sup>يتبع 1</sup> Exchange Online إرشادات تنفيذ RFC التي تفيد بأنه لا يجب استخدام قيم حقل استخدام الشهادة 0 أو 1 عند تنفيذ DANE مع SMTP. عند إرجاع سجل TLSA الذي يحتوي على قيمة حقل "استخدام الشهادة" 0 أو 1 إلى Exchange Online، Exchange Online سيعامله على أنه غير قابل للاستخدام. إذا تم العثور على كافة سجلات TLSA غير قابلة للاستخدام، فلن يقوم Exchange Online بتنفيذ خطوات التحقق من صحة DANE ل 0 أو 1 عند إرسال البريد الإلكتروني. بدلا من ذلك، بسبب وجود سجل TLSA، سيفرض Exchange Online استخدام TLS لإرسال البريد الإلكتروني، أو إرسال البريد الإلكتروني إذا كان خادم البريد الإلكتروني الوجهة يدعم TLS أو إسقاط البريد الإلكتروني وإنشاء التقرير بعدم التسليم (NDR) إذا كان خادم البريد الإلكتروني الوجهة لا يدعم TLS.

في مثال سجل TLSA، يتم تعيين حقل استخدام الشهادة إلى '3'، لذلك يتم تعيين بيانات اقتران الشهادة ('abc123... ستتم مطابقة xyz789') مع شهادة الخادم الوجهة فقط.

**حقل المحدد**: يشير إلى أجزاء شهادة الخادم الوجهة التي يجب التحقق منها.

|قيمه|اختصار|الوصف|
|---|---|---|
|0|سيرت|استخدام الشهادة الكاملة.|
|1|SPKI (معلومات المفتاح العام للموضوع)|استخدم المفتاح العام للشهادة والخوارزمية التي يتم تعريف المفتاح العام لاستخدامها.|

في مثال سجل TLSA، يتم تعيين حقل المحدد إلى '1' بحيث تتم مطابقة بيانات اقتران الشهادة باستخدام المفتاح العام لشهادة الخادم الوجهة والخوارزمية التي يتم تعريف المفتاح العام لاستخدامها.

**حقل النوع المطابق**: يشير إلى التنسيق الذي سيتم تمثيل الشهادة به في سجل TLSA.

|قيمه|اختصار|الوصف|
|---|---|---|
|0|الكامل|البيانات في سجل TSLA هي الشهادة الكاملة أو SPKI.|
|1|SHA-256|البيانات في سجل TSLA هي تجزئة SHA-256 إما للشهادة أو SPKI.|
|2|SHA-512|البيانات في سجل TSLA هي تجزئة SHA-512 إما للشهادة أو SPKI.|

في مثال سجل TLSA، يتم تعيين الحقل "نوع المطابقة" إلى "1" بحيث تكون "بيانات اقتران الشهادة" عبارة عن تجزئة SHA-256 لمعلومات المفتاح العام للموضوع من شهادة الخادم الوجهة

**بيانات اقتران الشهادة**: تحدد بيانات الشهادة المستخدمة للمطابقة مقابل شهادة الخادم الوجهة. تعتمد هذه البيانات على قيمة حقل المحدد وقيمة النوع المطابقة.

في مثال سجل TLSA، يتم تعيين بيانات اقتران الشهادة إلى 'abc123.. xyz789'. نظرا لتعيين قيمة حقل المحدد في المثال إلى '1'، فإنها تشير إلى المفتاح العام لشهادة الخادم الوجهة والخوارزمية التي تم تعريفها لاستخدامها معها. وبما أن قيمة الحقل "نوع المطابقة" في المثال معينة إلى "1"، فقد تشير إلى تجزئة SHA-256 لمعلومات المفتاح العام للموضوع من شهادة الخادم الوجهة.

## <a name="how-can-exchange-online-customers-use-smtp-dane-outbound"></a>كيف يمكن للعملاء Exchange Online استخدام SMTP DANE Outbound؟

بصفتك عميلا Exchange Online، لا يوجد أي شيء تحتاج إلى القيام به لتكوين أمان البريد الإلكتروني المحسن هذا للبريد الإلكتروني الصادر. هذا شيء أنشأناه لك ويتم تشغيله بشكل افتراضي لجميع العملاء Exchange Online ويتم استخدامه عندما يعلن المجال الوجهة عن دعم DANE. لجني فوائد إرسال البريد الإلكتروني باستخدام فحوصات DNSSEC و DANE، اتصل بشركاء عملك الذين تبادل معهم البريد الإلكتروني بأنهم بحاجة إلى تنفيذ DNSSEC و DANE حتى يتمكنوا من تلقي البريد الإلكتروني باستخدام هذه المعايير.

## <a name="how-can-exchange-online-customers-use-smtp-dane-inbound"></a>كيف يمكن للعملاء Exchange Online استخدام SMTP DANE الوارد؟

حاليا، SMTP DANE الواردة غير معتمدة Exchange Online. ومن المتوقع إصدار الدعم في نهاية عام 2022.

## <a name="what-is-the-recommended-tlsa-record-configuration"></a>ما هو تكوين سجل TLSA الموصى به؟

لكل إرشادات تنفيذ RFC ل SMTP DANE، يوصى بسجل TLSA يتكون من حقل "استخدام الشهادة" المعين إلى 3، وحقل المحدد المعين إلى 1، وحقل "نوع المطابقة" المعين إلى 1.

## <a name="exchange-online-mail-flow-with-smtp-dane"></a>Exchange Online Flow البريد مع SMTP DANE

تقوم عملية تدفق البريد Exchange Online مع SMTP DANE، الموضحة في المخطط الانسيابي أدناه، بالتحقق من أمان سجل المجال والموارد من خلال DNSSEC، ودعم TLS على خادم البريد الوجهة، وأن شهادة خادم البريد الوجهة تتطابق مع ما هو متوقع استنادا إلى سجل TLSA المقترن به.

هناك سيناريوهان فقط حيث سيؤدي فشل SMTP DANE إلى حظر البريد الإلكتروني:

- أشار المجال الوجهة إلى دعم DNSSEC ولكن تم إرجاع سجل واحد أو أكثر كسجل غير معتمد.

- تحتوي جميع سجلات MX للمجال الوجهة على سجلات TLSA ولا تتطابق أي من شهادات الخادم الوجهة مع ما كان متوقعا لكل بيانات سجل TSLA، أو أن اتصال TLS غير معتمد من قبل الخادم الوجهة.

:::image type="content" source="../media/compliance-trial/mail-flow-smtp-dane.png" alt-text="Exchange تدفق البريد عبر الإنترنت مع SMTP DANE" lightbox="../media/compliance-trial/mail-flow-smtp-dane.png":::

## <a name="related-technologies"></a>التقنيات ذات الصلة

|التكنولوجيا|معلومات إضافية|
|---|---|
|**عامل نقل البريد - أمان النقل الصارم (MTA-STS)** يساعد على إجهاض هجمات إصدار التقييم والهجمات التي تتم في الوسط من خلال توفير آلية لإعداد نهج المجال التي تحدد ما إذا كان خادم البريد الإلكتروني الوجهة يدعم TLS وما يجب فعله عندما لا يمكن التفاوض على TLS، على سبيل المثال إيقاف الإرسال.|سيتم نشر مزيد من المعلومات حول دعم Exchange Online القادم ل MTA-STS الواردة والصادرة في وقت لاحق من هذا العام. <br/><br/> [Exchange Online Transport News من Microsoft Ignite 2020 - مجتمع Microsoft التقني](https://techcommunity.microsoft.com/t5/exchange-team-blog/exchange-online-transport-news-from-microsoft-ignite-2020/ba-p/1687699) <br/><br/> [rfc8461 (ietf.org)](https://datatracker.ietf.org/doc/html/rfc8461)|
|يستخدم **إطار نهج المرسل (SPF)** معلومات IP لضمان ثقة أنظمة البريد الإلكتروني الوجهة في الرسائل المرسلة من مجالك المخصص.|[كيف يمنع إطار نهج المرسل (SPF) الانتحال - Office 365 - Microsoft Docs](/microsoft-365/security/office-365-security/how-office-365-uses-spf-to-prevent-spoofing)|
|يستخدم **DomainKeys Identified Mail (DKIM)** معلومات شهادة X.509 للتأكد من أن أنظمة البريد الإلكتروني الوجهة تثق في الرسائل المرسلة الصادرة من مجالك المخصص.|[كيفية استخدام DKIM للبريد الإلكتروني في مجالك المخصص - Office 365 - Microsoft Docs](/microsoft-365/security/office-365-security/use-dkim-to-validate-outbound-email)|
|تعمل **مصادقة الرسائل وإعداد التقارير والمطابقة (DMARC) المستندة إلى المجال** مع "إطار نهج المرسل" و"البريد المعرف بواسطة DomainKeys" لمصادقة مرسلي البريد والتأكد من أن أنظمة البريد الإلكتروني الوجهة تثق في الرسائل المرسلة من مجالك.|[استخدم DMARC للتحقق من صحة البريد الإلكتروني، وخطوات الإعداد - Office 365 - Microsoft Docs](/microsoft-365/security/office-365-security/use-dmarc-to-validate-email)|

## <a name="troubleshooting-sending-emails-with-smtp-dane"></a>استكشاف أخطاء إرسال رسائل البريد الإلكتروني وإصلاحها باستخدام SMTP DANE

حاليا، هناك أربعة رموز خطأ ل DANE عند إرسال رسائل البريد الإلكتروني باستخدام Exchange Online. تقوم Microsoft بتحديث قائمة رموز الخطأ هذه بشكل نشط. ستظهر الأخطاء في:

1. مدخل مركز إدارة Exchange من خلال طريقة عرض "تفاصيل تتبع الرسائل".
2. يتم إنشاء التقارير بعدم التسليم عند عدم إرسال رسالة بسبب فشل DANE أو DNSSEC.
3. أداة محلل الاتصال عن بعد [من Microsoft Remote Connectivity Analyzer](https://testconnectivity.microsoft.com/tests/o365).

|رمز التقرير بعدم التسليم (NDR)|الوصف|
|---|---|
|5.7.321|starttls-not-supported: يجب أن يدعم خادم البريد الوجهة TLS لتلقي البريد.|
|5.7.322|انتهت صلاحية الشهادة: انتهت صلاحية شهادة خادم البريد الوجهة.|
|5.7.323|tlsa-invalid: فشل المجال في التحقق من صحة DANE.|
|5.7.324|dnssec-invalid: أرجع المجال الوجهة سجلات DNSSEC غير صالحة.|

### <a name="troubleshooting-57321-starttls-not-supported"></a>استكشاف الأخطاء وإصلاحها 5.7.321 starttls-not-supported

يشير هذا عادة إلى وجود مشكلة في خادم البريد الوجهة. بعد تلقي الرسالة:

1. تحقق من إدخال عنوان البريد الإلكتروني الوجهة بشكل صحيح.
2. تنبيه مسؤول البريد الإلكتروني الوجهة بأنك تلقيت رمز الخطأ هذا حتى يتمكنوا من تحديد ما إذا تم تكوين الخادم الوجهة بشكل صحيح لتلقي الرسائل باستخدام TLS.
3. أعد محاولة إرسال البريد الإلكتروني وراجع تفاصيل تتبع الرسائل للرسالة في مدخل مركز إدارة Exchange.

### <a name="troubleshooting-57322-certificate-expired"></a>استكشاف أخطاء انتهاء صلاحية الشهادة 5.7.322 وإصلاحها

يجب تقديم شهادة X.509 صالحة لم تنته صلاحيتها إلى خادم البريد الإلكتروني المرسل. يجب تجديد شهادات X.509 بعد انتهاء صلاحيتها، عادة سنويا. بعد تلقي الرسالة:

1. تنبيه مسؤول البريد الإلكتروني الوجهة بأنك تلقيت رمز الخطأ هذا وقم بتوفير سلسلة رمز الخطأ.
2. السماح بوقت تجديد شهادة الخادم الوجهة وتحديث سجل TLSA للإشارة إلى الشهادة الجديدة. بعد ذلك، أعد محاولة إرسال البريد الإلكتروني وراجع تفاصيل تتبع الرسائل للرسالة في مدخل مركز إدارة Exchange.

### <a name="troubleshooting-57323-tlsa-invalid"></a>استكشاف أخطاء 5.7.323 tlsa وإصلاحها

يرتبط رمز الخطأ هذا بتكوين سجل TLSA بشكل خاطئ ويمكن إنشاؤه فقط بعد إرجاع سجل TLSA الأصلي ل DNSSEC. هناك العديد من السيناريوهات أثناء التحقق من صحة DANE التي تحدث بعد إرجاع السجل والتي يمكن أن تؤدي إلى إنشاء التعليمات البرمجية. تعمل Microsoft بنشاط على السيناريوهات التي تغطيها رمز الخطأ هذا، بحيث يحتوي كل سيناريو على تعليمة برمجية محددة. حاليا، قد يتسبب سيناريو واحد أو أكثر من هذه السيناريوهات في إنشاء رمز الخطأ:

1. لا تتطابق شهادة خادم البريد الوجهة مع ما هو متوقع لكل سجل TLSA الأصلي.
2. تم تكوين سجل TLSA الأصلي بشكل خاطئ.
3. يتم مهاجمة المجال الوجهة.
4. أي فشل DANE آخر.

بعد تلقي الرسالة:

1. تنبيه مسؤول البريد الإلكتروني الوجهة بأنك تلقيت رمز الخطأ هذا وقم بتوفير سلسلة رمز الخطأ له.
2. السماح لوقت مسؤول البريد الإلكتروني الوجهة لمراجعة تكوين DANE وصلاحية شهادة خادم البريد الإلكتروني. بعد ذلك، أعد محاولة إرسال البريد الإلكتروني وراجع تفاصيل تتبع الرسائل للرسالة في مدخل مركز إدارة Exchange.

### <a name="troubleshooting-57324-dnssec-invalid"></a>استكشاف الأخطاء وإصلاحها 5.7.324 dnssec-invalid

يتم إنشاء رمز الخطأ هذا عندما أشار المجال الوجهة إلى أنه كان أصليا من DNSSEC ولكن Exchange Online لم يتمكن من التحقق من صحته ك DNSSEC-authentic.

بعد تلقي الرسالة:

1. تنبيه مسؤول البريد الإلكتروني الوجهة بأنك تلقيت رمز الخطأ هذا وقم بتوفير سلسلة رمز الخطأ له.
2. السماح لوقت مسؤول البريد الإلكتروني الوجهة لمراجعة تكوين DNSSEC لمجاله. بعد ذلك، أعد محاولة إرسال البريد الإلكتروني وراجع تفاصيل تتبع الرسائل للرسالة في مدخل مركز إدارة Exchange.

## <a name="troubleshooting-receiving-emails-with-smtp-dane"></a>استكشاف أخطاء تلقي رسائل البريد الإلكتروني باستخدام SMTP DANE وإصلاحها

حاليا، هناك طريقتان يمكن لمسؤول مجال استلام استخدامهما للتحقق من صحة تكوين DNSSEC و DANE واستكشاف الأخطاء فيه وإصلاحها لتلقي البريد الإلكتروني من Exchange Online باستخدام هذه المعايير.

1. اعتماد SMTP TLS-RPT (تقرير أمان طبقة النقل) المقدم في [RFC8460](https://datatracker.ietf.org/doc/html/rfc8460)
2. استخدام أداة محلل الاتصال عن بعد [من Microsoft Remote Connectivity Analyzer](https://testconnectivity.microsoft.com/tests/o365)

TLS-RPT [https://datatracker.ietf.org/doc/html/rfc8460](https://datatracker.ietf.org/doc/html/rfc8460) هي آلية إعداد التقارير للمرسلين لتوفير تفاصيل لمسؤولي المجال الوجهة حول نجاحات وفشل DANE وMTA-STS مع تلك المجالات الوجهة المعنية. لتلقي تقارير TLS-RPT، تحتاج فقط إلى إضافة سجل TXT في سجلات DNS لمجالك الذي يتضمن عنوان البريد الإلكتروني أو URI الذي تريد إرسال التقارير إليه. سيرسل Exchange Online تقارير TLS-RPT بتنسيق JSON.

سجل المثال:

:::image type="content" source="../media/compliance-trial/example-record.png" alt-text="سجل مثال" lightbox="../media/compliance-trial/example-record.png":::

الطريقة الثانية هي استخدام محلل الاتصال عن بعد [Microsoft Remote Connectivity Analyzer](https://testconnectivity.microsoft.com/tests/o365)، الذي يمكنه إجراء نفس عمليات فحص DNSSEC و DANE مقابل تكوين DNS الذي سيقوم به Exchange Online عند إرسال البريد الإلكتروني خارج الخدمة. هذه هي الطريقة الأكثر مباشرة لاستكشاف الأخطاء وإصلاحها في التكوين لتلقي البريد الإلكتروني من Exchange Online باستخدام هذه المعايير.

عند استكشاف الأخطاء وإصلاحها، قد يتم إنشاء رموز الخطأ أدناه:

|رمز التقرير بعدم التسليم (NDR)|الوصف|
|---|---|
|4/5.7.321|starttls-not-supported: يجب أن يدعم خادم البريد الوجهة TLS لتلقي البريد.|
|4/5.7.322|انتهت صلاحية الشهادة: انتهت صلاحية شهادة خادم البريد الوجهة.|
|4/5.7.323|tlsa-invalid: فشل المجال في التحقق من صحة DANE.|
|4/5.7.324|dnssec-invalid: أرجع المجال الوجهة سجلات DNSSEC غير صالحة.|

### <a name="troubleshooting-57321-starttls-not-supported"></a>استكشاف الأخطاء وإصلاحها 5.7.321 starttls-not-supported

> [!NOTE]
> هذه الخطوات مخصصة لمسؤولي البريد الإلكتروني لاستكشاف أخطاء تلقي البريد الإلكتروني من Exchange Online باستخدام SMTP DANE وإصلاحها.

يشير هذا عادة إلى وجود مشكلة في خادم البريد الوجهة. خادم البريد الذي يختبر محلل الاتصال عن بعد الاتصال به. هناك بشكل عام سيناريوهان ينشئان هذه التعليمات البرمجية:

1.  لا يدعم خادم البريد الوجهة الاتصال الآمن على الإطلاق، ويجب استخدام الاتصال العادي غير المشفر.
2.  تم تكوين الخادم الوجهة بشكل غير صحيح ويتجاهل الأمر STARTTLS.

بعد تلقي الرسالة:

1. تحقق من عنوان البريد الإلكتروني.
2. حدد موقع عنوان IP المقترن بعبارة الخطأ حتى تتمكن من تحديد خادم البريد الذي تقترن به العبارة.
3. تحقق من إعداد خادم البريد للتأكد من تكوينه للاستماع إلى حركة مرور SMTP (عادة ما يكون المنفذان 25 و587).
4. انتظر بضع دقائق، ثم أعد محاولة الاختبار باستخدام أداة محلل الاتصال عن بعد.
5. إذا كان لا يزال يفشل، فحاول إزالة سجل TLSA وتشغيل الاختبار باستخدام أداة محلل الاتصال عن بعد مرة أخرى.
6. إذا لم تكن هناك أي حالات فشل، فقد يشير ذلك إلى أن خادم البريد الذي تستخدمه لتلقي البريد لا يدعم STARTTLS وقد تحتاج إلى الترقية إلى خادم يقوم بذلك لاستخدام DANE.

### <a name="troubleshooting-57322-certificate-expired"></a>استكشاف أخطاء انتهاء صلاحية الشهادة 5.7.322 وإصلاحها

> [!NOTE]
> هذه الخطوات مخصصة لمسؤولي البريد الإلكتروني لاستكشاف أخطاء تلقي البريد الإلكتروني من Exchange Online باستخدام SMTP DANE وإصلاحها.

يجب تقديم شهادة X.509 صالحة لم تنته صلاحيتها إلى خادم البريد الإلكتروني المرسل. يجب تجديد شهادات X.509 بعد انتهاء صلاحيتها، عادة سنويا. بعد تلقي الرسالة:

1. تحقق من IP المقترن بعبارة الخطأ، حتى تتمكن من تحديد خادم البريد المقترن به. حدد موقع الشهادة المنتهية الصلاحية على خادم البريد الإلكتروني الذي حددته.
2. سجل الدخول إلى موقع موفر الشهادة على ويب.
3. حدد الشهادة المنتهية الصلاحية واتبع الإرشادات لتجديد التجديد ودفع قيمة التجديد.
4. بعد أن يتحقق الموفر من عملية الشراء، يمكنك تنزيل شهادة جديدة.
5. تثبيت الشهادة التي تم تجديدها في خادم البريد المقترن بها.
6. تحديث سجل TLSA المقترن بخادم البريد ببيانات الشهادة الجديدة.
7. بعد انتظار مقدار مناسب من الوقت، أعد محاولة الاختبار باستخدام أداة محلل الاتصال عن بعد.

### <a name="troubleshooting-57323-tlsa-invalid"></a>استكشاف أخطاء 5.7.323 tlsa وإصلاحها

> [!NOTE]
> هذه الخطوات مخصصة لمسؤولي البريد الإلكتروني لاستكشاف أخطاء تلقي البريد الإلكتروني من Exchange Online باستخدام SMTP DANE وإصلاحها.

يرتبط رمز الخطأ هذا بتكوين سجل TLSA بشكل خاطئ ويمكن إنشاؤه فقط بعد إرجاع سجل TSLA الأصلي ل DNSSEC. ولكن، هناك العديد من السيناريوهات أثناء التحقق من صحة DANE التي تحدث بعد إرجاع السجل والتي يمكن أن تؤدي إلى إنشاء التعليمات البرمجية. تعمل Microsoft بنشاط على السيناريوهات التي تغطيها رمز الخطأ هذا، بحيث يحتوي كل سيناريو على تعليمة برمجية محددة. حاليا، قد يتسبب سيناريو واحد أو أكثر من هذه السيناريوهات في إنشاء رمز الخطأ:

1. تم تكوين سجل TLSA الأصلي بشكل خاطئ.
2. الشهادة غير صالحة/مكونة بعد لنافذة زمنية مستقبلية.
3. يتم مهاجمة مجال الوجهة.
4. أي فشل DANE آخر.

بعد تلقي الرسالة:

1. تحقق من IP المقترن بعبارة الخطأ لتحديد خادم البريد المقترن به.
2. حدد سجل TLSA المقترن بخادم البريد المعرف.
3. تحقق من تكوين سجل TLSA للتأكد من أنه يشير إلى المرسل لإجراء عمليات التحقق من DANE المفضلة وأن بيانات الشهادة الصحيحة قد تم تضمينها في سجل TLSA.
    1. إذا كان عليك إجراء أي تحديثات على السجل للاختلافات، فانتظر بضع دقائق ثم أعد تشغيل الاختبار باستخدام أداة محلل الاتصال عن بعد.
4. حدد موقع الشهادة على خادم البريد المعرف.
5. تحقق من النافذة الزمنية التي تكون الشهادة صالحة لها. إذا تم تعيينه لبدء الصلاحية في تاريخ مستقبلي، فإنه يجب تجديده للتاريخ الحالي.
    1. سجل الدخول إلى موقع موفر الشهادة على ويب.
    2. حدد الشهادة المنتهية الصلاحية واتبع الإرشادات لتجديد التجديد ودفع قيمة التجديد.
    3. بعد أن يتحقق الموفر من عملية الشراء، يمكنك تنزيل شهادة جديدة.
    4. تثبيت الشهادة التي تم تجديدها في خادم البريد المقترن بها.

### <a name="troubleshooting-57324-dnssec-invalid"></a>استكشاف الأخطاء وإصلاحها 5.7.324 dnssec-invalid

> [!NOTE]
> هذه الخطوات مخصصة لمسؤولي البريد الإلكتروني لاستكشاف أخطاء تلقي البريد الإلكتروني من Exchange Online باستخدام SMTP DANE وإصلاحها.

يتم إنشاء رمز الخطأ هذا عندما يشير المجال الوجهة إلى أنه أصلي ل DNSSEC ولكن Exchange Online غير قادر على التحقق من صحته ك DNSSEC-authentic. لن يكون هذا القسم شاملا لاستكشاف مشكلات DNSSEC وإصلاحها ويركز على السيناريوهات التي مرت فيها المجالات مسبقا بمصادقة DNSSEC ولكن ليس الآن.

بعد تلقي الرسالة:

1. إذا كنت تستخدم موفر DNS، على سبيل المثال GoDaddy، فقم بتنبيه موفر DNS الخاص بك بالخطأ حتى يتمكنوا من العمل على استكشاف الأخطاء وإصلاحها وتغيير التكوين.
2. إذا كنت تدير البنية الأساسية DNSSEC الخاصة بك، فهناك العديد من تكوينات DNSSEC الخاطئة التي قد تنشئ رسالة الخطأ هذه. بعض المشاكل الشائعة للتحقق مما إذا كانت المنطقة الخاصة بك تمر مسبقا بمصادقة DNSSEC:
    1. سلسلة الثقة المقطوعة، عندما تحتوي المنطقة الأصل على مجموعة من سجلات DS التي تشير إلى شيء غير موجود في المنطقة التابعة. يؤدي هذا إلى وضع علامة على المنطقة التابعة كمحللات عن طريق التحقق من صحة المحللات.
        - قم بالحل من خلال مراجعة معرفات مفاتيح RRSIG للمجالات التابعة والتأكد من تطابقها مع معرفات المفاتيح في سجلات DS المنشورة في المنطقة الأصل.
    2. سجل موارد RRSIG للمجال غير صالح للوقت، إما أنه قد انتهت صلاحيته أو لم تبدأ فترة صلاحيته.
        - قم بالحل عن طريق إنشاء تواقيع جديدة للمجال باستخدام فترات زمنية صالحة.

## <a name="frequently-asked-questions"></a>الأسئلة المتداولة

### <a name="as-an-exchange-online-customer-can-i-opt-out-of-using-dnssec-andor-dane"></a>كعميل Exchange Online، هل يمكنني رفض استخدام DNSSEC و/أو DANE؟

نعتقد بشدة أن DNSSEC و DANE سيزيدان بشكل كبير من الوضع الأمني لخدمتنا ويفيدان جميع عملائنا. لقد عملنا بجد خلال العام الماضي لتقليل مخاطر وشدة التأثير المحتمل الذي قد يحدثه هذا النشر لعملاء M365. سنراقب النشر ونتعقبه بنشاط لضمان تقليل التأثير السلبي في أثناء طرحه. ولهذا السبب، لن تتوفر استثناءات على مستوى المستأجر أو إلغاء الاشتراك.
إذا واجهت أي مشاكل تتعلق بتمكين DNSSEC و/أو DANE، فستساعدك الأساليب المختلفة للتحقيق في حالات الفشل المذكورة في هذا المستند على تحديد مصدر الخطأ. في معظم الحالات، ستكون المشكلة مع جهة الوجهة الخارجية وستحتاج إلى الاتصال بشركاء الأعمال هؤلاء الذين يحتاجون إلى تكوين DNSSEC و DANE بشكل صحيح لتلقي البريد الإلكتروني من Exchange Online باستخدام هذه المعايير.

### <a name="how-does-dnssec-relate-to-dane"></a>كيف يرتبط DNSSEC ب DANE؟

يضيف DNSSEC طبقة من الثقة في دقة DNS من خلال الاستفادة من البنية الأساسية للمفتاح العام للتأكد من أن السجلات التي تم إرجاعها استجابة لاستعلام DNS صحيحة. يضمن DANE أن خادم البريد المتلقي هو خادم البريد المشروع والمتوقع لسجل MX الأصلي.

### <a name="what-is-the-difference-between-mta-sts-and-dane-for-smtp"></a>ما الفرق بين MTA-STS و DANE ل SMTP؟

يخدم DANE وMTA-STS نفس الغرض، ولكن DANE يتطلب DNSSEC لمصادقة DNS بينما تعتمد MTA-STS على المراجع المصدقة.

### <a name="why-isnt-opportunistic-tls-sufficient"></a>لماذا لا تكفي TLS الانتهازية؟

ستقوم TLS الانتهازية بتشفير الاتصال بين نقطتي نهاية إذا وافق كلاهما على دعمه. ومع ذلك، حتى إذا كانت TLS تشفر الإرسال، فقد يتم تزييف المجال أثناء تحليل DNS بحيث يشير إلى نقطة نهاية ممثل ضار بدلا من نقطة النهاية الحقيقية للمجال. هذه هي الفجوة في أمان البريد الإلكتروني التي تتم معالجتها عن طريق تنفيذ MTA-STS و/أو SMTP DANE مع DNSSEC.

### <a name="why-isnt-dnssec-sufficient"></a>لماذا لا يكفي DNSSEC؟

DNSSEC ليست مقاومة تماما لهجمات Man-in-the-Middle والهجمات ذات الإصدارات المنخفضة (من TLS لمسح النص) لسيناريوهات تدفق البريد. توفر إضافة MTA-STS و DANE جنبا إلى جنب مع DNSSEC طريقة أمان شاملة لإحباط كل من MITM وهجمات الإصدار الأدنى.

## <a name="additional-links"></a>ارتباطات إضافية

[البحث عن المشاكل وإصلاحها بعد إضافة مجالك أو سجلات DNS](/microsoft-365/admin/get-help-with-domains/find-and-fix-issues)

[نظرة عامة على | DNSSEC Microsoft Docs](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/jj200221(v=ws.11))

[استخدام DMARC للتحقق من صحة البريد الإلكتروني، وخطوات الإعداد - Office 365 | Microsoft Docs](/microsoft-365/security/office-365-security/use-dmarc-to-validate-email)

[كيفية استخدام DKIM للبريد الإلكتروني في مجالك المخصص - Office 365 | Microsoft Docs](/microsoft-365/security/office-365-security/use-dkim-to-validate-outbound-email)

[كيف يمنع إطار نهج المرسل (SPF) تزييف هوية المرسل - Office 365 | Microsoft Docs](/microsoft-365/security/office-365-security/how-office-365-uses-spf-to-prevent-spoofing)

[Exchange Online Transport News من Microsoft Ignite 2020 - مجتمع Microsoft التقني](https://techcommunity.microsoft.com/t5/exchange-team-blog/exchange-online-transport-news-from-microsoft-ignite-2020/ba-p/1687699)

[rfc8461 (ietf.org)](https://datatracker.ietf.org/doc/html/rfc8461)
