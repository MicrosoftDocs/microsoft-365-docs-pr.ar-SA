---
title: استكشاف مشاكل الأداء وإصلاحها
description: استكشاف الأخطاء المتعلقة باستخدام CPU العالي المرتبط لخدمة الحماية في الوقت الحقيقي وإصلاحها في Microsoft Defender ل Endpoint.
keywords: استكشاف الأخطاء وإصلاحها والأداء واستخدام CPU العالي واستخدام CPU العالي والخطأ وإصلاح التوافق وتحديثه وoms وشاشة العرض والتقارير برنامج الحماية من الفيروسات من Microsoft Defender
search.appverid: met150
ms.prod: m365-security
ms.mktglfcycl: manage
ms.sitesec: library
ms.pagetype: security
ms.author: maccruz
author: schmurky
ms.localizationpriority: medium
manager: dansimp
ms.date: 10/19/2021
audience: ITPro
ms.topic: troubleshooting
ms.technology: mde
ms.collection: m365-security-compliance
ms.openlocfilehash: 1dfe480f36d99acfdc9dcb36e63d2eed4f22054a
ms.sourcegitcommit: dd6514ae173f1c821d4ec25298145df6cb232e2e
ms.translationtype: MT
ms.contentlocale: ar-SA
ms.lasthandoff: 01/19/2022
ms.locfileid: "63573900"
---
# <a name="troubleshoot-performance-issues-related-to-real-time-protection"></a>استكشاف مشاكل الأداء المتعلقة بالحماية في الوقت الحقيقي وإصلاحها


[!INCLUDE [Microsoft 365 Defender rebranding](../../includes/microsoft-defender.md)]


**ينطبق على:**
- [خطة Microsoft Defender لنقطة النهاية 2](https://go.microsoft.com/fwlink/p/?linkid=2154037)

إذا كان النظام لديك تواجه مشاكل عالية في استخدام وحدة المعالجة المركزية (CPU) أو الأداء ذات الصلة بالخدمة في الوقت الحقيقي للحماية في Microsoft Defender ل Endpoint، يمكنك إرسال تذكرة إلى دعم Microsoft. اتبع الخطوات في [تجميع برنامج الحماية من الفيروسات من Microsoft Defender التشخيصية](collect-diagnostic-data.md).

ب أنت مسؤول، يمكنك أيضا استكشاف هذه المشاكل وإصلاحها بنفسك.

أولا، قد ترغب في التحقق مما إذا كان سبب المشكلة هو برنامج آخر. اقرأ [التحقق من الأمر مع المورد للحصول على استثناءات برنامج الحماية من الفيروسات](#check-with-vendor-for-antivirus-exclusions).

وبخلاف ذلك، يمكنك تحديد البرامج المرتبطة مشكلة الأداء المحددة باتباع الخطوات في [تحليل سجل حماية Microsoft](#analyze-the-microsoft-protection-log).

يمكنك أيضا توفير سجلات إضافية لمواد الإرسال إلى دعم Microsoft باتباع الخطوات التالية:

- [التقاط سجلات العملية باستخدام "مراقبة العملية"](#capture-process-logs-using-process-monitor)
- [التقاط سجلات الأداء باستخدام Windows تسجيل الأداء](#capture-performance-logs-using-windows-performance-recorder)

## <a name="check-with-vendor-for-antivirus-exclusions"></a>التحقق مع المورد من استثناءات برنامج الحماية من الفيروسات

إذا كان بإمكانك تحديد البرامج التي تؤثر على أداء النظام بسهولة، فاذهب إلى قاعدة معارف مورد البرامج أو مركز الدعم. ابحث إذا كانت لديهم توصيات حول استثناءات برنامج الحماية من الفيروسات. إذا لم يكن موقع ويب الخاص بالمورد يحتوي عليها، يمكنك فتح تذكرة دعم معه ومطالبته بنشر تذكرة دعم.

نوصي بأن يتبع موردو البرامج الإرشادات المختلفة في "شراكة مع الصناعة" [لتقليل الإيجابيات الخاطئة](https://www.microsoft.com/security/blog/2018/08/16/partnering-with-the-industry-to-minimize-false-positives/). يمكن للمورد إرسال برامجه من [خلال التحليل الذكي لمخاطر الأمان من Microsoft الإلكتروني](https://www.microsoft.com/wdsi/filesubmission?persona=SoftwareDeveloper).

## <a name="analyze-the-microsoft-protection-log"></a>تحليل سجل حماية Microsoft

في **MPLog-xxxxxxxx-xxxxxx.log**، يمكنك العثور على معلومات تأثير الأداء المقدرة للبرامج التي يتم تشغيلها على أنها *مقدرةمفعة*:

`Per-process counts:ProcessImageName: smsswd.exe, TotalTime: 6597, Count: 1406, MaxTime: 609, MaxTimeFile: \Device\HarddiskVolume3\_SMSTaskSequence\Packages\WQ1008E9\Files\FramePkg.exe, EstimatedImpact: 65%`

<br>

****

|اسم الحقل|الوصف|
|---|---|
|ProcessImageName|اسم صورة العملية|
|TotalTime|المدة التراكمية بالمللي ثانية التي تستغرقها عمليات فحص الملفات التي تم الوصول إليها بواسطة هذه العملية|
|Count|عدد الملفات الممسوحة ضوئيا التي تم الوصول إليها بواسطة هذه العملية|
|MaxTime|المدة بالمللي ثانية في أطول عملية فحص واحدة لملف تم الوصول إليه بواسطة هذه العملية|
|MaxTimeFile|مسار الملف الذي تم الوصول إليه بواسطة هذه العملية حيث تم تسجيل أطول فحص للمدة `MaxTime`|
|EstimatedImpact|النسبة المئوية للوقت المقضي في عمليات المسح الضوئي للملفات التي تم الوصول إليها بواسطة هذه العملية من الفترة التي شهدت فيها هذه العملية نشاط الفحص|
|

إذا كان تأثير الأداء عاليا، فحاول إضافة العملية إلى استثناءات المسار/العملية باتباع الخطوات في تكوين الاستثناءات للمسح الضوئي برنامج الحماية من الفيروسات من Microsoft Defender التحقق [من صحتها](collect-diagnostic-data.md).

إذا لم تحل الخطوة السابقة المشكلة، يمكنك جمع مزيد من المعلومات من خلال "مراقب العملية" [](#capture-process-logs-using-process-monitor) أو "Windows [الأداء](#capture-performance-logs-using-windows-performance-recorder)" في المقاطع التالية.

## <a name="capture-process-logs-using-process-monitor"></a>التقاط سجلات العملية باستخدام "مراقبة العملية"

مراقبة العمليات (ProcMon) هي أداة مراقبة متقدمة يمكنها إظهار العمليات في الوقت الحقيقي. يمكنك استخدام ذلك لالتقاط مشكلة الأداء أثناء حدوثها.

1. تنزيل [مراقبة العملية v3.60](/sysinternals/downloads/procmon) إلى مجلد مثل `C:\temp`.

2. لإزالة علامة الملف على الويب:
    1. انقر بضغطة **ProcessMonitor.zip** وحدد **خصائص**.
    1. ضمن علامة *التبويب عام* ، ابحث عن *الأمان*.
    1. تحقق من المربع إلى جانب **إلغاء الحظر**.
    1. حدد **تطبيق**.

    ![إزالة MOTW.](images/procmon-motw.png)

3. إلغاء اجلد الملف بحيث `C:\temp` يكون مسار المجلد .`C:\temp\ProcessMonitor`

4. **انسخProcMon.exe** إلى Windows أو Windows الخادم الذي تقوم استكشاف الأخطاء فيه وإصلاحها.

5. قبل تشغيل ProcMon، تأكد من إغلاق جميع التطبيقات الأخرى غير المرتبطة مشكلة استخدام CPU العالية. من شأن إجراء ذلك تقليل عدد العمليات التي يجب التحقق من وجودها.

6. يمكنك تشغيل ProcMon من خلال طريقتين.
    1. انقر **بضغطةProcMon.exe** وحدد **تشغيل كمسؤول**.

        بما أن التسجيل يبدأ تلقائيا، حدد أيقونة عدسة التكبير لإيقاف الالتقاط الحالي أو استخدام اختصار لوحة المفاتيح **Ctrl+E**.

        ![أيقونة عدسة التكبير.](images/procmon-magglass.png)

        للتحقق من إيقاف الالتقاط، تحقق مما إذا كانت أيقونة العدسة المكبرة تظهر الآن مع علامة X حمراء.

        ![الشرطة المائلة الحمراء.](images/procmon-magglass-stop.png)

        بعد ذلك، لمسح الالتقاط السابق، حدد أيقونة الممحاة.

        ![أيقونة مسح.](images/procmon-eraser-clear.png)

        أو استخدم اختصار لوحة المفاتيح **Ctrl+X**.

    2. الطريقة الثانية هي تشغيل سطر **الأوامر** كمسؤول، ثم من مسار مراقبة العملية، قم بتشغيل:

        ![cmd procmon.](images/cmd-procmon.png)

        ```console
        Procmon.exe /AcceptEula /Noconnect /Profiling
        ```

        > [!TIP]
        > اجعل نافذة ProcMon صغيرة قدر الإمكان عند التقاط البيانات حتى تتمكن من بدء التتبع أو إيقافه بسهولة.
        >
        > ![تصغير Procmon.](images/procmon-minimize.png)

7. بعد اتباع أحد الإجراءات في الخطوة 6، سترى بعد ذلك خيارا لتعيين عوامل التصفية. حدد **موافق**. يمكنك دائما تصفية النتائج بعد اكتمال الالتقاط.

    ![تصفية اسم العملية هو استبعاد النظام.](images/procmon-filter-options.png)

8. لبدء الالتقاط، حدد أيقونة عدسة التكبير مرة أخرى.

9. إعادة إنتاج المشكلة.

    > [!TIP]
    > انتظر حتى يتم إعادة إنتاج المشكلة بالكامل، ثم دون الطابع الزمني عند بدء التتبع.

10. بمجرد أن يكون لديك نشاط معالجة من دقيقتين إلى أربع دقائق أثناء حالة استخدام CPU العالية، أوقف الالتقاط عن طريق تحديد أيقونة عدسة التكبير.

11. لحفظ الالتقاط باسم فريد وب تنسيق .pml، حدد **ملف** ثم حدد **حفظ...**. تأكد من تحديد الأزرار الراديوية **كافة الأحداث** وتنسيق مراقبة العملية **الأصلية (PML).**

    ![حفظ الإعدادات.](images/procmon-savesettings1.png)

12. لتعقب أفضل، غير المسار الافتراضي من `C:\temp\ProcessMonitor\LogFile.PML` إلى `C:\temp\ProcessMonitor\%ComputerName%_LogFile_MMDDYEAR_Repro_of_issue.PML` المكان:
    - `%ComputerName%` هو اسم الجهاز
    - `MMDDYEAR` هو الشهر، اليوم، السنة
    - `Repro_of_issue` هو اسم المشكلة التي تحاول إعادة إنتاجها

    > [!TIP]
    > إذا كان لديك نظام عمل، فقد تحتاج إلى الحصول على نموذج سجل لمقارنته.

13. اضغط على ملف .pml وأ إرساله إلى دعم Microsoft.

## <a name="capture-performance-logs-using-windows-performance-recorder"></a>التقاط سجلات الأداء باستخدام Windows تسجيل الأداء

يمكنك استخدام Windows الأداء (WPR) لتضمين معلومات إضافية في الإرسال إلى دعم Microsoft. WPR هو أداة تسجيل فعالة تقوم بإنشاء تتبع الأحداث Windows التسجيلات.

WPR هو جزء من Windows التقييم والنشر (Windows ADK) ويمكن تنزيله من تنزيل Windows [ADK وتثبيته](/windows-hardware/get-started/adk-install). يمكنك أيضا تنزيله كجزء من مجموعة Windows 10 تطوير البرامج في Windows 10 [SDK](https://developer.microsoft.com/windows/downloads/windows-10-sdk/).

يمكنك استخدام واجهة مستخدم WPR باتباع الخطوات في [تسجيل سجلات الأداء باستخدام واجهة مستخدم WPR](#capture-performance-logs-using-the-wpr-ui).

بدلا من ذلك، يمكنك أيضا استخدام أداة سطر الأوامر *wpr.exe، المتوفرة* في Windows 8 والإصدارات الأحدث باتباع الخطوات في تسجيل سجلات الأداء باستخدام [WPR CLI](#capture-performance-logs-using-the-wpr-cli).

### <a name="capture-performance-logs-using-the-wpr-ui"></a>التقاط سجلات الأداء باستخدام واجهة مستخدم WPR

> [!TIP]
> إذا كانت هناك أجهزة متعددة تواجه هذه المشكلة، فاستخدم الجهاز الذي به ذاكرة الوصول العشوائي الأكثر.

1. تنزيل WPR وتثبيته.

2. ضمن *Windows،* انقر بزر الماوس الأيمن Windows **مسجل الأداء**.

    ![قائمة البدء.](images/wpr-01.png)

    حدد **المزيد**. حدد **تشغيل كمسؤول**.

3. عندما يظهر مربع الحوار التحكم في حساب المستخدم، حدد **نعم**.

    ![UAC.](images/wpt-yes.png)

4. بعد ذلك، قم [بتنزيل ملف تعريف تحليل Microsoft Defender لنقطة](https://github.com/YongRhee-MDE/Scripts/blob/master/MDAV.wprp) النهاية واحفظه `MDAV.wprp` كمجلد مثل `C:\temp`.

5. في مربع الحوار WPR، حدد **المزيد من الخيارات**.

    ![حدد المزيد من الخيارات.](images/wpr-03.png)

6. حدد **إضافة ملفات تعريف...** واستعرض إلى مسار `MDAV.wprp` الملف.

7. بعد ذلك، سترى مجموعة ملفات تعريف جديدة ضمن قياسات  مخصصة تسمى *تحليل نقطة النهاية ل Microsoft Defender* أسفلها.

    ![في ملف.](images/wpr-infile.png)

    > [!WARNING]
    > إذا كان Windows الخادم الخاص بك به ذاكرة الوصول العشوائي (RAM) أو أكثر من 64 غيغابايت، فاستخدم القياس المخصص `Microsoft Defender for Endpoint analysis for large servers` بدلا من `Microsoft Defender for Endpoint analysis`. وإلا، فإن النظام الخاص بك قد يستهلك كمية كبيرة من ذاكرة تجمع غير الصفحات أو المخازن المؤقتة التي يمكن أن تؤدي إلى عدم استقرار النظام. يمكنك اختيار ملفات التعريف التي تريد إضافتها عن طريق توسيع **تحليل الموارد**.
    يوفر ملف التعريف المخصص هذا السياق الضروري لتحليل الأداء بشكل مفصل.

8. لاستخدام قياس مخصص لملف تعريف التحليل المطوب ل Microsoft Defender لنقطة النهاية في واجهة مستخدم WPR:

    1. تأكد من عدم تحديد أي ملفات تعريف ضمن *مجموعات* فرز المستوى الأول وتحليل *الموارد* *وتحليل السيناريو* .
    2. حدد **قياسات مخصصة**.
    3. حدد **Microsoft Defender لتحليل نقطة النهاية**.
    4. حدد **مطو ضمن** *مستوى* التفاصيل.
    5. حدد **ملف** أو **ذاكرة** ضمن وضع التسجيل.

    > [!IMPORTANT]
    > يجب تحديد *ملف* لاستخدام وضع تسجيل الملفات إذا كان يمكن للمستخدم إعادة إنتاج مشكلة الأداء مباشرة. تندرج معظم المشاكل ضمن هذه الفئة. ومع ذلك، إذا لم يكن المستخدم يستطيع إعادة إنتاج المشكلة مباشرة ولكن يمكنه ملاحظتها بسهولة بمجرد حدوث المشكلة، يجب على المستخدم تحديد *الذاكرة* لاستخدام وضع تسجيل الذاكرة. يضمن ذلك عدم تضخيم سجل التتبع بشكل زائد بسبب وقت المدى الطويل.

9. أنت الآن جاهز لتجميع البيانات. إنهاء جميع التطبيقات غير المتعلقة بإعادة إنتاج مشكلة الأداء. يمكنك تحديد **إخفاء الخيارات** لإبقاء المساحة التي تشغلها نافذة WPR صغيرة.

    ![إخفاء الخيارات.](images/wpr-08.png)

    > [!TIP]
    > حاول بدء التتبع في عدد الثواني بالكامل. على سبيل المثال، 01:30:00. سيسهل ذلك تحليل البيانات. حاول أيضا تعقب الطابع الزمني تماما عند إعادة إنتاج المشكلة.

10. حدد **بدء**.

    ![حدد بداية التتبع.](images/wpr-09.png)

11. إعادة إنتاج المشكلة.

    > [!TIP]
    > احتفظ بجمع البيانات لمدة لا يزيد عددها عن خمس دقائق. من دقيقتين إلى ثلاث دقائق هو نطاق جيد نظرا لأنه يتم تجميع الكثير من البيانات.

12. حدد **حفظ**.

    ![حدد حفظ.](images/wpr-10.png)

13. تعبئة **اكتب وصفا مفصلا للمشكلة:** بمعلومات حول المشكلة وكيفية إعادة إنتاج المشكلة.

    ![قم بتعبئة التفاصيل.](images/wpr-12.png)

    1. حدد **اسم الملف:** لتحديد مكان حفظ ملف التتبع. بشكل افتراضي، يتم حفظه في `%user%\Documents\WPR Files\`.
    1. حدد **حفظ**.

14. انتظر أثناء دمج عملية التتبع.

    ![تتبع عام لجمع WPR.](images/wpr-13.png)

15. بعد حفظ عملية التتبع، حدد **فتح مجلد**.

    ![تم حفظ تتبع WPR.](images/wpr-14.png)

    قم بتضمين كل من الملف والمجلد في الإرسال إلى دعم Microsoft.

    ![ملف ومجلد.](images/wpr-15.png)

### <a name="capture-performance-logs-using-the-wpr-cli"></a>التقاط سجلات الأداء باستخدام WPR CLI

أداة سطر *الأوامرwpr.exe* جزء من نظام التشغيل بدءا من Windows 8. لتجميع تتبع WPR باستخدام أداة سطر الأوامر wpr.exe:

1. قم **[بتنزيل ملف تعريف تحليل Microsoft Defender لنقطة](https://github.com/YongRhee-MDE/Scripts/blob/master/MDAV.wprp)** النهاية لتتبعات الأداء إلى ملف `MDAV.wprp` مسمى في دليل محلي مثل `C:\traces`.

2. انقر ب **زر الماوس الأيمن** فوق أيقونة قائمة البدء **وحدد Windows PowerShell (المسؤول)** أو موجه **الأوامر (المسؤول)** لفتح نافذة موجه الأوامر للمسؤول.

3. عندما يظهر مربع الحوار التحكم في حساب المستخدم، حدد **نعم**.

4. عند المطالبة غير المضرة، يمكنك تشغيل الأمر التالي لبدء تتبع أداء Microsoft Defender لنقطة النهاية:

    ```console
    wpr.exe -start C:\traces\MDAV.wprp!WD.Verbose -filemode
    ```

    > [!WARNING]
    > إذا كان Windows الخادم لديك لديه 64 غيغابايت أو ذاكرة `WDForLargeServers.Light` `WDForLargeServers.Verbose` `WD.Light` الوصول العشوائي أو أكثر، فاستخدم ملفات التعريف وبدلا من ملفات التعريف و `WD.Verbose`، على التوالي. وإلا، فإن النظام الخاص بك قد يستهلك كمية كبيرة من ذاكرة تجمع غير الصفحات أو المخازن المؤقتة التي يمكن أن تؤدي إلى عدم استقرار النظام.

5. إعادة إنتاج المشكلة.

    > [!TIP]
    > احتفظ بجمع البيانات لمدة لا يزيد عددها عن خمس دقائق. استنادا إلى السيناريو، من دقيقتين إلى ثلاث دقائق هو نطاق جيد نظرا لأنه يتم تجميع الكثير من البيانات.

6. عند المطالبة غير المرتفعة، يمكنك تشغيل الأمر التالي لإيقاف تتبع الأداء، مع التأكد من توفير معلومات حول المشكلة وكيفية إعادة إنتاج المشكلة:

    ```console
    wpr.exe -stop merged.etl "Timestamp when the issue was reproduced, in HH:MM:SS format" "Description of the issue" "Any error that popped up"
    ```

7. انتظر حتى يتم دمج التتبع.

8. قم بتضمين كل من الملف والمجلد في الإرسال إلى دعم Microsoft.

## <a name="see-also"></a>راجع أيضًا

- [تجميع برنامج الحماية من الفيروسات من Microsoft Defender التشخيصية](collect-diagnostic-data.md)
- [تكوين الاستثناءات والتحقق من صحتها برنامج الحماية من الفيروسات من Microsoft Defender المسح الضوئي](configure-exclusions-microsoft-defender-antivirus.md)
